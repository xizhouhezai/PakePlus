import{d as $,r as _,a as W,b as r,o as Q,j as h,w as a,e as t,f as i,u as l,bN as q,t as H,bO as z,bP as G,M as m,bQ as J,bR as K,bS as X,bT as Y,bU as Z}from"./index-C4AMdMz2.js";import{u as ee}from"./useCurrentInstance-BLlvmEjv.js";import{V as R}from"./dist-PezRi_EG.js";const ne=$({__name:"index",setup(ae){var V;const M=_(),g=(V=ee().globalProperties)==null?void 0:V.$modal,u=_(),p=_(),y=[{title:"模板编号",dataIndex:"code"},{title:"是否开启",dataIndex:"enable",slot:!0,slotTemplate:"enable"},{title:"模板名称",dataIndex:"name"},{title:"创建时间",dataIndex:"createTime"}],w={},o=W({enableAddModal:!1,formLoading:!1,fid:"",form:{name:"",first:"",remark:"",enable:!1}}),d=W({enableAddModal:!1,formLoading:!1,fid:"",form:{enable:!1}});function D(n){o.enableAddModal=!0,n&&(Object.keys(n.record).forEach(e=>{o.form.hasOwnProperty(e)?o.form[e]=n.record[e]:o.form[e]=""}),o.fid=n.record.id,o.enableAddModal=!0)}async function E(){(await G(o.fid,o.form)).data.success&&(m.success("微信模板修改成功"),o.enableAddModal=!1,u.value.init())}async function S(){(await J(d.fid,d.form)).data.success&&(m.success("微信消息订阅模板修改成功"),d.enableAddModal=!1,p.value.init())}function I(n){g.confirm({title:"确认删除",content:"确定删除此微信消息模板?",alignCenter:!1,onOk:async()=>{(await K(n.record.id)).data.success&&(m.success("微信模板删除成功"),u.value.init())}})}function L(n){d.enableAddModal=!0,n&&(Object.keys(n.record).forEach(e=>{d.form.hasOwnProperty(e)?d.form[e]=n.record[e]:d.form[e]=""}),d.fid=n.record.id,d.enableAddModal=!0)}function j(n){g.confirm({title:"确认删除",content:"确定删除此微信消息订阅模板?",alignCenter:!1,onOk:async()=>{(await X(n.record.id)).data.success&&(m.success("微信消息订阅删除成功"),p.value.init())}})}function v(n){g.confirm({title:"提示",content:"确认要初始化微信小程序消息?",alignCenter:!1,onOk:async()=>{n==="mp"?(await Y()).data.success&&(m.success("微信小程序消息订阅初始化"),p.value.init()):(await Z()).data.success&&(m.success("微信消息模板初始化成功"),u.value.init())}})}return(n,e)=>{const c=r("a-button"),P=r("a-space"),k=r("a-col"),A=r("a-tag"),x=r("a-tab-pane"),N=r("a-tabs"),C=r("a-input"),f=r("a-form-item"),B=r("a-textarea"),b=r("a-radio"),T=r("a-radio-group"),O=r("a-form"),U=r("a-modal"),F=r("a-card");return Q(),h(F,{class:"general-card",title:"微信消息",bordered:!1},{default:a(()=>[t(N,{"default-active-key":"WECHAT"},{default:a(()=>[t(x,{key:"WECHAT",title:"微信消息"},{default:a(()=>[t(k,{span:16,style:{"margin-bottom":"10px"}},{default:a(()=>[t(P,null,{default:a(()=>[t(c,{type:"primary",onClick:v},{default:a(()=>e[8]||(e[8]=[i(" 同步微信消息 ")])),_:1})]),_:1})]),_:1}),t(l(R),{ref_key:"tablePageRef",ref:u,columns:y,methods:w,api:l(q),"api-params":{sort:"",order:""},bordered:!0,onDelete:I,onUpdate:D},{enable:a(({data:s})=>[t(A,null,{default:a(()=>[i(H(s.enable===!0?"开启":"关闭"),1)]),_:2},1024)]),_:1},8,["api"])]),_:1}),t(x,{key:"WECHATMP",title:"微信小程序订阅消息"},{default:a(()=>[t(k,{span:16,style:{"margin-bottom":"10px"}},{default:a(()=>[t(P,null,{default:a(()=>[t(c,{type:"primary",onClick:e[0]||(e[0]=s=>v("mp"))},{default:a(()=>e[9]||(e[9]=[i(" 同步微信小程序订阅消息 ")])),_:1})]),_:1})]),_:1}),t(l(R),{ref_key:"mpTablePageRef",ref:p,columns:y,methods:w,api:l(z),"api-params":{sort:"",order:""},bordered:!0,onDelete:j,onUpdate:L},{enable:a(({data:s})=>[t(A,null,{default:a(()=>[i(H(s.enable===!0?"开启":"关闭"),1)]),_:2},1024)]),_:1},8,["api"])]),_:1})]),_:1}),t(U,{visible:l(o).enableAddModal,"onUpdate:visible":e[5]||(e[5]=s=>l(o).enableAddModal=s),"align-center":!1,footer:!1},{title:a(()=>e[10]||(e[10]=[i(" 微信设置 ")])),default:a(()=>[t(O,{ref_key:"formRef",ref:M,model:l(o).form,onSubmit:E},{default:a(()=>[t(f,{field:"name",label:"模板名称","validate-trigger":["change"]},{default:a(()=>[t(C,{modelValue:l(o).form.name,"onUpdate:modelValue":e[1]||(e[1]=s=>l(o).form.name=s),disabled:!0},null,8,["modelValue"])]),_:1}),t(f,{field:"first",label:"头部信息","validate-trigger":["change"]},{default:a(()=>[t(C,{modelValue:l(o).form.first,"onUpdate:modelValue":e[2]||(e[2]=s=>l(o).form.first=s)},null,8,["modelValue"])]),_:1}),t(f,{field:"remark",label:"备注","validate-trigger":["change"]},{default:a(()=>[t(B,{modelValue:l(o).form.remark,"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).form.remark=s),"max-length":100,"allow-clear":"","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{field:"enable",label:"是否开启","validate-trigger":["change"]},{default:a(()=>[t(T,{modelValue:l(o).form.enable,"onUpdate:modelValue":e[4]||(e[4]=s=>l(o).form.enable=s),type:"button"},{default:a(()=>[t(b,{value:!0},{default:a(()=>e[11]||(e[11]=[i(" 开启 ")])),_:1}),t(b,{value:!1},{default:a(()=>e[12]||(e[12]=[i(" 关闭 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"操作"},{default:a(()=>[t(c,{loading:l(o).formLoading,"html-type":"submit",type:"primary"},{default:a(()=>e[13]||(e[13]=[i(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),t(U,{visible:l(d).enableAddModal,"onUpdate:visible":e[7]||(e[7]=s=>l(d).enableAddModal=s),"align-center":!1,footer:!1},{title:a(()=>e[14]||(e[14]=[i(" 微信小程序订阅消息 ")])),default:a(()=>[t(O,{ref_key:"formRef",ref:M,model:l(d).form,onSubmit:S},{default:a(()=>[t(f,{field:"enable",label:"是否开启","validate-trigger":["change"]},{default:a(()=>[t(T,{modelValue:l(d).form.enable,"onUpdate:modelValue":e[6]||(e[6]=s=>l(d).form.enable=s),type:"button"},{default:a(()=>[t(b,{value:!0},{default:a(()=>e[15]||(e[15]=[i(" 开启 ")])),_:1}),t(b,{value:!1},{default:a(()=>e[16]||(e[16]=[i(" 关闭 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"操作"},{default:a(()=>[t(c,{loading:l(d).formLoading,"html-type":"submit",type:"primary"},{default:a(()=>e[17]||(e[17]=[i(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{ne as default};
