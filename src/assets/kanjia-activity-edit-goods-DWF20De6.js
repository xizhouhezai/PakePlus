import{e as B,c as D}from"./promotion-ChRoyrm_.js";import{u as I,b as g,d as w}from"./filters-D05Q2eUM.js";import{R as f}from"./validator-B8pIxTAL.js";import{d as J,r as k,p as M,n as A,h as E,b as m,o as P,c as G,e as s,w as i,u as a,k as n,t as p,f as h,j as K,s as j,M as r,_ as H}from"./index-C4AMdMz2.js";const O={class:"base-info-item"},F={class:"form-item-view"},Q=J({__name:"kanjia-activity-edit-goods",setup(z){const _=k(),v=M(),y=A(),{onlyView:T}=v.query,u=T==="true",t=k({goodsName:"",rangeTime:[],startTime:"",endTime:"",skuId:0,settlementPrice:"",lowestPrice:"",stock:"",highestPrice:"",goodsSku:{storeName:"",price:"",quantity:""}});async function V(){const d=await D(v.query.id);d.data.success&&(t.value=d.data.result,t.value.rangeTime=[],t.value.rangeTime.push(new Date(t.value.startTime),new Date(t.value.endTime)))}function x(){V()}E(()=>{x()});async function N(){var l;if(!await((l=_.value)==null?void 0:l.validate())){const e=JSON.parse(JSON.stringify(t.value));if(t.value.rangeTime.length<=0){r.warning("请选择活动时间");return}if(e.startTime=t.value.startTime,e.endTime=t.value.endTime,delete e.rangeTime,e.stock<=0||e.stock>e.goodsSku.quantity){r.error("活动库存不能为0且不能超过商品库存");return}if(!g.test(e.settlementPrice)){r.error("结算价格金额格式不正确");return}if(e.settlementPrice<0||e.settlementPrice>e.price){r.error("结算价格金额不能为0且不能超过商品价格");return}if(!g.test(e.highestPrice)){r.error("最高可砍金额格式错误");return}if(e.highestPrice<=0||e.highestPrice>e.price){r.error("最高可砍金额不能为0且不能超过商品价格");return}if(!g.test(e.lowestPrice)){r.error("最低可砍金额格式错误");return}if(e.lowestPrice<=0||e.lowestPrice>e.price){r.error("最低可砍金额不能为0");return}if(e.lowestPrice>e.highestPrice){r.error("最低砍价金额不能大于最高砍价金额");return}(await B(e)).data.success&&(r.success("砍价活动修改成功"),y.push({name:"bargain-activity"}))}}function S(){y.push({name:"bargain-activity"})}function C(d){const[l,e]=d;t.value.startTime=w(l.substring(0,10)),t.value.endTime=w(e.substring(0,10))}return(d,l)=>{const e=m("a-form-item"),c=m("a-input-number"),R=m("a-range-picker"),b=m("a-button"),U=m("a-form"),q=m("a-card");return P(),G("div",null,[s(q,{style:{width:"100%"}},{default:i(()=>[s(U,{ref_key:"formRef",ref:_,model:a(t),style:{width:"600px"}},{default:i(()=>[n("div",O,[n("div",F,[l[7]||(l[7]=n("h4",null,"商品信息",-1)),s(e,{label:"商品名称"},{default:i(()=>[n("div",null,p(a(t).goodsName),1)]),_:1}),s(e,{label:"SKU编码"},{default:i(()=>[n("div",null,p(a(t).skuId),1)]),_:1}),s(e,{label:"店铺名称"},{default:i(()=>[n("div",null,p(a(t).goodsSku.storeName),1)]),_:1}),s(e,{label:"商品价格"},{default:i(()=>[n("div",null,p(a(I)(a(t).goodsSku.price,"¥")),1)]),_:1}),s(e,{label:"商品库存"},{default:i(()=>[n("div",null,p(a(t).goodsSku.quantity),1)]),_:1}),s(e,{field:"settlementPrice",label:"结算价格",rules:[a(f)]},{default:i(()=>[s(c,{modelValue:a(t).settlementPrice,"onUpdate:modelValue":l[0]||(l[0]=o=>a(t).settlementPrice=o),disabled:u,style:{width:"260px"},class:"input-demo","allow-clear":""},null,8,["modelValue"])]),_:1},8,["rules"]),s(e,{field:"lowestPrice",label:"最低可砍",rules:[a(f)]},{default:i(()=>[s(c,{modelValue:a(t).lowestPrice,"onUpdate:modelValue":l[1]||(l[1]=o=>a(t).lowestPrice=o),disabled:u,style:{width:"260px"},class:"input-demo","allow-clear":""},null,8,["modelValue"])]),_:1},8,["rules"]),s(e,{field:"highestPrice",label:"最高可砍",rules:[a(f)]},{default:i(()=>[s(c,{modelValue:a(t).highestPrice,"onUpdate:modelValue":l[2]||(l[2]=o=>a(t).highestPrice=o),disabled:u,style:{width:"260px"},class:"input-demo","allow-clear":""},null,8,["modelValue"])]),_:1},8,["rules"]),s(e,{field:"stock",label:"活动库存",rules:[a(f)]},{default:i(()=>[s(c,{modelValue:a(t).stock,"onUpdate:modelValue":l[3]||(l[3]=o=>a(t).stock=o),disabled:u,style:{width:"260px"},class:"input-demo","allow-clear":""},null,8,["modelValue"])]),_:1},8,["rules"]),s(e,{field:"rangeTime",label:"活动时间",rules:[a(f)]},{default:i(()=>[s(R,{modelValue:a(t).rangeTime,"onUpdate:modelValue":l[4]||(l[4]=o=>a(t).rangeTime=o),disabled:u,style:{width:"254px","margin-bottom":"20px"},onChange:C},null,8,["modelValue"])]),_:1},8,["rules"]),n("div",null,[s(b,{style:{"margin-right":"5px"},onClick:S},{default:i(()=>l[5]||(l[5]=[h(" 返回 ")])),_:1}),u?j("",!0):(P(),K(b,{key:0,type:"primary",onClick:N},{default:i(()=>l[6]||(l[6]=[h(" 提交 ")])),_:1}))])])])]),_:1},8,["model"])]),_:1})])}}}),Z=H(Q,[["__scopeId","data-v-60ce23ce"]]);export{Z as default};
