import{Q as $,R as B,S as v}from"./promotion-ChRoyrm_.js";import{u as O}from"./useCurrentInstance-BLlvmEjv.js";import{ah as S}from"./tools-BfzgO_2s.js";import{U as A,V as F}from"./dist-PezRi_EG.js";import{d as L,n as U,r as f,b as g,o as l,j as T,w as o,e as b,u as n,f as c,t as C,k as j,c as D,F as q,i as E,s as _,M as k}from"./index-C4AMdMz2.js";const W=L({__name:"list",setup(H){var y;const u=(y=O().globalProperties)==null?void 0:y.$modal,x=U(),r=f(),h=f("START"),i=f({sort:"startTime",promotionStatus:h.value}),R=[{label:"活动名称",model:"promotionName",disabled:!1,input:!0},{label:"活动状态",model:"promotionStatus",disabled:!1,select:{options:S}},{label:"活动时间",model:"selectDate",disabled:!1,datePicker:{type:"range"}}],V=[{title:"活动名称",dataIndex:"promotionName",width:250},{title:"活动时间",dataIndex:"time",width:400,slot:!0,slotTemplate:"time"},{title:"活动商品",dataIndex:"goods",width:250,slot:!0,slotTemplate:"goods"},{title:"活动状态",dataIndex:"promotionStatus",slot:!0,slotData:{badge:S}}],I={title:"操作",width:240,methods:[{title:"查看",callback:"view",slot:!0,slotTemplate:"view"},{title:"关闭",callback:"close",slot:!0,slotTemplate:"close"},{title:"删除",callback:"delete",slot:!0,slotTemplate:"delete"}]};function N(s){u.confirm({title:"确认删除",content:"确认删除此活动吗?",alignCenter:!1,onOk:async()=>{B(s.id).then(e=>{e.data.success&&(k.success("删除成功"),r.value.init())})}})}function M(s,e){const a={onlyView:!0,id:s.id};x.push({name:"minus-detail",query:a})}function P(s){let e="开启";if(s.promotionStatus==="START")e="关闭",u.confirm({title:"提示",content:`确认${e}此活动吗?需要一定时间才能生效，请耐心等待`,alignCenter:!1,onOk:async()=>{(await v(s.id)).data.success&&(k.success(`${e}成功`),r.value.init())}});else{const a=new Date;a.setMinutes(a.getMinutes()+10);const m=new Date(new Date().setHours(0,0,0,0)+24*60*60*1e3-1),d={startTime:a.getTime(),endTime:m.getTime()};u.confirm({title:"确认开启(默认为当前时间的十分钟之后)",content:"您确认要开启此拼团活动?",alignCenter:!1,onOk:async()=>{(await v(s.id,d)).data.success&&(k.success("开启活动成功"),r.value.init())}})}}return(s,e)=>{const a=g("a-image"),m=g("a-button"),d=g("a-card");return l(),T(d,{class:"general-card",title:"直降活动",bordered:!1},{default:o(()=>[b(n(A),{columns:R,"time-type":"timestamp",onReset:e[0]||(e[0]=t=>{i.value={...n(i),...t}}),onSearch:e[1]||(e[1]=t=>{i.value={...n(i),...t}})}),b(n(F),{ref_key:"tablePageRef",ref:r,columns:V,methods:I,api:n($),"api-params":n(i),bordered:!0,onDelete:N},{time:o(({data:t})=>[c(C(t.startTime),1),e[2]||(e[2]=j("span",{style:{margin:"0 10px"}},"-",-1)),c(C(t.endTime),1)]),goods:o(({data:t})=>[(l(!0),D(q,null,E(t.groupImages.split(","),(p,w)=>(l(),D("span",{key:w},[w<5?(l(),T(a,{key:0,width:"50",height:"50",src:p,"show-loader":"",style:{"margin-right":"5px"}},null,8,["src"])):_("",!0)]))),128))]),view:o(({data:t})=>[b(m,{type:"text",status:"success",onClick:p=>M(t,"onlyView")},{default:o(()=>e[3]||(e[3]=[c(" 查看 ")])),_:2},1032,["onClick"])]),close:o(({data:t})=>[t.promotionStatus==="START"?(l(),T(m,{key:0,type:"text",status:"danger",onClick:p=>P(t)},{default:o(()=>e[4]||(e[4]=[c(" 关闭 ")])),_:2},1032,["onClick"])):_("",!0)]),_:1},8,["api","api-params"])]),_:1})}}});export{W as default};
