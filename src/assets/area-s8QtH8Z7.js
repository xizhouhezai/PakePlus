import{z as te,_ as a}from"./zone-qPPsiPcO.js";import{_ as oe,t as ne}from"./choose.vue_vue_type_script_setup_true_lang-DqoWK00k.js";import{_ as ie,r as z,aw as se,b as I,v as ae,o as c,c as u,e as p,w as v,k as s,x as M,F as L,i as O,t as w,s as D,f as E,j as re,ak as le,N as de}from"./index-C4AMdMz2.js";import"./list.vue_vue_type_script_setup_true_lang-CT5uXx_7.js";import"./goods-CB7YWqUH.js";import"./useCurrentInstance-BLlvmEjv.js";import"./tools-BfzgO_2s.js";import"./dist-PezRi_EG.js";import"./classifyModel-DKDTUTay.js";import"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./validator-B8pIxTAL.js";import"./extra-5DUayDl9.js";import"./list-B_2PUvsr.js";import"./index.vue_vue_type_script_setup_true_lang-dUoIkT7B.js";import"./operation-CQQGRn8-.js";import"./index-0p7N2Gug.js";import"./style-CFU4ZMck.js";import"./design-list-BE956Dvq.js";import"./other-BdeW1aaV.js";import"./all-BUr7x5Dn.js";import"./index-Dg8m97qn.js";import"./shops-fXVW_gE8.js";const _e={"border-b-1":"","py-30px":""},ce={key:0},ue={key:0,"py-8px":""},fe={"h-600px":""},pe={"h-600px":"",flex:"","gap-10px":""},he={class:"box box-left",rounded:""},me={relative:""},ve=["src"],ge={key:0,class:"hz-m-area"},Ie={class:"box box-right",relative:"",rounded:""},we={"h-360px":"","overflow-y-auto":""},ke={flex:"","flex-j-sb":"","flex-a-c":""},ye=["onClick"],xe={key:0},Pe={key:1},ze={absolute:"","bottom-0":"","w-full":""},be={__name:"area",props:{res:{type:null,default:""},max:{type:null,default:""}},emits:["overRange"],setup(R,{emit:T}){const o=R,V=T,k=z(!1);se("area-reload",k);const X={mounted(e){const t=a.MIN_LIMIT;e.addEventListener("mousedown",f,{passive:!1});function f(i){i==null||i.preventDefault();let n={top:a.getDistanceY(i,e),left:a.getDistanceX(i,e),width:0,height:0};const r=a.getOffset(e),$={topPer:a.decimalPoint(n.top/r.height),leftPer:a.decimalPoint(n.left/r.width),widthPer:0,heightPer:0};let x=a.getPageX(i),P=a.getPageY(i);Z($),window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("mouseup",_,{passive:!1});function l(d){d==null||d.preventDefault();const Q=a.getPageX(d)-x,W=a.getPageY(d)-P;x=a.getPageX(d),P=a.getPageY(d);const ee=a.dealBR(n,Q,W,0);n=a.dealEdgeValue(n,ee,r,o.res.data.list[0].zoneInfo),Object.assign(e.lastElementChild.style,{top:`${n.top}px`,left:`${n.left}px`,width:`${n.width}px`,height:`${n.height}px`})}function _(){const d={topPer:a.decimalPoint(n.top/r.height),leftPer:a.decimalPoint(n.left/r.width),widthPer:a.decimalPoint(n.width/r.width),heightPer:a.decimalPoint(n.height/r.height)};H()?K():r.height<t&&n.width>t?C(Object.assign(d,{topPer:0,heightPer:1})):r.width<t&&n.height>t?C(Object.assign(d,{leftper:0,widthPer:1})):n.width>t&&n.height>t?C(d):U(),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",_)}}e.$destroy=()=>e.removeEventListener("mousedown",f)},unmounted(e){e.$destroy()}},h=z(""),N=z(null),y=z(!1);function Y(){y.value=!0}function B(e){o.res.data.list[0].zoneInfo.splice(e,1)}function A(){y.value=!1}function S(e){var n;const{info:t,index:f}=e;Object.assign(o.res.data.list[0].zoneInfo[f],t);const i=de();(n=i==null?void 0:i.proxy)==null||n.$forceUpdate(),setTimeout(()=>{k.value=!1},0)}function b(e){return e>=1e4?e/1e5:e>=1e3?e/1e4:e>=100?e/1e3:e>=10?e/100:0}async function F(){const e={topPer:.15,leftPer:.3,widthPer:.2,heightPer:.2},t=await J(o.res.data.list[0].img);t&&(t.height>=1e3?e.heightPer=b(t.height)/(t.height/1e3):e.heightPer=b(t.height),e.widthPer=b(t.width)/2),o.res.data.list[0].zoneInfo.push(e)}function j(e){var t;h.value=e,(t=N.value)==null||t.open()}function J(e){return new Promise((t,f)=>{const i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.onerror=function(){f(new Error("error"))},i.src=e})}function U(e=o.res.data.list[0].zoneInfo.length-1){o.res.data.list[0].zoneInfo.splice(e,1)}function Z(e){o.res.data.list[0].zoneInfo.push(e)}function H(){return o.max&&o.res.data.list[0].zoneInfo.length>o.max}function K(){const e=o.res.data.list[0].zoneInfo.value.length-1;o.res.data.list[0].zoneInfo.splice(e,1),V("overRange",e)}function C(e){const t=o.res.data.list[0].zoneInfo.length-1;Object.assign(o.res.data.list[0].zoneInfo[t],e)}function g(){return o.res.data.list[0].zoneInfo[h.value].___key}function m(){return o.res.data.list[0].zoneInfo[h.value].___value}function q(e,t){switch(e){case"goods":return{id:t.id,goodsId:t.goodsId,___type:e,___key:g(),___value:m()};case"category":return{id:t.id,___type:e,___key:g(),___value:m()};case"shops":return{id:t.id,___type:e,___key:g(),___value:m()};case"marketing":return{id:t.skuId,goodsId:t.goodsId,___type:e,___key:"",___value:m()};case"pages":return{id:t.skuId,goodsId:t.goodsId,___type:e,___key:g(),___value:m()};case"special":return{id:t.id,___type:e,___key:g(),___value:m()};case"other":return{title:t.label,___type:e,___key:g(),___value:m()}}}function G(e){le(()=>{var n;const t=e.___type,i={...JSON.parse(JSON.stringify(o.res.data.list[0].zoneInfo[h.value])),...q(t,e)};o.res.data.list[0].zoneInfo[h.value]=i,o.res.data.list[0].zoneInfo[h.value].___value=t,o.res.data.list[0].zoneInfo[h.value].___type=(n=ne.find(r=>(o.res.data.list[0].zoneInfo[h.value].___key=e[r._bind],r.value===t)))==null?void 0:n.label})}return(e,t)=>{const f=I("a-button"),i=I("a-space"),n=I("icon-edit"),r=I("a-tooltip"),$=I("icon-delete"),x=I("a-modal"),P=ae("auto-animate");return c(),u("div",_e,[p(i,{"w-100vw":""},{default:v(()=>[t[5]||(t[5]=s("div",{"w-90px":""}," 添加热区 ",-1)),s("div",null,[M((c(),u("div",null,[o.res.data.list[0].zoneInfo.length?(c(),u("div",ce,[(c(!0),u(L,null,O(o.res.data.list[0].zoneInfo,(l,_)=>(c(),u("div",{key:_},[l.___type?(c(),u("div",ue,[s("span",null,w(l.___type),1),s("span",null,"-"+w(l.___key),1)])):D("",!0)]))),128))])):D("",!0),p(f,{"mt-10px":"",hoverable:!1,onClick:t[0]||(t[0]=l=>Y())},{default:v(()=>t[4]||(t[4]=[E(" 添加/修改热区 ")])),_:1})])),[[P]])])]),_:1}),p(x,{visible:y.value,width:1400,"unmount-on-close":"",onOk:A,onCancel:t[3]||(t[3]=l=>y.value=!1)},{title:v(()=>t[6]||(t[6]=[E(" 绘制热区 ")])),default:v(()=>[s("div",fe,[s("div",pe,[s("div",he,[s("div",me,[s("img",{"max-h-500px":"","max-w-full":"",class:"hz-u-img",src:o.res.data.list[0].img},null,8,ve),k.value?D("",!0):M((c(),u("ul",ge,[(c(!0),u(L,null,O(o.res.data.list[0].zoneInfo,(l,_)=>(c(),re(te,{ref_for:!0,ref:`zone${_}`,key:_,class:"hz-m-item",res:o.res.data.list[0].zoneInfo,setting:l,index:_,onReloadOn:t[1]||(t[1]=d=>k.value=!0),onChangeInfo:S},null,8,["res","setting","index"]))),128))])),[[X]])])]),s("div",Ie,[s("div",we,[(c(!0),u(L,null,O(o.res.data.list[0].zoneInfo,(l,_)=>(c(),u("div",{key:_,"p-8px":""},[s("div",ke,[s("div",null,[s("span",null,w(_+1),1),s("span",{"ml-10px":"","cursor-pointer":"",onClick:d=>j(_)},[l.___type?(c(),u("span",Pe,[s("span",null,w(l.___type),1),s("span",null,"-"+w(l.___key),1)])):(c(),u("span",xe,"请选择链接"))],8,ye)]),s("div",null,[p(r,{content:"修改"},{default:v(()=>[p(n,{"cursor-pointer":"",onClick:d=>j(_)},null,8,["onClick"])]),_:2},1024),p(r,{content:"删除"},{default:v(()=>[p($,{"ml-16px":"","cursor-pointer":"",onClick:d=>B(_)},null,8,["onClick"])]),_:2},1024)])])]))),128))]),s("div",ze,[p(f,{type:"outline",long:"",onClick:t[2]||(t[2]=l=>F())},{default:v(()=>t[7]||(t[7]=[E(" 添加热区 ")])),_:1})])])])])]),_:1},8,["visible"]),p(oe,{ref_key:"decide",ref:N,res:o.res,onCallback:G},null,8,["res"])])}}},Qe=ie(be,[["__scopeId","data-v-34309d51"]]);export{Qe as default};
