import{b as X,c as O,r as Y,d as M,f as Z,p as _,h}from"./saas-C7moPfYT.js";import{u as ee}from"./useCurrentInstance-BLlvmEjv.js";import{aq as N,ar as te}from"./tools-BfzgO_2s.js";import{U as ne,V as oe}from"./dist-PezRi_EG.js";import{d as ae,r as f,b as d,o as x,j as D,w as t,e as o,u as r,f as a,k as u,t as S,s as le,q as E,c as se,F as ie,i as de,M as b,_ as re}from"./index-C4AMdMz2.js";const ue={class:""},pe=ae({__name:"separateMp",setup(me){var T;const V=(T=ee().globalProperties)==null?void 0:T.$modal,B=[{label:"小程序名称",model:"name",disabled:!1,input:!0},{label:"小程序ID",model:"echoAppid",disabled:!1,input:!0},{label:"店铺ID",model:"storeId",disabled:!1,input:!0},{label:"小程序状态",model:"mpPublishStatus",disabled:!1,select:{options:N}},{label:"法人姓名",model:"legalPersonaName",disabled:!1,input:!0}],c=f({sort:"createTime",order:"desc"}),p=f(""),L=[{title:"企业名称",dataIndex:"name",width:150},{title:"小程序ID",dataIndex:"echoAppid",width:180},{title:"法人姓名",dataIndex:"legalPersonaName",width:100},{title:"店铺",dataIndex:"storeId",width:250,slot:!0,slotTemplate:"storeId"},{title:"小程序状态",dataIndex:"mpPublishStatus",width:110,slot:!0,slotData:{badge:N}},{title:"生产环境模板ID",dataIndex:"templateCode",width:140},{title:"试用环境模板ID",dataIndex:"auditTemplateCode",width:140},{title:"审核状态",dataIndex:"auditStatus",width:120,slot:!0,slotData:{badge:te}},{title:"错误消息",dataIndex:"auditReason",width:150}],U={title:"操作",width:150,methods:[{slot:!0,slotTemplate:"action"}]},v=f([]),R=f([]),m=f(!1),A=f([]),g=f("");async function P(l,e){const s=[];v.value.forEach(i=>{s.push(i.id)}),v.value&&v.value.length?await l(s).then(i=>{i.data.success&&(b.success("操作成功"),p.value.init())}):V.confirm({title:"提示",content:e,onOk:async()=>{await l(s).then(i=>{i.data.success&&(b.success("操作成功"),p.value.init())})}})}function q(l){let e=[];l?e=[l.id]:v.value.forEach(s=>{e.push(s.id)}),R.value=e,e&&e.length?(m.value=!0,O().then(s=>{s.data.success&&(A.value=s.data.result)})):V.confirm({title:"未勾选指定小程序，确认重新发布所有小程序的版本",content:"",onOk:async()=>{m.value=!0,O().then(s=>{s.data.success&&(A.value=s.data.result)})}})}function F(){if(!g.value)return b.error("请先选择版本"),!1;Y({code:g.value,ids:R.value}).then(l=>{l.data.success&&(m.value=!1,b.success("发布成功"),p.value.init())})}function $(l){let e=[];l?e=[l.id]:v.value.forEach(s=>{e.push(s.id)}),e&&e.length?M(e).then(s=>{s.data.success&&(b.success("操作成功"),p.value.init())}):V.confirm({title:"未勾选指定小程序，确认更新所有小程序的版本信息",content:"",onOk:async()=>{M(e).then(s=>{s.data.success&&(b.success("操作成功"),p.value.init())})}})}function j(l){Z({storeId:l.storeId}).then(()=>{p.value.init()})}function H(l){switch(l){case"apiReset":P(h,"未勾选指定小程序，确认重新发布所有小程序的 API 地址");break;case"privacyReset":P(_,"未勾选指定小程序，确认重新发布所有小程序的隐私协议");break;case"releaseSelect":q();break;case"syncVersionInfo":$();break}}function w(l){window.open(l)}function W(l){v.value=l}return(l,e)=>{const s=d("icon-down"),i=d("a-button"),k=d("a-link"),y=d("a-popover"),C=d("a-doption"),z=d("a-dropdown"),G=d("a-radio"),J=d("a-radio-group"),K=d("a-modal"),Q=d("a-card");return x(),D(Q,{class:"general-card",title:"小程序",bordered:!1},{default:t(()=>[o(r(ne),{columns:B,onReset:e[0]||(e[0]=n=>{c.value={...r(c),...n}}),onSearch:e[1]||(e[1]=n=>{c.value={...r(c),...n}})}),o(z,{onSelect:H},{content:t(()=>[o(C,{value:"apiReset"},{default:t(()=>[o(y,{position:"right"},{content:t(()=>[e[11]||(e[11]=a(" 重置小程序 API 地址，选中小程序则更新指定小程序，")),e[12]||(e[12]=u("br",null,null,-1)),e[13]||(e[13]=a("如不选中，则重置所有小程序。 ")),o(k,{onClick:e[2]||(e[2]=n=>w("https://developers.weixin.qq.com/doc/oplatform/openApi/OpenApiDoc/miniprogram-management/domain-management/modifyServerDomainDirectly.html"))},{default:t(()=>e[10]||(e[10]=[a(" 接口地址 ")])),_:1})]),default:t(()=>[e[14]||(e[14]=u("div",null,"API地址更新",-1))]),_:1})]),_:1}),o(C,{value:"privacyReset"},{default:t(()=>[o(y,{position:"right"},{content:t(()=>[e[16]||(e[16]=a(" 重置小程序 隐私协议 地址，选中小程序则更新指定小程序，")),e[17]||(e[17]=u("br",null,null,-1)),e[18]||(e[18]=a("如不选中，则发布所有小程序。 ")),o(k,{onClick:e[3]||(e[3]=n=>w("https://developers.weixin.qq.com/doc/oplatform/openApi/OpenApiDoc/miniprogram-management/privacy-management/setPrivacySetting.html"))},{default:t(()=>e[15]||(e[15]=[a(" 接口地址 ")])),_:1})]),default:t(()=>[e[19]||(e[19]=u("div",null,"隐私协议更新",-1))]),_:1})]),_:1}),o(C,{value:"releaseSelect"},{default:t(()=>[o(y,{position:"right"},{content:t(()=>[e[21]||(e[21]=a(" 选择版本发布小程序，选中小程序则发布指定版本指定小程序，")),e[22]||(e[22]=u("br",null,null,-1)),e[23]||(e[23]=a("如不选中，则重置所有小程序。 ")),o(k,{onClick:e[4]||(e[4]=n=>w("https://developers.weixin.qq.com/doc/oplatform/openApi/OpenApiDoc/miniprogram-management/code-management/commit.html"))},{default:t(()=>e[20]||(e[20]=[a(" 接口地址 ")])),_:1})]),default:t(()=>[e[24]||(e[24]=u("div",null,"选择版本发布",-1))]),_:1})]),_:1}),o(C,{value:"syncVersionInfo"},{default:t(()=>[o(y,{position:"right"},{content:t(()=>[e[26]||(e[26]=a(" 更新小程序版本信息，选中小程序则更新指定小程序，如不选中，")),e[27]||(e[27]=u("br",null,null,-1)),e[28]||(e[28]=a("则重置所有小程序。 ")),o(k,{onClick:e[5]||(e[5]=n=>w("https://developers.weixin.qq.com/doc/oplatform/openApi/OpenApiDoc/miniprogram-management/code-management/getVersionInfo.html"))},{default:t(()=>e[25]||(e[25]=[a(" 接口地址 ")])),_:1})]),default:t(()=>[e[29]||(e[29]=u("div",null,"更新版本信息",-1))]),_:1})]),_:1})]),default:t(()=>[o(i,{"mb-10px":""},{default:t(()=>[e[9]||(e[9]=a(" 扩展操作 ")),o(s)]),_:1})]),_:1}),o(r(oe),{ref_key:"tablePageRef",ref:p,columns:L,methods:U,api:r(X),"api-params":r(c),bordered:!0,checkbox:!0,onSelectTableChange:W},{storeId:t(({data:n})=>[o(k,{onClick:I=>l.$openWindow({name:"shop-detail",query:{id:n.storeId,type:"STORE"}})},{default:t(()=>[a(S(n.storeName),1)]),_:2},1032,["onClick"])]),action:t(({data:n})=>[n.auditStatus&&n.auditStatus===2?(x(),D(i,{key:0,type:"text",status:"warning",onClick:I=>j(n)},{default:t(()=>e[30]||(e[30]=[a(" 撤回申请 ")])),_:2},1032,["onClick"])):le("",!0),o(i,{type:"text",status:"success",onClick:I=>q(n)},{default:t(()=>e[31]||(e[31]=[a(" 选择版本发布 ")])),_:2},1032,["onClick"]),o(i,{type:"text",onClick:I=>$(n)},{default:t(()=>e[32]||(e[32]=[a(" 更新版本信息 ")])),_:2},1032,["onClick"])]),_:1},8,["api","api-params"]),o(K,{visible:r(m),"onUpdate:visible":e[8]||(e[8]=n=>E(m)?m.value=n:null),width:"800px"},{title:t(()=>e[33]||(e[33]=[a(" 选择模板 ")])),footer:t(()=>[o(i,{onClick:e[7]||(e[7]=n=>m.value=!1)},{default:t(()=>e[34]||(e[34]=[a(" 取消 ")])),_:1}),o(i,{type:"primary",onClick:F},{default:t(()=>e[35]||(e[35]=[a(" 确定 ")])),_:1})]),default:t(()=>[u("div",ue,[o(J,{modelValue:r(g),"onUpdate:modelValue":e[6]||(e[6]=n=>E(g)?g.value=n:null)},{default:t(()=>[(x(!0),se(ie,null,de(r(A),(n,I)=>(x(),D(G,{key:I,value:n.id,"my-6px":""},{default:t(()=>[a(S(n.id)+"---"+S(n.name)+"---"+S(n.remark),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["visible"])]),_:1})}}}),ke=re(pe,[["__scopeId","data-v-b2730245"]]);export{ke as default};
