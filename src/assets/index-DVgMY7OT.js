import{d as F,r as b,a as G,b as s,o as _,j as J,w as o,e as l,u as a,f as u,ba as K,k as i,t as f,c as g,s as N,q as X,bb as Y,bc as Z,M as O,bd as h}from"./index-C4AMdMz2.js";import{u as ee}from"./useCurrentInstance-BLlvmEjv.js";import{al as te}from"./tools-BfzgO_2s.js";import{R as y,V as U}from"./validator-B8pIxTAL.js";import{U as ae,V as oe}from"./dist-PezRi_EG.js";const le={key:0},ne={key:1},re={key:0},de={key:1},se={style:{"text-align":"right"}},be=F({__name:"index",setup(ie){var A;const p=b({}),V=b(),w=b(""),x=b(),c=b(!1),S=(A=ee().globalProperties)==null?void 0:A.$modal,C=[{label:"系统类型",model:"type",disabled:!1,select:{options:te}}],M=[{title:"版本名称",dataIndex:"versionName"},{title:"版本号",dataIndex:"version"},{title:"强制更新",dataIndex:"forceUpdate",width:150,slot:!0,slotTemplate:"forceUpdate"},{title:"类型",dataIndex:"type",slot:!0,slotTemplate:"type"},{title:"更新时间",dataIndex:"versionUpdateDate"}],P={title:"操作",width:300,fixed:"right",methods:[{title:"查看",callback:"detail",type:"text",status:"success"},{title:"修改",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},t=G({enableAddModal:!1,formLoading:!1,fid:"",form:{versionName:"",version:"",forceUpdate:!1,type:"IOS",downloadUrl:"",content:"",versionUpdateDate:""}});function E(){t.enableAddModal=!0,w.value="添加APP版本信息",t.fid="",Object.keys(t.form).forEach(d=>{t.form[d]=""}),t.form={versionName:"",version:"",forceUpdate:!1,type:"IOS",downloadUrl:"",content:"",versionUpdateDate:""}}async function T(){var e;if(!await((e=x.value)==null?void 0:e.validate())){let m;t.fid?m=await Z(t.fid,t.form):m=await Y(t.form),m.data.success&&(O.success(`${t.fid?"修改":"添加"}成功!`),t.enableAddModal=!1,V.value.init())}}function j(d){w.value="编辑",d&&(Object.keys(t.form).forEach(e=>{d.record[e]&&(t.form[e]=d.record[e])}),t.fid=d.record.id,t.enableAddModal=!0)}function B(d){S.confirm({title:"确认删除",content:"您确认要删除么?",alignCenter:!1,onOk:async()=>{(await h(d.record.id)).data.success&&(O.success("删除成功"),V.value.init())}})}function $(d){console.error(d),t.form=d.record,c.value=!0}return(d,e)=>{const m=s("a-button"),L=s("a-space"),W=s("a-col"),q=s("a-row"),k=s("a-input"),r=s("a-form-item"),z=s("a-date-picker"),v=s("a-radio"),D=s("a-radio-group"),H=s("a-textarea"),I=s("a-form"),R=s("a-modal"),Q=s("a-card");return _(),J(Q,{class:"general-card",title:"APP版本",bordered:!1},{default:o(()=>[l(a(ae),{columns:C,onReset:e[0]||(e[0]=n=>{p.value={...a(p),...n}}),onSearch:e[1]||(e[1]=n=>{p.value={...a(p),...n}})}),l(q,{style:{"margin-bottom":"16px"}},{default:o(()=>[l(W,{span:16},{default:o(()=>[l(L,null,{default:o(()=>[l(m,{type:"primary",onClick:E},{default:o(()=>e[12]||(e[12]=[u(" 添加 ")])),_:1})]),_:1})]),_:1})]),_:1}),l(a(oe),{ref_key:"tablePageRef",ref:V,columns:M,methods:P,api:a(K),"api-params":a(p),bordered:!0,onDelete:B,onEditor:j,onDetail:$},{forceUpdate:o(({data:n})=>[i("span",null,f(n.forceUpdate===!1?"非强制":"强制"),1)]),type:o(({data:n})=>[i("span",null,f(n.type==="IOS"?"苹果":"安卓"),1)]),_:1},8,["api","api-params"]),l(R,{visible:a(t).enableAddModal,"onUpdate:visible":e[9]||(e[9]=n=>a(t).enableAddModal=n),"align-center":!1,footer:!1},{title:o(()=>[u(f(a(w)),1)]),default:o(()=>[l(I,{ref_key:"formRef",ref:x,model:a(t).form,onSubmit:T},{default:o(()=>[l(r,{field:"versionName",label:"版本名称",rules:[a(y),a(U)],"validate-trigger":["change"]},{default:o(()=>[l(k,{modelValue:a(t).form.versionName,"onUpdate:modelValue":e[2]||(e[2]=n=>a(t).form.versionName=n)},null,8,["modelValue"])]),_:1},8,["rules"]),l(r,{field:"version",label:"版本号",rules:[a(y),a(U)],"validate-trigger":["change"]},{extra:o(()=>e[13]||(e[13]=[i("span",null,"在移动端项目->manifest.json->基础配置->应用版本名称中查看",-1)])),default:o(()=>[l(k,{modelValue:a(t).form.version,"onUpdate:modelValue":e[3]||(e[3]=n=>a(t).form.version=n)},null,8,["modelValue"])]),_:1},8,["rules"]),l(r,{field:"versionUpdateDate",label:"更新时间",rules:[a(y),a(U)],"validate-trigger":["change"]},{default:o(()=>[l(z,{modelValue:a(t).form.versionUpdateDate,"onUpdate:modelValue":e[4]||(e[4]=n=>a(t).form.versionUpdateDate=n),"show-time":"",style:{width:"200px"}},null,8,["modelValue"])]),_:1},8,["rules"]),l(r,{field:"forceUpdate",label:"强制更新","validate-trigger":["change"]},{extra:o(()=>[a(t).form.forceUpdate?(_(),g("span",le,"强制更新即为应用中必须更新此版本。不更新则无法继续使用App")):N("",!0),a(t).form.forceUpdate?N("",!0):(_(),g("span",ne,"非强制更新为应用中推荐更新此版本。不更新还可以继续使用"))]),default:o(()=>[l(D,{modelValue:a(t).form.forceUpdate,"onUpdate:modelValue":e[5]||(e[5]=n=>a(t).form.forceUpdate=n),type:"button"},{default:o(()=>[l(v,{value:!0},{default:o(()=>e[14]||(e[14]=[u(" 强制更新 ")])),_:1}),l(v,{value:!1},{default:o(()=>e[15]||(e[15]=[u(" 非强制更新 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{field:"type",label:"系统类型"},{default:o(()=>[l(D,{modelValue:a(t).form.type,"onUpdate:modelValue":e[6]||(e[6]=n=>a(t).form.type=n),type:"button"},{default:o(()=>[l(v,{value:"IOS"},{default:o(()=>e[16]||(e[16]=[u(" 苹果 ")])),_:1}),l(v,{value:"ANDROID"},{default:o(()=>e[17]||(e[17]=[u(" 安卓 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{field:"downloadUrl",label:"下载地址",rules:[a(y),a(U)],"validate-trigger":["change"]},{extra:o(()=>[a(t).form.type==="IOS"?(_(),g("span",re,"AppStore中App项目下载目录。可从下载App页面点击分享，拷贝链接")):(_(),g("span",de,"安卓该链接为应用的下载地址"))]),default:o(()=>[l(k,{modelValue:a(t).form.downloadUrl,"onUpdate:modelValue":e[7]||(e[7]=n=>a(t).form.downloadUrl=n)},null,8,["modelValue"])]),_:1},8,["rules"]),l(r,{field:"content",label:"更新内容","validate-trigger":["change"]},{default:o(()=>[l(H,{modelValue:a(t).form.content,"onUpdate:modelValue":e[8]||(e[8]=n=>a(t).form.content=n),"max-length":100,"allow-clear":"","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(r,{label:"操作"},{default:o(()=>[l(m,{loading:a(t).formLoading,"html-type":"submit",type:"primary"},{default:o(()=>e[18]||(e[18]=[u(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),l(R,{visible:a(c),"onUpdate:visible":e[11]||(e[11]=n=>X(c)?c.value=n:null),"align-center":!1},{title:o(()=>e[19]||(e[19]=[u(" 查看 ")])),footer:o(()=>[i("div",se,[l(m,{type:"text",onClick:e[10]||(e[10]=n=>c.value=!1)},{default:o(()=>e[20]||(e[20]=[u(" 取消 ")])),_:1})])]),default:o(()=>[l(I,{ref_key:"formRef",ref:x,style:{width:"460px"},layout:"horizontal","auto-label-width":"",model:a(t).form},{default:o(()=>[l(r,{label:"版本名称："},{default:o(()=>[i("span",null,f(a(t).form.versionName),1)]),_:1}),l(r,{label:"版本号："},{default:o(()=>[i("span",null,f(a(t).form.version),1)]),_:1}),l(r,{label:"更新时间："},{default:o(()=>[i("span",null,f(a(t).form.versionUpdateDate),1)]),_:1}),l(r,{label:"强制更新："},{default:o(()=>[i("span",null,f(a(t).form.forceUpdate===!1?"非强制更新":"强制更新"),1)]),_:1}),l(r,{label:"类型："},{default:o(()=>[i("span",null,f(a(t).form.type==="IOS"?"IOS":"安卓"),1)]),_:1}),l(r,{label:"下载地址："},{default:o(()=>[i("span",null,f(a(t).form.downloadUrl),1)]),_:1}),l(r,{label:"更新内容："},{default:o(()=>[i("span",null,f(a(t).form.content),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{be as default};
