import{d as Oe,r as d,h as Te,E as Ae,b as r,o as m,c as V,e as t,w as o,u as l,q as E,F as se,i as Ee,j as U,f as i,k as S,t as h,s as y,A as Me,bj as Le,M,bk as Ne,bl as Ke,bm as Ie,_ as Pe}from"./index-C4AMdMz2.js";import{u as Be}from"./useCurrentInstance-BLlvmEjv.js";import{R as w}from"./validator-B8pIxTAL.js";const Fe={key:1},$e={style:{color:"var(--color-primary-light-4)"}},je={key:0},He={key:1},ze={key:0},Ge={key:0},qe={key:1},Qe=Oe({__name:"index",setup(Je){var X;const I=d(),O=d("MANAGER"),de=d([{label:"平台",value:"MANAGER"},{label:"商家",value:"STORE"}]),z=(X=Be().globalProperties)==null?void 0:X.$modal,G=d(),P=d(!0),F=d(""),g=d(!1),C=d(!1),s=d({}),$=d([]),L=d([]),T=d([]),j=d(""),a=d({id:"",title:"",path:"",frontRoute:"",parentId:"",sortOrder:0,level:0,permission:"",iconStr:""}),A=d(),q=d(),Q=d(1),J=d();function re(u){Q.value+=1;const e=f=>{const v=[];return f.value.forEach(R=>{if(R.title.toLowerCase().includes(u.toLowerCase()))v.push({...R});else if(R.children){J.value=R.children;const _=e(J);_.length&&v.push({...R,children:_})}}),v};return e(q)}const k=d(""),B=d(),W=d(),x=d(1);function ie(u){return k.value?u.toLowerCase().indexOf(k.value.toLowerCase()):-1}function fe(u){O.value=u,c()}async function c(){const u=await Le({version:"v3",scene:O.value});if(u.data.success){A.value=u.data.result.map(f=>(f.iconStr=f.icon,delete f.icon,f.children=f.children.map(v=>(v.iconStr=v.icon,delete v.icon,v)),f));let e=[];x.value===1&&(T.value=e),x.value===2&&(e=A.value.map(f=>f.id),T.value=e),x.value===3&&(A.value.map(f=>(e.push(f.id),f.children.map(v=>(e.push(v.id),v)))),T.value=e),q.value=A.value}}function pe(){F.value="添加顶级菜单",g.value=!1,s.value={level:0,sortOrder:0},C.value=!0}function me(){if(a.value.id===""||a.value.id===null){M.warning("请先点击选择一个菜单权限节点");return}if(F.value="添加子节点",g.value=!0,a.value.level===2){z.confirm({title:"抱歉，不能添加啦",content:"仅支持2级菜单目录",alignCenter:!1});return}s.value={parentId:a.value.id,level:Number(a.value.level)+1,sortOrder:0,permission:""},a.value.level===0&&(s.value.path="/",s.value.frontRoute="Main"),C.value=!0}function H(){c()}function ve(u,e){j.value=e.node.title,a.value=e.node}function ce(u,e){$.value=e.checkedNodes}async function _e(){var e;await((e=W.value)==null?void 0:e.validate())||(s.value.scene=O.value,s.value.icon=s.value.iconStr,Ne(s.value).then(f=>{f.data.success&&(M.success("添加成功"),C.value=!1,H())}))}function ye(){C.value=!1}function be(){if(L.value.length<=0){M.warning("您还未勾选要删除的数据");return}z.confirm({title:"确认删除",content:`您确认要删除所选的${L.value.length}条数据?`,alignCenter:!1,onOk:async()=>{let u="";$.value.forEach(v=>{u+=`${v.id},`});const e=u.substring(0,u.length-1);(await Ke(e)).data.success&&($.value=[],M.success("删除成功"),H())}})}function Ve(){B.value.resetFields(),a.value.id="",j.value="",c()}async function ke(){var e;if(!a.value.id){M.warning("请先点击选择要修改的菜单节点");return}a.value.sortOrder===null&&(a.value.sortOrder=0),a.value.icon=a.value.iconStr,delete a.value.frontComponent,delete a.value.buttonType,delete a.value.updateTime,delete a.value.selected,delete a.value.description,delete a.value.children,await((e=B.value)==null?void 0:e.validate())||Ie(a.value).then(f=>{f.data.success&&(M.success("编辑成功"),a.value.level===0&&H())})}function ge(){B.value.resetFields(),c()}function xe(u){u==="refresh"&&(x.value=1,c()),u==="expandOne"&&(x.value=1,c()),u==="expandTwo"&&(x.value=2,c()),u==="expandThree"&&(x.value=3,c()),u==="expandAll"&&(x.value=3,c())}return Te(()=>{const u=document.documentElement.clientHeight;G.value=`${Number(u-287)}px`,c()}),Ae(()=>k.value,u=>{u?A.value=re(k.value):c()}),(u,e)=>{const f=r("a-tab-pane"),v=r("a-tabs"),R=r("a-switch"),_=r("a-button"),N=r("a-doption"),we=r("a-dropdown"),Y=r("a-row"),Ce=r("a-alert"),Re=r("a-input-search"),Ue=r("a-tree"),Z=r("a-col"),D=r("icon-send"),ee=r("icon-drive-file"),p=r("a-form-item"),b=r("a-input"),K=r("a-tooltip"),le=r("a-textarea"),te=r("a-input-number"),ne=r("a-form"),Se=r("a-modal"),he=r("a-card");return m(),V("div",null,[t(he,{title:"菜单管理",class:"general-card",bordered:!1},{default:o(()=>[t(v,{modelValue:l(O),"onUpdate:modelValue":e[0]||(e[0]=n=>E(O)?O.value=n:null),onTabClick:fe},{default:o(()=>[(m(!0),V(se,null,Ee(l(de),n=>(m(),U(f,{key:n.value,title:n.label},null,8,["title"]))),128))]),_:1},8,["modelValue"]),t(Y,{class:"action"},{default:o(()=>[t(R,{modelValue:l(P),"onUpdate:modelValue":e[1]||(e[1]=n=>E(P)?P.value=n:null)},{checked:o(()=>e[20]||(e[20]=[i(" 级联 ")])),unchecked:o(()=>e[21]||(e[21]=[i(" 单选 ")])),_:1},8,["modelValue"]),t(_,{onClick:pe},{default:o(()=>e[22]||(e[22]=[i(" 添加顶级菜单 ")])),_:1}),t(_,{onClick:me},{default:o(()=>e[23]||(e[23]=[i(" 添加子菜单 ")])),_:1}),t(_,{onClick:be},{default:o(()=>e[24]||(e[24]=[i(" 批量删除 ")])),_:1}),t(we,{onSelect:xe},{content:o(()=>[t(N,{value:"refresh"},{default:o(()=>e[26]||(e[26]=[i(" 刷新 ")])),_:1}),t(N,{value:"expandOne"},{default:o(()=>e[27]||(e[27]=[i(" 收合所有 ")])),_:1}),t(N,{value:"expandTwo"},{default:o(()=>e[28]||(e[28]=[i(" 展开一级 ")])),_:1}),t(N,{value:"expandThree"},{default:o(()=>e[29]||(e[29]=[i(" 展开二级 ")])),_:1}),t(N,{value:"expandAll"},{default:o(()=>e[30]||(e[30]=[i(" 展开所有 ")])),_:1})]),default:o(()=>[t(_,null,{default:o(()=>e[25]||(e[25]=[i("更多操作")])),_:1})]),_:1})]),_:1}),t(Y,{style:{margin:"16px 0"}},{default:o(()=>[t(Z,{span:8},{default:o(()=>[t(Ce,{type:"warning"},{default:o(()=>[e[32]||(e[32]=i(" 当前选择编辑： ")),S("span",null,h(l(j)),1),l(a).id?(m(),U(_,{key:0,type:"text",onClick:Ve},{default:o(()=>e[31]||(e[31]=[i(" 取消选择 ")])),_:1})):y("",!0)]),_:1}),S("div",null,[t(Re,{modelValue:l(k),"onUpdate:modelValue":e[2]||(e[2]=n=>E(k)?k.value=n:null),style:{"margin-bottom":"8px","margin-top":"8px"},change:""},null,8,["modelValue"])]),(m(),V("div",{key:l(Q),class:"tree-bar",style:Me({maxHeight:l(G)})},[t(Ue,{"checked-keys":l(L),"onUpdate:checkedKeys":e[3]||(e[3]=n=>E(L)?L.value=n:null),"expanded-keys":l(T),"onUpdate:expandedKeys":e[4]||(e[4]=n=>E(T)?T.value=n:null),"check-strictly":!l(P),data:l(A),checkable:!0,"checked-strategy":"all","field-names":{key:"id"},onSelect:ve,onCheck:ce},{title:o(n=>{var oe,ae,ue;return[(I.value=ie(n==null?void 0:n.title))?(m(),V(se,{key:0},[i(h(n==null?void 0:n.title),1)],64)):(m(),V("span",Fe,[i(h((oe=n==null?void 0:n.title)==null?void 0:oe.substr(0,l(I)))+" ",1),S("span",$e,h((ae=n==null?void 0:n.title)==null?void 0:ae.substr(l(I),l(k).length)),1),i(" "+h((ue=n==null?void 0:n.title)==null?void 0:ue.substr(l(I)+l(k).length)),1)]))]}),_:1},8,["checked-keys","expanded-keys","check-strictly","data"])],4))]),_:1}),t(Z,{span:16},{default:o(()=>[t(ne,{ref_key:"formRef",ref:B,model:l(a),style:{width:"600px"}},{default:o(()=>[t(p,{field:"type",label:"类型"},{default:o(()=>[l(a).level===0?(m(),V("div",je,[t(D),e[33]||(e[33]=S("span",null,"顶级菜单",-1))])):y("",!0),l(a).level!==0?(m(),V("div",He,[t(ee),e[34]||(e[34]=S("span",null,"页面菜单",-1))])):y("",!0)]),_:1}),t(p,{field:"title",tooltip:"Please enter username",label:"菜单名称"},{default:o(()=>[t(b,{modelValue:l(a).title,"onUpdate:modelValue":e[5]||(e[5]=n=>l(a).title=n),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),t(p,{field:"iconStr",tooltip:"输入内容为 arco icon 的值",label:"菜单图标"},{default:o(()=>[t(b,{modelValue:l(a).iconStr,"onUpdate:modelValue":e[6]||(e[6]=n=>l(a).iconStr=n),placeholder:"请输入菜单图标"},null,8,["modelValue"])]),_:1}),t(p,{field:"path",label:"路由地址",rules:[l(w)]},{default:o(()=>[t(K,{content:"路由地址，英文唯一，跳转页面，路径展示用",position:"bl"},{default:o(()=>[t(b,{modelValue:l(a).path,"onUpdate:modelValue":e[7]||(e[7]=n=>l(a).path=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),t(p,{field:"name",label:"路由名称",rules:[l(w)]},{default:o(()=>[t(K,{content:"路由name，需英文唯一，跳转页面用",position:"bl"},{default:o(()=>[t(b,{modelValue:l(a).name,"onUpdate:modelValue":e[8]||(e[8]=n=>l(a).name=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),l(a).level!==0?(m(),U(p,{key:0,field:"frontRoute",label:"文件路径",rules:[l(w)]},{default:o(()=>[t(b,{modelValue:l(a).frontRoute,"onUpdate:modelValue":e[9]||(e[9]=n=>l(a).frontRoute=n)},null,8,["modelValue"])]),_:1},8,["rules"])):y("",!0),l(a).level!==0?(m(),U(p,{key:1,field:"permission",label:"权限url"},{default:o(()=>[t(le,{modelValue:l(a).permission,"onUpdate:modelValue":e[10]||(e[10]=n=>l(a).permission=n),placeholder:"请输入权限url，*号模糊匹配，逗号分割","allow-clear":""},null,8,["modelValue"])]),_:1})):y("",!0),t(p,{field:"sortOrder",label:"排序值",rules:[l(w)]},{default:o(()=>[t(K,{content:"值越小越靠前，支持小数",position:"rt"},{default:o(()=>[t(te,{modelValue:l(a).sortOrder,"onUpdate:modelValue":e[11]||(e[11]=n=>l(a).sortOrder=n),style:{width:"320px"},class:"input-demo",min:0,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),t(p,null,{default:o(()=>[t(_,{"html-type":"submit",style:{"margin-right":"5px"},type:"primary",onClick:ke},{default:o(()=>e[35]||(e[35]=[i(" 修改并保存 ")])),_:1}),t(_,{"html-type":"submit",onClick:ge},{default:o(()=>e[36]||(e[36]=[i(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(Se,{visible:l(C),"onUpdate:visible":e[19]||(e[19]=n=>E(C)?C.value=n:null),"align-center":!1,footer:!1,onCancel:ye},{title:o(()=>[i(h(l(F)),1)]),default:o(()=>[t(ne,{ref_key:"formAddRef",ref:W,model:l(s),layout:"horizontal","auto-label-width":"",onSubmit:_e},{default:o(()=>[l(g)?(m(),V("div",ze,[t(p,{label:"上级节点："},{default:o(()=>[i(h(l(a).title),1)]),_:1})])):y("",!0),t(p,{field:"type",label:"类型"},{default:o(()=>[l(g)?y("",!0):(m(),V("div",Ge,[t(D),e[37]||(e[37]=S("span",null,"顶级菜单",-1))])),l(g)?(m(),V("div",qe,[t(ee),e[38]||(e[38]=S("span",null,"页面菜单",-1))])):y("",!0)]),_:1}),t(p,{field:"title",label:"菜单名称",rules:[l(w)]},{default:o(()=>[t(b,{modelValue:l(s).title,"onUpdate:modelValue":e[12]||(e[12]=n=>l(s).title=n)},null,8,["modelValue"])]),_:1},8,["rules"]),t(p,{field:"iconStr",tooltip:"输入内容为 arco icon 的值",label:"菜单图标"},{default:o(()=>[t(b,{modelValue:l(s).iconStr,"onUpdate:modelValue":e[13]||(e[13]=n=>l(s).iconStr=n),placeholder:"请输入菜单图标"},null,8,["modelValue"])]),_:1}),l(g)?(m(),U(p,{key:1,field:"path",label:"路由地址",rules:[l(w)]},{default:o(()=>[t(b,{modelValue:l(s).path,"onUpdate:modelValue":e[14]||(e[14]=n=>l(s).path=n)},null,8,["modelValue"])]),_:1},8,["rules"])):y("",!0),t(p,{field:"name",label:"路由名称",rules:[l(w)]},{default:o(()=>[t(K,{content:"路由name，需英文唯一，跳转页面用",position:"bl"},{default:o(()=>[t(b,{modelValue:l(s).name,"onUpdate:modelValue":e[15]||(e[15]=n=>l(s).name=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),l(g)?(m(),U(p,{key:2,field:"frontRoute",label:"文件路径"},{default:o(()=>[t(b,{modelValue:l(s).frontRoute,"onUpdate:modelValue":e[16]||(e[16]=n=>l(s).frontRoute=n)},null,8,["modelValue"])]),_:1})):y("",!0),l(g)?(m(),U(p,{key:3,field:"permission",label:"权限url"},{default:o(()=>[t(le,{modelValue:l(s).permission,"onUpdate:modelValue":e[17]||(e[17]=n=>l(s).permission=n),placeholder:"请输入权限url，*号模糊匹配，逗号分割","allow-clear":""},null,8,["modelValue"])]),_:1})):y("",!0),t(p,{field:"sortOrder",label:"排序值",rules:[l(w)]},{default:o(()=>[t(K,{content:"值越小越靠前，支持小数",position:"rt"},{default:o(()=>[t(te,{modelValue:l(s).sortOrder,"onUpdate:modelValue":e[18]||(e[18]=n=>l(s).sortOrder=n),style:{width:"320px"},class:"input-demo",min:0,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),t(p,{label:"操作"},{default:o(()=>[t(_,{type:"primary","html-type":"submit"},{default:o(()=>e[39]||(e[39]=[i(" 保存 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})])}}}),Ze=Pe(Qe,[["__scopeId","data-v-75e2c6d9"]]);export{Ze as default};
