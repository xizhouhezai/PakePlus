import{F as xe,G as Te,H as Ie,I as Ne,J as Pe,K as we,L as Q,M as Oe,N as Ve}from"./operation-CQQGRn8-.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-CDd49swx.js";import{u as Ae}from"./useCurrentInstance-BLlvmEjv.js";import{N as Ue,O as Le}from"./tools-BfzgO_2s.js";import{R as x,b as W,c as X}from"./validator-B8pIxTAL.js";import Be from"./list-BzYmm1f-.js";import{U as $e,V as R}from"./dist-PezRi_EG.js";import{d as Ye,r,a as Ge,h as He,E as Je,b as p,o as m,j as y,w as l,e as a,u as t,f as i,c as f,s as b,t as w,F as U,k as S,q as Z,i as je,M as E,_ as qe}from"./index-C4AMdMz2.js";import"./index-Dg8m97qn.js";import"./shops-fXVW_gE8.js";import"./index-D43NcXdt.js";import"./member-B0DkAxtf.js";import"./index-DUU-x9KJ.js";import"./index-B2X1kTmN.js";import"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./extra-5DUayDl9.js";const ze={key:0},Ke={key:1},Qe={key:0},We={key:1},Xe={key:2},Ze={key:0},he={key:1},et={key:2},tt={class:"send-setting"},st={class:"left-show"},at={class:"send-form"},lt=Ye({__name:"index",setup(ot){var j;const h=(j=Ae().globalProperties)==null?void 0:j.$modal,O=r(),M=r({}),T=r(),L=r(),B=r(),$=r(),ee=r(),te=r(),se=[{label:"消息标题",model:"title",disabled:!1,input:!0},{label:"消息内容",model:"content",disabled:!1,input:!0}],ae=[{title:"消息标题",dataIndex:"title"},{title:"消息内容",dataIndex:"content",width:200},{title:"发送对象",dataIndex:"messageClient",slot:!0,slotData:{badge:Ue}},{title:"发送类型",dataIndex:"messageRange",slot:!0,slotData:{badge:Le}},{title:"发送时间",dataIndex:"createTime"}],le=[{title:"用户名称",dataIndex:"nickName"},{title:"手机号",dataIndex:"mobile"}],oe=[{title:"店铺名称",dataIndex:"storeName",slot:!0,store:!0},{title:"店铺简介",dataIndex:"storeDesc"}],ne=[{title:"通知节点",dataIndex:"noticeNode"},{title:"通知标题",dataIndex:"noticeTitle"},{title:"通知内容",dataIndex:"noticeContent",width:200},{title:"状态",dataIndex:"noticeStatus",width:50,slot:!0,slotTemplate:"noticeStatus"}],ie=[{title:"店铺ID",dataIndex:"memberId"},{title:"店铺名称",dataIndex:"memberName"},{title:"是否已读",dataIndex:"status",slot:!0,slotTemplate:"status"}],de=[{title:"会员ID",dataIndex:"memberId"},{title:"会员名称",dataIndex:"memberName"},{title:"是否已读",dataIndex:"status",slot:!0,slotTemplate:"status"}],me={title:"操作",width:100,methods:[{title:"详细",callback:"details",slot:!0,slotTemplate:"details"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},re={title:"操作",width:100,methods:[{title:"更新",callback:"update",slot:!0,slotTemplate:"update"},{title:"编辑",callback:"edit",slot:!0,slotTemplate:"edit"}]},ue={title:"操作",width:100,methods:[{title:"删除",callback:"delete",slot:!0,slotTemplate:"delete"}]},ge={title:"操作",width:100,methods:[{title:"删除",callback:"delete",slot:!0,slotTemplate:"delete"}]},V=r(),I=r(!1),N=r(!1),Y=r(null),k=r([]),v=r([]),D=r("STORE"),s=Ge({messageSendForm:{title:"",content:"",messageClient:"member",messageRange:"ALL",userIds:[],memberDTOS:[],storeDTOS:[],store:[]},messageSendModal:!1,isAdd:!1,searchMessageParams:{},shopMessageData:[],memberMessageData:[],templateEditModal:!1,templateEditForm:{}});function pe(){s.isAdd=!0,s.messageSendModal=!0,V.value.resetFields(),k.value=[],s.messageSendForm.store=[]}function G(){s.messageSendForm.memberDTOS=k.value.map(n=>({nickName:n.nickName,id:n.id}))}function H(){s.messageSendForm.storeDTOS=v.value.map(n=>({storeName:n.storeName,id:n.id}))}function fe(){Y.value.selectedMember=!1,I.value=!0}function ce(n){const e=k.value.find(d=>d.id===n.id);e&&e.id?k.value.forEach((d,u)=>{d.id===e.id&&k.value.splice(u,1)}):k.value.push({...n}),G()}function be(){N.value=!0,D.value=s.messageSendForm.messageRange==="APPOINT"?"STORE":"SUPPLIER"}function Se(n){const e=v.value.find(d=>d.id===n.id);e&&e.id?v.value.forEach((d,u)=>{d.id===e.id&&v.value.splice(u,1)}):v.value.push({...n}),H()}async function ke(){var c;const n=JSON.parse(JSON.stringify(s.messageSendForm)),e=await((c=V.value)==null?void 0:c.validate()),d=[],u=[];if(s.messageSendForm.messageClient==="member"&&s.messageSendForm.messageRange==="MEMBER"&&(s.messageSendForm.memberDTOS.forEach(C=>{d.push(C.id),u.push(C.nickName)}),n.userIds=d,n.userNames=u),s.messageSendForm.messageClient==="store"&&(s.messageSendForm.messageRange==="APPOINT"||s.messageSendForm.messageRange==="SUPPLIER"))if(s.messageSendForm.storeDTOS.length<=0){E.error("请选择发送范围！");return}else s.messageSendForm.storeDTOS.forEach(C=>{d.push(C.id),u.push(C.storeName)}),n.userIds=d,n.userNames=u;delete n.store,delete n.createTime,n.id||delete n.id,e||Pe(n).then(()=>{E.success("发送成功"),s.messageSendModal=!1,O.value.init()})}async function ve(n){h.confirm({title:"确认删除",content:"您确认删除此站内信?",alignCenter:!1,onOk:async()=>{(await we(n.record.id)).data.success&&(E.success("删除成功"),O.value.init())}})}async function ye(){s.messageSendForm.messageClient==="member"?B.value.init():L.value.init()}function Ce(n){s.isAdd=!1,s.messageSendModal=!0,s.searchMessageParams.messageId=n.id,s.messageSendForm=n,ye()}async function J(n){n.noticeStatus==="CLOSE"?(await Q(n.id,"OPEN")).data.success&&(E.success("启用成功"),T.value.init()):n.noticeStatus==="OPEN"&&(await Q(n.id,"CLOSE")).data.success&&(E.success("禁用成功"),T.value.init())}async function Fe(n){s.templateEditModal=!0;const e=await Oe(n.id);e.data.success&&(s.templateEditForm=e.data.result)}async function Re(){var e;if(!await((e=$.value)==null?void 0:e.validate())){const d={noticeContent:s.templateEditForm.noticeContent,noticeTitle:s.templateEditForm.noticeTitle};Ve(s.templateEditForm.id,d).then(u=>{u.data.success&&(s.templateEditModal=!1,E.success("保存成功！"),T.value.init())})}}function Ee(n){k.value.splice(n,1),G()}function Me(n){v.value.splice(n,1),H()}return He(()=>{}),Je(()=>s.messageSendForm.messageRange,()=>{v.value=[]},{deep:!0,immediate:!0}),(n,e)=>{const d=p("a-button"),u=p("a-tab-pane"),c=p("a-badge"),C=p("a-tabs"),A=p("a-input"),g=p("a-form-item"),q=p("a-textarea"),_=p("a-radio"),z=p("a-radio-group"),K=p("a-form"),P=p("a-modal"),_e=p("a-card");return m(),y(_e,{class:"general-card",title:"站内信",bordered:!1},{default:l(()=>[a(C,null,{default:l(()=>[a(u,{key:"MESSAGE",title:"站内信列表"},{default:l(()=>[a(t($e),{columns:se,onReset:e[0]||(e[0]=o=>{M.value={...t(M),...o}}),onSearch:e[1]||(e[1]=o=>{M.value={...t(M),...o}})}),a(d,{style:{"margin-bottom":"10px"},type:"primary",onClick:pe},{default:l(()=>e[14]||(e[14]=[i(" 发送消息 ")])),_:1}),a(t(R),{ref_key:"messageTablePageRef",ref:O,columns:ae,methods:me,api:t(xe),"api-params":t(M),bordered:!0,onDelete:ve},{details:l(({data:o})=>[a(d,{type:"text",status:"success",onClick:F=>Ce(o)},{default:l(()=>e[15]||(e[15]=[i(" 详细 ")])),_:2},1032,["onClick"])]),_:1},8,["api","api-params"])]),_:1}),a(u,{key:"SETTING",title:"通知类站内信"},{default:l(()=>[a(t(R),{ref_key:"settingTablePageRef",ref:T,columns:ne,methods:re,api:t(Te),bordered:!0},{noticeStatus:l(({data:o})=>[o.noticeStatus==="OPEN"?(m(),f("p",ze,[a(c,{status:"success"}),e[16]||(e[16]=i(" 开启 "))])):b("",!0),o.noticeStatus==="CLOSE"?(m(),f("p",Ke,[a(c,{status:"danger"}),e[17]||(e[17]=i(" 关闭 "))])):b("",!0)]),update:l(({data:o})=>[o.noticeStatus==="CLOSE"?(m(),y(d,{key:0,type:"text",status:"success",onClick:F=>J(o)},{default:l(()=>e[18]||(e[18]=[i(" 开启 ")])),_:2},1032,["onClick"])):b("",!0),o.noticeStatus==="OPEN"?(m(),y(d,{key:1,type:"text",status:"danger",onClick:F=>J(o)},{default:l(()=>e[19]||(e[19]=[i(" 关闭 ")])),_:2},1032,["onClick"])):b("",!0)]),edit:l(({data:o})=>[a(d,{type:"text",status:"warning",onClick:F=>Fe(o)},{default:l(()=>e[20]||(e[20]=[i(" 编辑 ")])),_:2},1032,["onClick"])]),_:1},8,["api"])]),_:1})]),_:1}),a(P,{visible:t(s).messageSendModal,"onUpdate:visible":e[7]||(e[7]=o=>t(s).messageSendModal=o),"align-center":!1,footer:!1,width:800},{title:l(()=>[i(w(t(s).isAdd?"发送站内信":"消息详情"),1)]),default:l(()=>[a(K,{ref_key:"formRef",ref:V,model:t(s).messageSendForm,disabled:!t(s).isAdd},{default:l(()=>[a(g,{field:"title",label:"消息标题",rules:[t(x),t(W)]},{default:l(()=>[a(A,{modelValue:t(s).messageSendForm.title,"onUpdate:modelValue":e[2]||(e[2]=o=>t(s).messageSendForm.title=o),style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["rules"]),a(g,{field:"content",label:"消息内容",rules:[t(x),t(X)]},{default:l(()=>[a(q,{modelValue:t(s).messageSendForm.content,"onUpdate:modelValue":e[3]||(e[3]=o=>t(s).messageSendForm.content=o),"allow-clear":"",style:{width:"400px"}},null,8,["modelValue"])]),_:1},8,["rules"]),a(g,{field:"messageClient",label:"发送对象"},{default:l(()=>[a(z,{modelValue:t(s).messageSendForm.messageClient,"onUpdate:modelValue":e[4]||(e[4]=o=>t(s).messageSendForm.messageClient=o),type:"button",onChange:e[5]||(e[5]=o=>t(s).messageSendForm.messageRange="ALL")},{default:l(()=>[a(_,{value:"member"},{default:l(()=>e[21]||(e[21]=[i(" 会员 ")])),_:1}),a(_,{value:"store"},{default:l(()=>e[22]||(e[22]=[i(" 商家 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,{field:"messageRange",label:"发送范围"},{default:l(()=>[a(z,{modelValue:t(s).messageSendForm.messageRange,"onUpdate:modelValue":e[6]||(e[6]=o=>t(s).messageSendForm.messageRange=o),type:"button"},{default:l(()=>[a(_,{value:"ALL"},{default:l(()=>e[23]||(e[23]=[i(" 全站 ")])),_:1}),t(s).messageSendForm.messageClient==="member"?(m(),y(_,{key:0,value:"MEMBER"},{default:l(()=>e[24]||(e[24]=[i(" 指定会员 ")])),_:1})):b("",!0),t(s).messageSendForm.messageClient==="store"?(m(),y(_,{key:1,value:"APPOINT"},{default:l(()=>e[25]||(e[25]=[i(" 指定商家 ")])),_:1})):b("",!0)]),_:1},8,["modelValue"])]),_:1}),t(s).isAdd?(m(),f(U,{key:0},[t(s).messageSendForm.messageClient==="member"&&t(s).messageSendForm.messageRange==="MEMBER"?(m(),y(g,{key:0,label:"指定会员"},{default:l(()=>[S("div",null,[a(d,{type:"outline",style:{marginBottom:"10px"},onClick:fe},{default:l(()=>e[26]||(e[26]=[i(" 选择会员 ")])),_:1}),a(t(R),{ref_key:"memberTablePageRef",ref:ee,columns:le,methods:ue,"data-list":t(k),"enable-pagination":!1},{delete:l(({rowIndex:o})=>[a(d,{type:"text",status:"danger",onClick:F=>Ee(o)},{default:l(()=>e[27]||(e[27]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data-list"])])]),_:1})):b("",!0),t(s).messageSendForm.messageClient==="store"&&(t(s).messageSendForm.messageRange==="APPOINT"||t(s).messageSendForm.messageRange==="SUPPLIER")?(m(),y(g,{key:1,label:t(s).messageSendForm.messageRange==="APPOINT"?"指定商家":"指定供应商"},{default:l(()=>[S("div",null,[a(d,{type:"outline",style:{marginBottom:"10px"},onClick:be},{default:l(()=>[i(" 选择"+w(t(s).messageSendForm.messageRange==="APPOINT"?"商家":"供应商"),1)]),_:1}),a(t(R),{ref_key:"storeTablePageRef",ref:te,columns:oe,methods:ge,"data-list":t(v),"enable-pagination":!1},{delete:l(({rowIndex:o})=>[a(d,{type:"text",status:"danger",onClick:F=>Me(o)},{default:l(()=>e[28]||(e[28]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data-list"])])]),_:1},8,["label"])):b("",!0)],64)):(m(),f(U,{key:1},[t(s).messageSendForm.messageClient==="member"?(m(),y(g,{key:0,label:"指定会员",disabled:!1},{default:l(()=>[a(t(R),{ref_key:"memberMessageRef",ref:B,columns:de,api:t(s).searchMessageParams.messageId?t(Ie):"","api-params":t(s).searchMessageParams},{status:l(({data:o})=>[o.status==="ALREADY_READY"?(m(),f("p",Qe,[a(c,{status:"success"}),e[29]||(e[29]=i(" 已读 "))])):o.status==="UN_READY"?(m(),f("p",We,[a(c,{status:"warning"}),e[30]||(e[30]=i(" 未读 "))])):(m(),f("p",Xe,[a(c,{status:"danger"}),e[31]||(e[31]=i(" 回收站 "))]))]),_:1},8,["api","api-params"])]),_:1})):b("",!0),t(s).messageSendForm.messageClient==="store"?(m(),y(g,{key:1,label:"指定商家"},{default:l(()=>[a(t(R),{ref_key:"shopMessageRef",ref:L,columns:ie,api:t(s).searchMessageParams.messageId?t(Ne):"","api-params":t(s).searchMessageParams},{status:l(({data:o})=>[o.status==="ALREADY_READY"?(m(),f("p",Ze,[a(c,{status:"success"}),e[32]||(e[32]=i(" 已读 "))])):o.status==="UN_READY"?(m(),f("p",he,[a(c,{status:"warning"}),e[33]||(e[33]=i(" 未读 "))])):(m(),f("p",et,[a(c,{status:"danger"}),e[34]||(e[34]=i(" 回收站 "))]))]),_:1},8,["api","api-params"])]),_:1})):b("",!0)],64)),a(g,{label:"操作"},{default:l(()=>[a(d,{type:"primary",onClick:ke},{default:l(()=>e[35]||(e[35]=[i(" 提交 ")])),_:1})]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["visible"]),a(P,{visible:t(I),"onUpdate:visible":e[8]||(e[8]=o=>Z(I)?I.value=o:null),width:"1200px"},{title:l(()=>e[36]||(e[36]=[i(" 会员选择器 ")])),default:l(()=>[a(Be,{ref_key:"memberLayout",ref:Y,"selected-list":t(k),onCallback:ce},null,8,["selected-list"])]),_:1},8,["visible"]),a(P,{visible:t(N),"onUpdate:visible":e[9]||(e[9]=o=>Z(N)?N.value=o:null),width:"1300px"},{title:l(()=>[i(w(t(D)==="STORE"?"商家":"供应商")+"选择器 ",1)]),default:l(()=>[a(De,{"selected-list":t(v),"store-type":t(D),onCallback:Se},null,8,["selected-list","store-type"])]),_:1},8,["visible"]),a(P,{visible:t(s).templateEditModal,"onUpdate:visible":e[13]||(e[13]=o=>t(s).templateEditModal=o),"align-center":!1,footer:!1,width:800},{title:l(()=>e[37]||(e[37]=[i(" 编辑通知类推送 ")])),default:l(()=>[e[41]||(e[41]=S("div",{class:"message-title"},[S("p",null,"1、左侧#{xxx}为消息变量"),S("p",null,"2、如果要发送的消息包含消息变量则将消息变量复制到消息内容中即可，注意格式"),S("p",null,"3、例：比如消息变量为#{订单号}，发送的内容为：订单号为xxx的订单已经发货注意查收，完整的消息内容应该为订单号为#{订单号}的订单已经发货注意查收")],-1)),S("div",tt,[S("div",st,[(m(!0),f(U,null,je(t(s).templateEditForm.variables,(o,F)=>(m(),f("div",{key:F},[e[38]||(e[38]=i(" #{")),S("span",null,w(o),1),e[39]||(e[39]=i("} "))]))),128))]),S("div",at,[a(K,{ref_key:"templateEditFormRef",ref:$,model:t(s).templateEditForm},{default:l(()=>[a(g,{field:"noticeNode",label:"通知节点",rules:[t(x)],disabled:""},{default:l(()=>[a(A,{modelValue:t(s).templateEditForm.noticeNode,"onUpdate:modelValue":e[10]||(e[10]=o=>t(s).templateEditForm.noticeNode=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(g,{field:"noticeTitle",label:"消息标题",rules:[t(x),t(W)]},{default:l(()=>[a(A,{modelValue:t(s).templateEditForm.noticeTitle,"onUpdate:modelValue":e[11]||(e[11]=o=>t(s).templateEditForm.noticeTitle=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(g,{field:"noticeContent",label:"消息内容",rules:[t(x),t(X)]},{default:l(()=>[a(q,{modelValue:t(s).templateEditForm.noticeContent,"onUpdate:modelValue":e[12]||(e[12]=o=>t(s).templateEditForm.noticeContent=o),"allow-clear":"","max-length":"50","auto-size":{maxRows:3,minRows:3},"show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"]),a(g,{label:"操作"},{default:l(()=>[a(d,{type:"primary",onClick:Re},{default:l(()=>e[40]||(e[40]=[i(" 保存 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1},8,["visible"])]),_:1})}}}),Et=qe(lt,[["__scopeId","data-v-1daca570"]]);export{Et as default};
