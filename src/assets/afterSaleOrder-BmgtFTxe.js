import{j as h,s as tt,r as lt,k as et,l as dt}from"./order-HsmDfkng.js";import{u as st}from"./useCurrentInstance-BLlvmEjv.js";import{d as at,r as k,p as nt,n as ot,a as U,h as ut,b as p,o as n,c as r,e as f,w as o,u as e,f as m,j as E,F as I,s as v,k as l,t as s,i as B,q as it,M as T,_ as rt}from"./index-C4AMdMz2.js";import{u as w}from"./filters-D05Q2eUM.js";import{u as mt}from"./index-tA6dL0mr.js";import"./index-RdD_tp-0.js";const ft={class:"search"},vt={class:"main-content"},pt={class:"div-flow-left"},yt={class:"div-form-default"},gt={key:0},Et={key:1},St={key:0},kt=["src"],Nt={key:1},Rt={key:0,class:"div-form-default"},bt={class:"div-content"},At={class:"div-content"},Ct={style:{"text-align":"right",width:"45%","margin-top":"10px"}},Pt={key:1,class:"div-form-default"},Tt={class:"div-content"},Ot={class:"div-flow-right"},Lt={class:"div-form-default"},xt=["src"],_t={class:"div-zoom"},Ut={style:{color:"#999","font-size":"12px"}},It={class:"div-form-default"},wt={key:0},Dt={key:1},Mt={key:2},Vt={key:0,class:"div-form-default"},Yt={style:{"text-align":"right",width:"45%","margin-top":"10px"}},Bt={key:1,class:"div-form-default"},Ft={class:"layui-layer-wrap"},qt={class:"text-box"},Gt={class:"text-box"},$t={class:"text-box"},jt={class:"div-express-log"},zt={class:"express-log"},Ht={key:0},Wt={class:"time"},Jt={class:"detail"},Kt={style:{"text-align":"right"}},Qt=at({__name:"afterSaleOrder",setup(Xt){var M;const g=k(1),F=mt(),S=nt(),q=ot(),D=[{name:"申请中",status:"APPLY"},{name:"通过",status:"PASS"},{name:"拒绝",status:"REFUSE"},{name:"买家退货，待卖家收货",status:"BUYER_RETURN"},{name:"卖家确认收货",status:"SELLER_CONFIRM"},{name:"卖家终止售后",status:"SELLER_TERMINATION"},{name:"买家取消售后",status:"BUYER_CANCEL"},{name:"完成售后",status:"COMPLETE"},{name:"等待平台退款",status:"WAIT_REFUND"}],d=U({data:{applyRefundPrice:0,serviceName:"",sn:"",reason:"",actualRefundPrice:0,refundPoint:"",num:"",problemDesc:"",serviceStatus:"",storeName:"",auditRemark:"",goodsImage:"",goodsId:"",skuId:"",orderSn:"",bankDepositName:"",bankAccountName:"",bankAccountNumber:"",afterSaleAllowOperationVO:{refund:""},showDelivery:!1,serviceType:"",mlogisticsName:"",mlogisticsNo:"",goodsName:""}}),R=U({data:{salesConsigneeMobile:"",salesConsigneeAddressPath:"",salesConsigneeDetail:""}}),O=k({traces:[]}),b=U({data:{remark:""}}),y=k({serviceStatus:"PASS",remark:"",actualRefundPrice:0}),A=k([]),L=k(!1),G=(M=st().globalProperties)==null?void 0:M.$modal,N=k(!1);function $(u){let t=!1;return D.forEach((a,C)=>{a.status===u&&C>=3&&C!==6&&(t=!0)}),t}function j(u){return D.filter(a=>a.status===u)[0].name}async function x(){const u=await h(S.query.id);if(u.data.code===200&&(d.data=u.data.result,d.data.showDelivery=$(d.data.serviceStatus),d.data.serviceName=j(d.data.serviceStatus),u.data.result&&u.data.result.afterSaleImage&&(A.value=(u.data.result.afterSaleImage||[]).split(",")),d.data.showDelivery&&tt(S.query.id).then(t=>{if(t.data.code===200){const a=t.data.result;a.salesConsigneeAddressPath=a.salesConsigneeAddressPath.replaceAll(",",""),R.data=a}}),d.data&&d.data.serviceStatus)){const t=d.data.serviceType,a=d.data.serviceStatus;a==="APPLY"?g.value=1:(a==="PASS"||a==="REFUSE")&&(g.value=2),t==="RETURN_GOODS"?a==="BUYER_RETURN"||a==="BUYER_CANCEL"?g.value=3:a==="SELLER_CONFIRM"||a==="SELLER_TERMINATION"?g.value=4:a==="COMPLETE"&&(g.value=5):t==="RETURN_MONEY"&&(a==="WAIT_REFUND"||a==="BUYER_CANCEL"?g.value=3:a==="COMPLETE"&&(g.value=4))}}ut(()=>{x()});function z(){if(b.data.remark===""){T.error("请输入退款备注");return}G.confirm({title:"确认退款",content:"请确认退款？",alignCenter:!1,onOk:()=>{lt(S.query.id,b.data.remark).then(u=>{console.error(u),u.data.code===200&&(T.success("收款成功"),x())})}})}function H(){var u;if(y.value.remark===""){T.error("请输入备注信息");return}et(((u=S.query)==null?void 0:u.id)||"",y.value).then(t=>{L.value=!1,t.data.code===200&&(T.success("审核成功"),y.value.remark="",x())})}function W(){N.value=!0,dt(S.query.id).then(u=>{u.data.code===200&&(O.value.traces=u.result)})}function J(u){const t=q.resolve({name:"order-detail",query:{id:u}});window.open(t.href,"_blank")}return(u,t)=>{const a=p("a-step"),C=p("a-steps"),V=p("a-card"),Y=p("a-radio"),K=p("a-radio-group"),Q=p("a-input-number"),X=p("a-textarea"),P=p("a-button"),Z=p("a-input"),c=p("a-modal");return n(),r("div",ft,[f(V,{title:"售后单详情",bordered:!1},{default:o(()=>[f(C,{current:e(g),"line-less":"",style:{padding:"30px 10% 0 10%"},class:"steps-box"},{default:o(()=>[f(a,null,{default:o(()=>t[9]||(t[9]=[m("申请中")])),_:1}),e(d).data.serviceStatus==="REFUSE"?(n(),E(a,{key:0},{default:o(()=>t[10]||(t[10]=[m(" 拒绝售后 ")])),_:1})):(n(),E(a,{key:1},{default:o(()=>t[11]||(t[11]=[m(" 通过售后 ")])),_:1})),e(d).data.serviceStatus!=="REFUSE"?(n(),r(I,{key:2},[e(d).data.serviceType==="RETURN_GOODS"&&e(d).data.serviceStatus!=="BUYER_CANCEL"?(n(),E(a,{key:0},{default:o(()=>t[12]||(t[12]=[m(" 买家退货，待卖家收货 ")])),_:1})):v("",!0),e(d).data.serviceType==="RETURN_GOODS"&&e(d).data.serviceStatus!=="SELLER_TERMINATION"&&e(d).data.serviceStatus!=="BUYER_CANCEL"?(n(),E(a,{key:1},{default:o(()=>t[13]||(t[13]=[m(" 卖家确认收货 ")])),_:1})):v("",!0),e(d).data.serviceType==="RETURN_MONEY"&&e(d).data.serviceStatus!=="BUYER_CANCEL"?(n(),E(a,{key:2},{default:o(()=>t[14]||(t[14]=[m(" 待平台退款 ")])),_:1})):v("",!0),e(d).data.serviceType==="SELLER_TERMINATION"||e(d).data.serviceStatus==="SELLER_TERMINATION"?(n(),E(a,{key:3},{default:o(()=>t[15]||(t[15]=[m(" 卖家终止售后 ")])),_:1})):e(d).data.serviceType==="BUYER_CANCEL"||e(d).data.serviceStatus==="BUYER_CANCEL"?(n(),E(a,{key:4},{default:o(()=>t[16]||(t[16]=[m(" 买家取消售后 ")])),_:1})):(n(),E(a,{key:5},{default:o(()=>t[17]||(t[17]=[m(" 完成售后 ")])),_:1}))],64)):v("",!0)]),_:1},8,["current"])]),_:1}),f(V,{class:"general-card",style:{paddingTop:"5px"},bordered:!1},{default:o(()=>[l("div",vt,[l("div",pt,[l("div",yt,[t[27]||(t[27]=l("h4",null,"退货申请",-1)),l("dl",null,[t[18]||(t[18]=l("dt",null,"退货状态",-1)),l("dd",null,s(e(d).data.serviceName),1)]),l("dl",null,[t[19]||(t[19]=l("dt",null,"退货退款编号",-1)),l("dd",null,s(e(d).data.sn),1)]),l("dl",null,[t[20]||(t[20]=l("dt",null,"退货退款原因",-1)),l("dd",null,s(e(d).data.reason),1)]),l("dl",null,[t[21]||(t[21]=l("dt",null,"申请退款金额",-1)),l("dd",null,s(e(w)(e(d).data.applyRefundPrice,"¥")),1)]),e(d).data.actualRefundPrice?(n(),r("dl",gt,[t[22]||(t[22]=l("dt",null,"实际退款金额",-1)),l("dd",null,s(e(w)(e(d).data.actualRefundPrice,"¥")),1)])):v("",!0),e(d).data.refundPoint?(n(),r("dl",Et,[t[23]||(t[23]=l("dt",null,"退还积分",-1)),l("dd",null,s(e(d).data.refundPoint),1)])):v("",!0),l("dl",null,[t[24]||(t[24]=l("dt",null,"退货数量",-1)),l("dd",null,s(e(d).data.num),1)]),l("dl",null,[t[25]||(t[25]=l("dt",null,"问题描述",-1)),l("dd",null,s(e(d).data.problemDesc),1)]),l("dl",null,[t[26]||(t[26]=l("dt",null,"凭证",-1)),e(A)&&e(A).length?(n(),r("dd",St,[(n(!0),r(I,null,B(e(A),(i,_)=>(n(),r("div",{key:_,class:"div-img"},[l("img",{class:"complain-img",src:i},null,8,kt)]))),128))])):(n(),r("dd",Nt," 暂无凭证 "))])]),e(d).data.serviceStatus==="APPLY"?(n(),r("div",Rt,[t[36]||(t[36]=l("h4",null,"处理意见",-1)),l("dl",null,[t[28]||(t[28]=l("dt",null,"商家",-1)),l("dd",null,[l("div",bt,s(e(d).data.storeName),1)])]),l("dl",null,[t[31]||(t[31]=l("dt",null,"是否同意",-1)),l("dd",null,[l("div",At,[f(K,{modelValue:e(y).serviceStatus,"onUpdate:modelValue":t[0]||(t[0]=i=>e(y).serviceStatus=i),type:"button"},{default:o(()=>[f(Y,{value:"PASS"},{default:o(()=>t[29]||(t[29]=[m(" 同意 ")])),_:1}),f(Y,{value:"REFUSE"},{default:o(()=>t[30]||(t[30]=[m(" 拒绝 ")])),_:1})]),_:1},8,["modelValue"])])])]),l("dl",null,[t[32]||(t[32]=l("dt",null,"申请退款金额",-1)),l("dd",null,s(e(w)(e(d).data.applyRefundPrice,"¥")),1)]),l("dl",null,[t[33]||(t[33]=l("dt",null,"实际退款金额",-1)),l("dd",null,[f(Q,{modelValue:e(y).actualRefundPrice,"onUpdate:modelValue":t[1]||(t[1]=i=>e(y).actualRefundPrice=i),min:.001,precision:2,style:{width:"100px"}},null,8,["modelValue"])])]),l("dl",null,[t[34]||(t[34]=l("dt",null,"备注信息",-1)),l("dd",null,[f(X,{modelValue:e(y).remark,"onUpdate:modelValue":t[2]||(t[2]=i=>e(y).remark=i),"allow-clear":""},null,8,["modelValue"])])]),l("dl",null,[l("dd",null,[l("div",Ct,[f(P,{type:"primary",loading:e(L),style:{"margin-left":"5px"},onClick:H},{default:o(()=>t[35]||(t[35]=[m(" 确定 ")])),_:1},8,["loading"])])])])])):v("",!0),e(d).data.serviceStatus!=="APPLY"?(n(),r("div",Pt,[t[39]||(t[39]=l("h4",null,"商家处理",-1)),l("dl",null,[t[37]||(t[37]=l("dt",null,"商家",-1)),l("dd",null,[l("div",Tt,s(e(d).data.storeName),1)])]),l("dl",null,[t[38]||(t[38]=l("dt",null,"备注信息",-1)),l("dd",null,s(e(d).data.auditRemark||"暂无备注信息"),1)])])):v("",!0)]),t[60]||(t[60]=l("div",{class:"div-flow-center"},null,-1)),l("div",Ot,[l("div",Lt,[t[40]||(t[40]=l("h4",null,"相关商品交易信息",-1)),l("dl",null,[l("dt",null,[l("img",{src:e(d).data.goodsImage,height:"60"},null,8,xt)]),l("dd",null,[l("div",_t,[l("a",{class:"Hyperlink",onClick:t[3]||(t[3]=i=>e(F).viewGoodsDetail(e(d).data.goodsId,e(d).data.skuId))},s(e(d).data.goodsName),1)]),l("div",Ut," 数量：x"+s(e(d).data.num),1)])])]),l("div",It,[t[45]||(t[45]=l("h4",null,"订单相关信息",-1)),l("dl",null,[t[41]||(t[41]=l("dt",null,"订单编号",-1)),l("dd",null,[l("a",{class:"Hyperlink",onClick:t[4]||(t[4]=i=>J(e(d).data.orderSn))},s(e(d).data.orderSn),1)])]),e(d).data.bankDepositName?(n(),r("dl",wt,[t[42]||(t[42]=l("dt",null,"银行开户行",-1)),l("dd",null,s(e(d).data.bankDepositName),1)])):v("",!0),e(d).data.bankAccountName?(n(),r("dl",Dt,[t[43]||(t[43]=l("dt",null,"银行开户名",-1)),l("dd",null,s(e(d).data.bankAccountName),1)])):v("",!0),e(d).data.bankAccountNumber?(n(),r("dl",Mt,[t[44]||(t[44]=l("dt",null,"银行卡号",-1)),l("dd",null,s(e(d).data.bankAccountNumber),1)])):v("",!0)]),e(d).data.afterSaleAllowOperationVO&&e(d).data.afterSaleAllowOperationVO.refund?(n(),r("div",Vt,[t[51]||(t[51]=l("h4",null,"平台退款",-1)),l("dl",null,[t[46]||(t[46]=l("dt",null,"银行开户行",-1)),l("dd",null,s(e(d).data.bankDepositName),1)]),l("dl",null,[t[47]||(t[47]=l("dt",null,"银行开户名",-1)),l("dd",null,s(e(d).data.bankAccountName),1)]),l("dl",null,[t[48]||(t[48]=l("dt",null,"银行卡号",-1)),l("dd",null,s(e(d).data.bankAccountNumber),1)]),l("dl",null,[t[49]||(t[49]=l("dt",null,"备注信息",-1)),l("dd",null,[f(Z,{modelValue:e(b).data.remark,"onUpdate:modelValue":t[5]||(t[5]=i=>e(b).data.remark=i),clearable:"",style:{width:"260px"}},null,8,["modelValue"])])]),l("dl",null,[l("dd",null,[l("div",Yt,[f(P,{type:"primary",loading:e(L),style:{"margin-left":"5px"},onClick:z},{default:o(()=>t[50]||(t[50]=[m(" 退款 ")])),_:1},8,["loading"])])])])])):v("",!0),e(d).data.showDelivery&&e(d).data.serviceType==="RETURN_GOODS"?(n(),r("div",Bt,[t[59]||(t[59]=l("h4",null,"物流信息",-1)),l("dl",null,[t[52]||(t[52]=l("dt",null,"收货商家",-1)),l("dd",null,s(e(d).data.storeName),1)]),l("dl",null,[t[53]||(t[53]=l("dt",null,"收货商家手机",-1)),l("dd",null,s(e(R).data.salesConsigneeMobile),1)]),l("dl",null,[t[54]||(t[54]=l("dt",null,"收货地址",-1)),l("dd",null,s(e(R).data.salesConsigneeAddressPath)+" "+s(e(R).data.salesConsigneeDetail),1)]),l("dl",null,[t[55]||(t[55]=l("dt",null,"物流公司",-1)),l("dd",null,s(e(d).data.mlogisticsName),1)]),l("dl",null,[t[56]||(t[56]=l("dt",null,"物流单号",-1)),l("dd",null,s(e(d).data.mlogisticsNo),1)]),l("dl",null,[t[58]||(t[58]=l("dt",null,"操作",-1)),l("dd",null,[f(P,{type:"primary",style:{"margin-left":"5px"},onClick:t[6]||(t[6]=i=>W())},{default:o(()=>t[57]||(t[57]=[m(" 查询物流 ")])),_:1})])])])):v("",!0)])])]),_:1}),f(c,{visible:e(N),"onUpdate:visible":t[8]||(t[8]=i=>it(N)?N.value=i:null),closable:!1},{title:o(()=>t[61]||(t[61]=[m(" 查询物流 ")])),footer:o(()=>[l("div",Kt,[f(P,{type:"text",onClick:t[7]||(t[7]=i=>N.value=!1)},{default:o(()=>t[66]||(t[66]=[m(" 取消 ")])),_:1})])]),default:o(()=>[l("div",Ft,[l("dl",null,[t[62]||(t[62]=l("dt",null,"售后单号：",-1)),l("dd",null,[l("div",qt,s(e(S).query.id),1)])]),l("dl",null,[t[63]||(t[63]=l("dt",null,"物流公司：",-1)),l("dd",null,[l("div",Gt,s(e(d).data.mlogisticsName),1)])]),l("dl",null,[t[64]||(t[64]=l("dt",null,"快递单号：",-1)),l("dd",null,[l("div",$t,s(e(d).data.mlogisticsNo),1)])]),l("div",jt,[l("ul",zt,[Object.keys(e(O)).length?(n(),r("div",Ht,[(n(!0),r(I,null,B(e(O).traces,(i,_)=>(n(),r("li",{key:_},[l("span",Wt,s(i.AcceptTime),1),l("span",Jt,s(i.AcceptStation),1)]))),128))])):v("",!0),t[65]||(t[65]=l("div",null,[l("li",{style:{"text-align":"center"}}," 暂无物流信息 ")],-1))])])])]),_:1},8,["visible"])])}}}),dl=rt(Qt,[["__scopeId","data-v-3a364a32"]]);export{dl as default};
