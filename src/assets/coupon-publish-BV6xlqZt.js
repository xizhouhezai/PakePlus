import{g as Z,j as h}from"./promotion-ChRoyrm_.js";import{u as q,c as ee,d as Y}from"./filters-D05Q2eUM.js";import{F as te,ad as oe}from"./tools-BfzgO_2s.js";import{U as le,V as ne}from"./dist-PezRi_EG.js";import{d as G,r as f,b as r,o as d,c as v,e as o,w as t,f as u,k,u as l,t as N,q as O,n as ae,j as $,s as P,F as ie,M as ue,_ as se}from"./index-C4AMdMz2.js";import{R as pe}from"./validator-B8pIxTAL.js";import de from"./list-BzYmm1f-.js";import"./member-B0DkAxtf.js";import"./useCurrentInstance-BLlvmEjv.js";import"./index-DUU-x9KJ.js";import"./index-B2X1kTmN.js";import"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./extra-5DUayDl9.js";const me={key:0},re={key:1},ce={key:0},fe={key:1},ye={key:2},ve={key:0},_e={key:1},be={style:{"text-align":"right"}},Te=G({__name:"index",emits:["couponlist"],setup(B,{expose:g,emit:b}){const F=b,E=f([]),a=f({getType:"ACTIVITY",promotionStatus:"START"}),I=[{title:"优惠券名称",dataIndex:"couponName"},{title:"面额/折扣",dataIndex:"price",slot:!0,slotTemplate:"price"},{title:"已领取数量/总数量",dataIndex:"publishNum",slot:!0,slotTemplate:"publishNum"},{title:"已被使用的数量/已领取数量",dataIndex:"usedNum",slot:!0,slotTemplate:"usedNum"},{title:"优惠券类型",dataIndex:"couponType",slot:!0,slotTemplate:"couponType"},{title:"品类描述",dataIndex:"scopeType",slot:!0,slotData:{tag:te}},{title:"活动时间",dataIndex:"time",slot:!0,slotTemplate:"time"}],V=[{label:"优惠券名称",model:"couponName",disabled:!1,input:!0},{label:"活动状态",model:"promotionStatus",disabled:!1,select:{options:oe}},{label:"活动时间",model:"selectDate",disabled:!1,datePicker:{type:"range"}}],A=f(""),y=f(!1);function _(C){E.value=C}function w(){F("couponlist",E.value),y.value=!1}return g({visible:y}),(C,s)=>{const x=r("a-tag"),D=r("a-button"),U=r("a-modal");return d(),v("div",null,[o(U,{visible:l(y),"onUpdate:visible":s[3]||(s[3]=n=>O(y)?y.value=n:null),width:"1300px","align-center":!1},{title:t(()=>s[4]||(s[4]=[u(" 优惠券 ")])),footer:t(()=>[k("div",be,[o(D,{onClick:s[2]||(s[2]=n=>y.value=!1)},{default:t(()=>s[8]||(s[8]=[u(" 取消 ")])),_:1}),o(D,{style:{"margin-left":"10px"},type:"primary",onClick:w},{default:t(()=>s[9]||(s[9]=[u(" 确定 ")])),_:1})])]),default:t(()=>[o(l(le),{columns:V,onReset:s[0]||(s[0]=n=>{a.value={...l(a),...n}}),onSearch:s[1]||(s[1]=n=>{a.value={...l(a),...n}})}),o(l(ne),{ref_key:"tablePageRef",ref:A,columns:I,api:l(Z),"api-params":l(a),checkbox:!0,onSelectTableChange:_},{price:t(({data:n})=>[n.price?(d(),v("span",me,N(l(q)(n.price,"¥")),1)):(d(),v("span",re,N(`${n.couponDiscount}折`),1))]),publishNum:t(({data:n})=>[k("span",null,N(`${n.receivedNum}/`)+" "+N(`${n.publishNum===0?"不限制":` ${n.publishNum}`}`),1)]),usedNum:t(({data:n})=>[u(N(`${n.usedNum}/${n.receivedNum}`),1)]),couponType:t(({data:n})=>[n.couponType==="DISCOUNT"?(d(),v("span",ce,[o(x,{color:"blue"},{default:t(()=>s[5]||(s[5]=[u("打折")])),_:1})])):n.couponType==="PRICE"?(d(),v("span",fe,[o(x,{color:"purple"},{default:t(()=>s[6]||(s[6]=[u("减免现金")])),_:1})])):(d(),v("span",ye,[o(x,{color:"purple"},{default:t(()=>s[7]||(s[7]=[u("未知")])),_:1})]))]),time:t(({data:n})=>[(n==null?void 0:n.getType)==="ACTIVITY"&&(n==null?void 0:n.rangeDayType)==="DYNAMICTIME"?(d(),v("span",ve,"长期有效")):(d(),v("span",_e,N(`${n.startTime}
            ${n.endTime}`),1))]),_:1},8,["api","api-params"])]),_:1},8,["visible"])])}}}),Ne={class:"base-info-item"},ke={class:"form-item-view"},Ie={class:"form-item-view"},Se={key:0},Ce={key:1},xe=G({__name:"coupon-publish",setup(B){const g=ae(),b=f([]),F=[{title:"优惠券名称",dataIndex:"couponName",width:300},{title:"品类描述",dataIndex:"scopeType",width:300,slotName:"scopeType"},{title:"面额/折扣",dataIndex:"price",width:300,slotName:"price"},{title:"赠送数量",dataIndex:"couponName",width:300,slotName:"sendNum"},{title:"操作",dataIndex:"couponName",width:300,slotName:"couponName"}],E=[{title:"用户名称",dataIndex:"nickName",width:375},{title:"手机号",dataIndex:"mobile",width:375},{title:"最后登录时间",dataIndex:"lastLoginDate",width:375},{title:"操作",dataIndex:"del",width:375,slotName:"del"}],a=f({promotionName:"",activityScope:"ALL",couponActivityType:"REGISTERED",couponFrequencyEnum:"",startTime:"",endTime:"",memberDTOS:[],couponActivityItems:[]}),I=f([]),V=f(null),A=f(null),y=f(!1),_=f([]),w=f();function C(){a.value.couponActivityItems=b.value.map(p=>({num:0,couponId:p.id}))}function s(){V.value.visible=!0}function x(p){b.value.push(...p);const e=new Map;b.value=b.value.map(c=>e.set(c.id,c)),b.value=[...e.values()],C()}function D(p){b.value.splice(p,1),C()}function U(){a.value.memberDTOS=_.value.map(p=>({nickName:p.nickName,id:p.id}))}function n(){A.value.selectedMember=!1,y.value=!0}function H(p){const e=_.value.find(c=>c.id===p.id);e?_.value.forEach((c,m)=>{c.id===e.id&&_.value.splice(m,1)}):_.value.push({...p}),U()}function W(p){_.value.splice(p,1),U()}function j(){g.push({name:"coupon-activity"})}async function J(){var c;a.value.startTime=Y(I.value[0]),a.value.endTime=Y(I.value[1]);const p=JSON.parse(JSON.stringify(a.value));delete p.id,p.couponActivityType!=="SPECIFY"&&(p.activityScope="ALL"),await((c=w.value)==null?void 0:c.validate())||h(p).then(m=>{m.data.success&&(ue.success("优惠券活动创建成功"),g.push({name:"coupon-activity"}))})}return(p,e)=>{const c=r("a-input"),m=r("a-form-item"),z=r("a-range-picker"),T=r("a-radio"),L=r("a-radio-group"),S=r("a-button"),M=r("a-table"),K=r("a-form"),Q=r("a-card"),X=r("a-modal");return d(),v(ie,null,[k("div",null,[o(Q,{bordered:!1},{default:t(()=>[o(K,{ref_key:"modifyPriceForm",ref:w,model:l(a),style:{width:"100%"},layout:"horizontal","auto-label-width":""},{default:t(()=>[k("div",Ne,[e[17]||(e[17]=k("h4",null,"活动信息",-1)),k("div",ke,[o(m,{field:"promotionName",label:"活动名称",rules:[l(pe)]},{default:t(()=>[o(c,{modelValue:l(a).promotionName,"onUpdate:modelValue":e[0]||(e[0]=i=>l(a).promotionName=i),"allow-clear":"",style:{width:"260px"},placeholder:"请填写活动名称"},null,8,["modelValue"])]),_:1},8,["rules"]),o(m,{field:"promotionName",label:"活动时间"},{default:t(()=>[o(z,{modelValue:l(I),"onUpdate:modelValue":e[1]||(e[1]=i=>O(I)?I.value=i:null),style:{width:"260px","margin-bottom":"20px"}},null,8,["modelValue"])]),_:1}),o(m,{field:"couponActivityType",label:"优惠券活动类型"},{default:t(()=>[o(L,{modelValue:l(a).couponActivityType,"onUpdate:modelValue":e[2]||(e[2]=i=>l(a).couponActivityType=i),type:"button"},{default:t(()=>[o(T,{value:"REGISTERED"},{default:t(()=>e[6]||(e[6]=[u(" 新人发券 ")])),_:1}),o(T,{value:"SPECIFY"},{default:t(()=>e[7]||(e[7]=[u(" 精确发券 ")])),_:1}),o(T,{value:"AUTO_COUPON"},{default:t(()=>e[8]||(e[8]=[u(" 自动赠券 ")])),_:1}),o(T,{value:"INVITE_NEW"},{default:t(()=>e[9]||(e[9]=[u(" 邀新赠券 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(a).couponActivityType==="AUTO_COUPON"?(d(),$(m,{key:0,field:"couponFrequencyEnum",label:"领取频率"},{default:t(()=>[o(L,{modelValue:l(a).couponFrequencyEnum,"onUpdate:modelValue":e[3]||(e[3]=i=>l(a).couponFrequencyEnum=i),type:"button"},{default:t(()=>[o(T,{value:"DAY"},{default:t(()=>e[10]||(e[10]=[u(" 每日 ")])),_:1}),o(T,{value:"WEEK"},{default:t(()=>e[11]||(e[11]=[u(" 每周一次 ")])),_:1}),o(T,{value:"MONTH"},{default:t(()=>e[12]||(e[12]=[u(" 每月一次 ")])),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0),l(a).couponActivityType==="SPECIFY"?(d(),$(m,{key:1,field:"activityScope",label:"活动范围"},{default:t(()=>[o(L,{modelValue:l(a).activityScope,"onUpdate:modelValue":e[4]||(e[4]=i=>l(a).activityScope=i),type:"button"},{default:t(()=>[o(T,{value:"ALL"},{default:t(()=>e[13]||(e[13]=[u(" 全部会员 ")])),_:1}),o(T,{value:"DESIGNATED"},{default:t(()=>e[14]||(e[14]=[u(" 指定会员 ")])),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0),l(a).couponActivityType==="SPECIFY"&&l(a).activityScope==="DESIGNATED"?(d(),$(m,{key:2,field:"scopeType",label:"活动范围"},{default:t(()=>[o(S,{type:"primary",onClick:n},{default:t(()=>e[15]||(e[15]=[u(" 选择会员 ")])),_:1})]),_:1})):P("",!0),l(a).couponActivityType==="SPECIFY"&&l(a).activityScope==="DESIGNATED"?(d(),$(m,{key:3},{default:t(()=>[o(M,{columns:E,data:l(_)},{del:t(({rowIndex:i})=>[o(S,{type:"text",status:"danger",onClick:R=>W(i)},{default:t(()=>e[16]||(e[16]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data"])]),_:1})):P("",!0)])]),e[20]||(e[20]=k("h4",null,"配置优惠券",-1)),k("div",Ie,[o(m,{field:"scopeType",label:"选择优惠券"},{default:t(()=>[o(S,{type:"primary",onClick:s},{default:t(()=>e[18]||(e[18]=[u(" 选择优惠券 ")])),_:1})]),_:1}),o(m,{field:"scopeType",label:"赠送配置"},{default:t(()=>[o(M,{columns:F,"w-full":"",data:l(b)},{scopeType:t(({record:i})=>[u(N(l(ee)(i.scopeType)),1)]),price:t(({record:i})=>[i.price?(d(),v("span",Se,N(l(q)(i.price,"¥")),1)):(d(),v("span",Ce,N(`${i.couponDiscount}折`),1))]),sendNum:t(({rowIndex:i})=>[o(c,{modelValue:l(a).couponActivityItems[i].num,"onUpdate:modelValue":R=>l(a).couponActivityItems[i].num=R,placeholder:"赠送数量"},null,8,["modelValue","onUpdate:modelValue"])]),couponName:t(({rowIndex:i})=>[o(S,{type:"text",status:"danger",onClick:R=>D(i)},{default:t(()=>e[19]||(e[19]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data"])]),_:1})])]),_:1},8,["model"]),o(S,{style:{"margin-right":"5px"},onClick:j},{default:t(()=>e[21]||(e[21]=[u(" 返回 ")])),_:1}),o(S,{type:"primary",onClick:J},{default:t(()=>e[22]||(e[22]=[u(" 提交 ")])),_:1})]),_:1})]),o(Te,{ref_key:"couponLayout",ref:V,onCouponlist:x},null,512),o(X,{visible:l(y),"onUpdate:visible":e[5]||(e[5]=i=>O(y)?y.value=i:null),width:"1200px"},{default:t(()=>[o(de,{ref_key:"memberLayout",ref:A,"selected-list":l(_),onCallback:H},null,8,["selected-list"])]),_:1},8,["visible"])],64)}}}),qe=se(xe,[["__scopeId","data-v-eb9c410e"]]);export{qe as default};
