import{S as le}from"./goods-CB7YWqUH.js";import{r as ae,t as te,v as oe}from"./shops-fXVW_gE8.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import{R as C,M as ue,c as ne}from"./validator-B8pIxTAL.js";import{C as re}from"./index-DUU-x9KJ.js";import{d as ie,p as de,n as pe,r,h as me,b as i,o as w,c as x,e as a,w as t,u as l,F as I,f as m,t as S,s as A,k as D,q as M,i as fe,M as T,j as ce}from"./index-C4AMdMz2.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./useCurrentInstance-BLlvmEjv.js";import"./dist-PezRi_EG.js";import"./extra-5DUayDl9.js";const ve=["src"],Oe=ie({__name:"addShop",setup(_e){const d=de(),V=pe(),g=r(d.query.type==="STORE"?"店铺":d.query.type==="SUPPLIER"?"供应商":""),y=r(d.query.id),E=r(""),o=r({mobile:"",password:"",storeName:"",selfOperated:!1,storeLogo:"",scene:d.query.type}),R=r(""),b=r(0),f=r(!1),O=r(),k=r([]),c=r([]),v=r(!1),h=r(!1),N=r([]);function B(u,e){R.value=u,b.value=e,f.value=!0}function F(){f.value=!1,b.value===0||b.value===1?o.value[R.value][b.value]=O.value:o.value[R.value]=O.value,b.value=.1}function P(u){O.value=u.url}function $(){le().then(u=>{u.data.success&&(k.value=u.data.result)})}function z(u){u.length===k.value.length?(h.value=!1,v.value=!0):u.length>0?(h.value=!0,v.value=!1):(h.value=!1,v.value=!1)}function J(u){h.value=!1,u?(v.value=!0,k.value.forEach(e=>N.value.push(e.id)),c.value=N.value):(v.value=!1,c.value=[])}async function G(){var e;if(!await((e=E.value)==null?void 0:e.validate())){const n=JSON.parse(JSON.stringify(o.value));n.businessCategory=c.value,n.storeSceneEnum="NORMAL",n.password&&(n.password=re.MD5(n.password).toString()),y.value?(delete n.memberId,delete n.mobile,delete n.username,ae(y.value,n).then(_=>{_.data.success&&(T.success("编辑成功"),d.query.type==="STORE"?V.push({name:"shop-list"}):d.query.type==="SUPPLIER"&&V.push({name:"supplier-list"}))})):te(n).then(_=>{_.data.success&&(T.success("添加成功"),o.value={},d.query.type==="STORE"?V.push({name:"shop-list"}):d.query.type==="SUPPLIER"&&V.push({name:"supplier-list"}))})}}function j(){oe(y.value).then(u=>{u.data.success&&(o.value=u.data.result,o.value.businessCategory&&(c.value=o.value.businessCategory.split(",")))})}return me(()=>{$(),d.query.id&&j()}),(u,e)=>{const n=i("a-divider"),_=i("a-input"),p=i("a-form-item"),H=i("a-input-password"),L=i("a-radio"),Q=i("a-radio-group"),U=i("a-button"),K=i("a-textarea"),q=i("a-checkbox"),W=i("a-checkbox-group"),X=i("a-form"),Y=i("a-card"),Z=i("a-modal");return w(),x("div",null,[a(Y,{style:{width:"100%"}},{default:t(()=>[a(X,{ref_key:"shopFormRef",ref:E,model:l(o)},{default:t(()=>[l(y)?A("",!0):(w(),x(I,{key:0},[a(n,{orientation:"left"},{default:t(()=>[m(S(l(g))+"账号 ",1)]),_:1}),a(p,{field:"mobile",label:"手机号",rules:[l(C),l(ue)]},{default:t(()=>[a(_,{modelValue:l(o).mobile,"onUpdate:modelValue":e[0]||(e[0]=s=>l(o).mobile=s),"allow-clear":"",style:{width:"350px"},"max-length":11},null,8,["modelValue"])]),_:1},8,["rules"]),a(p,{field:"password",label:"密码",rules:[l(C)]},{default:t(()=>[a(H,{modelValue:l(o).password,"onUpdate:modelValue":e[1]||(e[1]=s=>l(o).password=s),"allow-clear":"",style:{width:"350px"}},null,8,["modelValue"])]),_:1},8,["rules"])],64)),a(n,{orientation:"left"},{default:t(()=>[m(S(l(g))+"信息 ",1)]),_:1}),a(p,{field:"storeName",label:`${l(g)}名称`,rules:[l(C),l(ne)]},{default:t(()=>[a(_,{modelValue:l(o).storeName,"onUpdate:modelValue":e[2]||(e[2]=s=>l(o).storeName=s),"allow-clear":"",style:{width:"350px"}},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(p,{field:"selfOperated",label:"是否自营",rules:[l(C)]},{default:t(()=>[a(Q,{modelValue:l(o).selfOperated,"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).selfOperated=s),type:"button"},{default:t(()=>[a(L,{value:!0},{default:t(()=>e[9]||(e[9]=[m(" 自营 ")])),_:1}),a(L,{value:!1},{default:t(()=>e[10]||(e[10]=[m(" 非自营 ")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["rules"]),a(p,{field:"storeLogo",label:`${l(g)}logo`},{default:t(()=>[l(o).storeLogo?(w(),x("img",{key:0,src:l(o).storeLogo,"mr-20px":"",style:{width:"100px",height:"100px"}},null,8,ve)):A("",!0),D("div",null,[a(U,{type:"primary",onClick:e[4]||(e[4]=s=>B("storeLogo"))},{default:t(()=>e[11]||(e[11]=[m(" 选择图片 ")])),_:1})])]),_:1},8,["label"]),a(p,{field:"storeDesc",label:`${l(g)}简介`},{default:t(()=>[a(K,{modelValue:l(o).storeDesc,"onUpdate:modelValue":e[5]||(e[5]=s=>l(o).storeDesc=s),"max-length":200,"allow-clear":"","show-word-limit":"",style:{width:"350px"},"auto-size":""},null,8,["modelValue"])]),_:1},8,["label"]),a(n,{orientation:"left"},{default:t(()=>e[12]||(e[12]=[m(" 经营类目 ")])),_:1}),a(p,{label:"经营类目",field:"goodsManagementCategory"},{default:t(()=>[D("div",null,[a(q,{"model-value":l(v),indeterminate:l(h),onChange:J},{default:t(()=>e[13]||(e[13]=[m(" 全选 ")])),_:1},8,["model-value","indeterminate"])])]),_:1}),a(p,null,{default:t(()=>[a(W,{modelValue:l(c),"onUpdate:modelValue":e[6]||(e[6]=s=>M(c)?c.value=s:null),onChange:z},{default:t(()=>[(w(!0),x(I,null,fe(l(k),(s,ee)=>(w(),ce(q,{key:ee+1,value:s.id},{default:t(()=>[m(S(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:""},{default:t(()=>[a(U,{type:"primary",onClick:G},{default:t(()=>[m(S(l(y)?"修改":"保存"),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(Z,{visible:l(f),"onUpdate:visible":e[7]||(e[7]=s=>M(f)?f.value=s:null),width:1100,title:"oss资源管理",onOk:F,onCancel:e[8]||(e[8]=s=>f.value=!1)},{default:t(()=>[a(se,{initialize:l(f),"is-single":!0,onSelected:P},null,8,["initialize"])]),_:1},8,["visible"])])}}});export{Oe as default};
