import{z as $,A as G,B as w}from"./promotion-ChRoyrm_.js";import{u as O}from"./useCurrentInstance-BLlvmEjv.js";import{ah as v,ai as A}from"./tools-BfzgO_2s.js";import{U as F,V as U}from"./dist-PezRi_EG.js";import{d as j,n as q,r as x,b as f,o as l,j as g,w as a,e as T,u as n,f as d,t as _,k as C,c as h,F as z,i as E,s as S,M as b}from"./index-C4AMdMz2.js";const H={flex:"","flex-wrap":"","gap-5px":""},Y=j({__name:"list",setup(L){var y;const u=(y=O().globalProperties)==null?void 0:y.$modal,D=q(),r=x(),i=x({sort:"startTime"}),P=[{label:"活动名称",model:"promotionName",disabled:!1,input:!0},{label:"活动状态",model:"promotionStatus",disabled:!1,select:{options:v}},{label:"活动时间",model:"selectDate",disabled:!1,datePicker:{type:"range"}}],V=[{title:"活动名称",dataIndex:"promotionName",width:250},{title:"活动时间",dataIndex:"time",width:400,slot:!0,slotTemplate:"time"},{title:"赠品信息",dataIndex:"goods",width:250,slot:!0,slotTemplate:"goods",ellipsis:!1},{title:"商品参与方式",dataIndex:"scopeType",slot:!0,width:250,slotData:{badge:A}},{title:"活动状态",dataIndex:"promotionStatus",slot:!0,slotData:{badge:v}}],I={title:"操作",width:240,methods:[{title:"查看",callback:"view",slot:!0,slotTemplate:"view"},{title:"关闭",callback:"close",slot:!0,slotTemplate:"close"},{title:"删除",callback:"delete",slot:!0,slotTemplate:"delete"}]};function N(s){u.confirm({title:"确认删除",content:"确认删除此活动吗?",alignCenter:!1,onOk:async()=>{G(s.id).then(e=>{e.data.success&&(b.success("删除成功"),r.value.init())})}})}function R(s,e){const o={onlyView:!0,id:s.id};D.push({name:"gift-detail",query:o})}function B(s){let e="开启";if(s.promotionStatus==="START")e="关闭",u.confirm({title:"提示",content:`确认${e}此活动吗?需要一定时间才能生效，请耐心等待`,alignCenter:!1,onOk:async()=>{(await w(s.id)).data.success&&(b.success(`${e}成功`),r.value.init())}});else{const o=new Date;o.setMinutes(o.getMinutes()+10);const m=new Date(new Date().setHours(0,0,0,0)+24*60*60*1e3-1),p={startTime:o.getTime(),endTime:m.getTime()};u.confirm({title:"确认开启(默认为当前时间的十分钟之后)",content:"您确认要开启此拼团活动?",alignCenter:!1,onOk:async()=>{(await w(s.id,p)).data.success&&(b.success("开启活动成功"),r.value.init())}})}}return(s,e)=>{const o=f("a-image"),m=f("a-button"),p=f("a-card");return l(),g(p,{class:"general-card",title:"赠品活动",bordered:!1},{default:a(()=>[T(n(F),{columns:P,"time-type":"timestamp",onReset:e[0]||(e[0]=t=>{i.value={...n(i),...t}}),onSearch:e[1]||(e[1]=t=>{i.value={...n(i),...t}})}),T(n(U),{ref_key:"tablePageRef",ref:r,columns:V,methods:I,api:n($),"api-params":n(i),bordered:!0,onDelete:N},{time:a(({data:t})=>[d(_(t.startTime),1),e[2]||(e[2]=C("span",{style:{margin:"0 10px"}},"-",-1)),d(_(t.endTime),1)]),goods:a(({data:t})=>{var c;return[C("div",H,[(l(!0),h(z,null,E((c=t==null?void 0:t.groupGoodsImage)==null?void 0:c.split(","),(M,k)=>(l(),h("div",{key:k},[k<5?(l(),g(o,{key:0,width:"50",height:"50",src:M,"show-loader":"",style:{"margin-right":"5px"}},null,8,["src"])):S("",!0)]))),128))])]}),view:a(({data:t})=>[T(m,{type:"text",status:"success",onClick:c=>R(t,"onlyView")},{default:a(()=>e[3]||(e[3]=[d(" 查看 ")])),_:2},1032,["onClick"])]),close:a(({data:t})=>[t.promotionStatus==="START"?(l(),g(m,{key:0,type:"text",status:"danger",onClick:c=>B(t)},{default:a(()=>e[4]||(e[4]=[d(" 关闭 ")])),_:2},1032,["onClick"])):S("",!0)]),_:1},8,["api","api-params"])]),_:1})}}});export{Y as default};
