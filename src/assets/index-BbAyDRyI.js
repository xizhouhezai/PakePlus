import{l as B,m as H,d as X,r as y,a as G,u as t,o as m,c as w,k as d,A as x,e as o,I as Y,B as j,t as I,C as F,s as k,_ as L,D as K,E as Z,h as ee,x as te,w as p,f as N,j as ae,n as se,b as u,v as oe,G as ne,M as ie,H as W,J as A,K as re,L as le}from"./index-C4AMdMz2.js";import{a as O}from"./js.cookie-Cz0CWeBA.js";import{g as de}from"./assetsImages-DUrhbhdO.js";import{R as E,V as U}from"./validator-B8pIxTAL.js";import{C as ce}from"./index-DUU-x9KJ.js";import{u as ue}from"./index-Cwm13-Rt.js";import"./goods-CB7YWqUH.js";function fe(f){return B({url:`/auth/verification/${f}`,method:H.GET,needToken:!1,headers:{uuid:O.get("uuid")}})}function pe(f){return B({url:`/auth/verification/${f.verificationEnums}`,method:H.POST,needToken:!1,params:f,headers:{uuid:O.get("uuid")}})}const me=["src"],ge=["src","width","height"],_e={class:"text"},he=X({__name:"index",props:{verifyType:{type:String,default:"LOGIN"}},emits:["onChange"],setup(f,{expose:r,emit:S}){const n=f,l=S,g=y(),e=G({data:{backImage:"",slidingImage:"",originalHeight:150,originalWidth:300,sliderWidth:60,sliderHeight:60,distance:0,flag:!1,downX:0,bgColor:"#04ad11",verifyText:"拖动滑块解锁"}});async function c(){const i=await fe(n.verifyType);e.data=i.data.result,e.data.distance=0,g.value=!0}function _(i){e.data.downX=i.clientX,e.data.flag=!0}function h(i){if(e.data.flag){const a=i.clientX-e.data.downX;a>e.data.originalWidth-43?e.data.distance=e.data.originalWidth-43:a<0?e.data.distance=0:e.data.distance=a}}async function T(){if(!e.data.flag)return!1;e.data.flag=!1;const i={verificationEnums:n.verifyType,xPos:e.data.distance};try{(await pe(i)).data.result?(e.data.bgColor="green",e.data.verifyText="解锁成功",l("onChange",{status:!0,distance:e.data.distance})):(e.data.bgColor="red",e.data.verifyText="解锁失败",setTimeout(()=>{c()}),l("onChange",{status:!1,distance:e.data.distance}))}catch(a){console.warn(a),await c()}return""}return r({init:c,verifyShow:g}),(i,a)=>t(g)?(m(),w("div",{key:0,class:"verify-content",onMousemove:h,onMouseup:T,onClick:a[0]||(a[0]=F(()=>{},["stop"]))},[d("div",{class:"imgBox",style:x({width:`${t(e).data.originalWidth}px`,height:`${t(e).data.originalHeight}px`})},[d("img",{src:t(e).data.backImage,style:{width:"100%",height:"100%"},alt:""},null,8,me),d("img",{class:"slider",src:t(e).data.slidingImage,style:x({left:`${t(e).data.distance}px`,top:`${t(e).data.randomY}px`}),width:t(e).data.sliderWidth,height:t(e).data.sliderHeight,alt:""},null,12,ge),o(t(Y),{class:"refresh",onClick:c})],4),d("div",{class:"handle",style:x({width:`${t(e).data.originalWidth}px`})},[d("span",{class:"bgColor",style:x({width:`${t(e).data.distance}px`,background:t(e).data.bgColor})},null,4),d("span",{class:"swiper",style:x({left:`${t(e).data.distance}px`}),onMousedown:_},[o(t(j))],36),d("span",_e,I(t(e).data.verifyText),1)],4)],32)):k("",!0)}}),ve=L(he,[["__scopeId","data-v-f28d9598"]]),ye={class:"login-box"},we={key:0,class:"logo"},xe=["src"],ke={key:0,absolute:"","bottom-20px":""},be={flex:"","cursor-pointer":"","gap-8px":"","flex-a-c":"","text-14px":""},Ce={key:0},Ie=X({__name:"index",setup(f){const r=G({username:"admin",password:"123456"}),S=K(),n=y(!1),l=y({verifyShow:!1}),g=se(),e={background:`url(${de("wave.svg")}) no-repeat bottom`},c=y(""),_=y(""),h=y("");async function T(){n.value=!0,await l.value.init(),n.value=!1}async function i(v){n.value=!0;const{accessToken:s,refreshToken:V}=v.data.result;A.setAccessToken(s),A.setRefreshToken(V);const $=ue(),b=await re();$.userInfo=b.data.result,await le(!0);const{redirect:C,...R}=g.currentRoute.value.query,D=C?C.toString():"/Workplace";g.push({path:D,query:{...R}})}async function a(v){if(v.status){try{n.value=!0;const s=await ne({username:r.username,password:ce.MD5(r.password).toString()});s.data.success&&(n.value=!1,ie.loading("验证成功!正在登录中..."),await i(s))}catch{n.value=!1}l.value&&(l.value.verifyShow=!1)}}function q(){l.value&&(l.value.verifyShow=!1)}async function z(){}return Z(()=>W("manager_logo"),v=>{c.value=v.value,_.value=W("site_company_name").value,h.value=W("site_icp").value},{immediate:!0,deep:!0}),ee(()=>{z(),S.route=[]}),(v,s)=>{const V=u("icon-user"),$=u("a-input"),b=u("a-form-item"),C=u("icon-lock"),R=u("a-input-password"),D=u("a-button"),J=u("a-form"),P=u("a-link"),Q=oe("auto-animate");return m(),w("div",{class:"wrapper",style:e,onClick:q},[te((m(),w("div",ye,[t(c)?(m(),w("div",we,[d("img",{src:t(c)},null,8,xe)])):k("",!0),o(J,{size:"large",layout:"vertical",model:t(r),style:{width:"400px"},onSubmitSuccess:T},{default:p(()=>[o(b,{"hide-asterisk":!0,field:"username",rules:[t(E),t(U)]},{default:p(()=>[o($,{modelValue:t(r).username,"onUpdate:modelValue":s[0]||(s[0]=M=>t(r).username=M),size:"large","allow-clear":"",placeholder:"请输入用户名"},{prefix:p(()=>[o(V)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(b,{"hide-asterisk":!0,field:"password",rules:[t(E),t(U)]},{default:p(()=>[o(R,{modelValue:t(r).password,"onUpdate:modelValue":s[1]||(s[1]=M=>t(r).password=M),value:"large","allow-clear":"",placeholder:"请输入密码"},{prefix:p(()=>[o(C)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(D,{"html-type":"submit",class:"login",type:"primary",loading:t(n)},{default:p(()=>s[2]||(s[2]=[N(" 登录 ")])),_:1},8,["loading"])]),_:1},8,["model"])])),[[Q]]),t(_)||t(h)?(m(),w("div",ke,[d("div",be,[N(" ©"+I(new Date().getFullYear())+" ",1),t(_)?(m(),w("span",Ce,I(t(_)),1)):k("",!0),t(h)?(m(),ae(P,{key:1,hoverable:!1,href:"https://beian.miit.gov.cn/",target:"_blank"},{default:p(()=>[N(I(t(h)),1)]),_:1})):k("",!0)])])):k("",!0),o(ve,{ref_key:"verifyDom",ref:l,class:"verify","verify-type":"LOGIN",onOnChange:a},null,512)])}}}),Ne=L(Ie,[["__scopeId","data-v-42242e6f"]]);export{Ne as default};
