import{x as C}from"./goods-CB7YWqUH.js";import{b as I}from"./promotion-ChRoyrm_.js";import{d as k,b as g}from"./filters-D05Q2eUM.js";import{V as N,I as U}from"./dist-PezRi_EG.js";import{d as E,n as q,r as P,b as m,o as A,c as M,e as s,w as l,u as a,k as f,f as c,M as r,_ as R}from"./index-C4AMdMz2.js";const B={style:{"margin-top":"15px"}},J=E({__name:"kanjia-activity-add-goods",setup(O){const v=q(),t=P({promotionGoodsList:[],rangeTime:""}),_={order:"desc",marketEnable:"UPPER",authFlag:"PASS",sort:"createTime",scene:"STORE"},n=P(!0),h=P(null),V=[{title:"商品名称",dataIndex:"goodsName"},{title:"商品价格",dataIndex:"price",currency:!0},{title:"库存",dataIndex:"quantity"},{title:"结算价格",dataIndex:"settlementPrice",slot:!0,slotTemplate:"settlementPrice",tooltip:"none"},{title:"最低砍",dataIndex:"lowestPrice",slot:!0,slotTemplate:"lowestPrice",tooltip:"none"},{title:"最高砍",dataIndex:"highestPrice",slot:!0,slotTemplate:"highestPrice",tooltip:"none"},{title:"活动库存",dataIndex:"stock",slot:!0,slotTemplate:"stock",tooltip:"none"},{title:"操作",dataIndex:"action",slot:!0,slotTemplate:"action"}];function y(){h.value.modalData.visible=!0}function G(u){const e=[];u.forEach(o=>{e.push({settlementPrice:o.settlementPrice||0,purchasePrice:0,lowestPrice:o.lowestPrice||0,highestPrice:o.highestPrice||0,stock:o.stock||0,goodsName:o.goodsName,price:o.price,originalPrice:o.price,quantity:o.quantity,storeId:o.storeId,storeName:o.storeName,skuId:o.id})}),t.value.promotionGoodsList.push(...e)}function b(u){t.value.promotionGoodsList.splice(u,1)}function L(){if(n.value=!0,t.value.rangeTime.length<=0){r.warning("请选择活动时间");return}const u=JSON.parse(JSON.stringify(t.value));if(u.startTime=k(t.value.rangeTime[0]),u.endTime=k(t.value.rangeTime[1]),t.value.promotionGoodsList.length>0){if(t.value.promotionGoodsList.forEach(e=>{if(e.stock<=0||e.stock>e.quantity){n.value=!1,r.error("活动库存不能为0且不能超过商品库存");return}if(!g.test(e.settlementPrice)){n.value=!1,r.error("结算价格金额格式不正确");return}if(e.settlementPrice<0||e.settlementPrice>e.price){n.value=!1,r.error("结算价格金额不能为0且不能超过商品价格");return}if(!g.test(e.highestPrice)){n.value=!1,r.error("最高可砍金额格式错误");return}if(!g.test(e.lowestPrice)){n.value=!1,r.error("最低可砍金额格式错误");return}if(e.highestPrice<=0||e.highestPrice>e.price){n.value=!1,r.error("最高可砍金额不能为0且不能超过商品价格");return}if(e.lowestPrice<=0||e.lowestPrice>e.price){n.value=!1,r.error("最低可砍金额不能为0");return}e.lowestPrice+0>e.highestPrice+0&&(n.value=!1,r.error("最低砍价金额不能大于最高砍价金额"))}),!n.value)return;t.value.rangeTime=null,I(u).then(e=>{e.data.success&&(r.success("砍价活动添加成功"),v.push({name:"bargain-activity"}))})}}function T(){v.push({name:"bargain-activity"})}return(u,e)=>{const o=m("a-button"),p=m("a-input-number"),x=m("a-range-picker"),w=m("a-form"),S=m("a-card");return A(),M("div",null,[s(S,{class:"general-card",bordered:!1},{default:l(()=>[s(w,{model:a(t)},{default:l(()=>[e[6]||(e[6]=f("h4",null,"商品信息",-1)),s(o,{type:"outline",class:"changGoods",onClick:y},{default:l(()=>e[1]||(e[1]=[c(" 选择商品 ")])),_:1}),s(a(N),{columns:V,"data-list":a(t).promotionGoodsList,"enable-pagination":!1,bordered:!0},{settlementPrice:l(({rowIndex:i})=>[s(p,{modelValue:a(t).promotionGoodsList[i].settlementPrice,"onUpdate:modelValue":d=>a(t).promotionGoodsList[i].settlementPrice=d,class:"input-demo",min:0},null,8,["modelValue","onUpdate:modelValue"])]),lowestPrice:l(({rowIndex:i})=>[s(p,{modelValue:a(t).promotionGoodsList[i].lowestPrice,"onUpdate:modelValue":d=>a(t).promotionGoodsList[i].lowestPrice=d,class:"input-demo",min:0},null,8,["modelValue","onUpdate:modelValue"])]),highestPrice:l(({rowIndex:i})=>[s(p,{modelValue:a(t).promotionGoodsList[i].highestPrice,"onUpdate:modelValue":d=>a(t).promotionGoodsList[i].highestPrice=d,class:"input-demo",min:0},null,8,["modelValue","onUpdate:modelValue"])]),stock:l(({rowIndex:i})=>[s(p,{modelValue:a(t).promotionGoodsList[i].stock,"onUpdate:modelValue":d=>a(t).promotionGoodsList[i].stock=d,class:"input-demo",min:0},null,8,["modelValue","onUpdate:modelValue"])]),action:l(({rowIndex:i})=>[s(o,{type:"text",status:"danger",onClick:d=>b(i)},{default:l(()=>e[2]||(e[2]=[c(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data-list"]),f("div",B,[f("div",null,[e[3]||(e[3]=c(" 活动时间：   ")),s(x,{modelValue:a(t).rangeTime,"onUpdate:modelValue":e[0]||(e[0]=i=>a(t).rangeTime=i),"show-time":"",style:{width:"354px","margin-bottom":"20px"}},null,8,["modelValue"])])]),f("div",null,[s(o,{style:{"margin-right":"5px"},onClick:T},{default:l(()=>e[4]||(e[4]=[c(" 返回 ")])),_:1}),s(o,{type:"primary",onClick:L},{default:l(()=>e[5]||(e[5]=[c(" 提交 ")])),_:1})])]),_:1},8,["model"])]),_:1}),s(a(U),{ref_key:"skuSelect",ref:h,api:a(C),"goods-or-sku":!0,"api-params":_,"default-goods-selected-list":a(t).promotionGoodsList,onChange:G},null,8,["api","default-goods-selected-list"])])}}}),$=R(J,[["__scopeId","data-v-7bd9feeb"]]);export{$ as default};
