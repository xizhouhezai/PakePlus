import{t as R,u as B,a as M,w as A}from"./order-HsmDfkng.js";import{u as $}from"./useCurrentInstance-BLlvmEjv.js";import{u as F}from"./filters-D05Q2eUM.js";import{V as W,n as j,W as q,p as z}from"./tools-BfzgO_2s.js";import{U as K,V as Y}from"./dist-PezRi_EG.js";import{d as G,r as m,E as H,b as i,o as f,j as J,w as s,e as o,u as d,f as u,k as l,t as p,c as y,F as Q,i as X,s as Z,M as I,_ as ee}from"./index-C4AMdMz2.js";const te={class:"header"},ae={"mr-30px":""},se={style:{color:"#333"}},oe={style:{color:"#333"}},le={"mx-5px":"","w-full":""},re={class:"flex"},ne={key:0},de={class:"goods-num","float-right":""},ie={class:"global_color"},ce={style:{color:"red"}},ue=G({__name:"index",setup(pe){var h;const b=(h=$().globalProperties)==null?void 0:h.$modal,x=m(),k=[{label:"订单号",model:"orderSn",disabled:!1,input:!0},{label:"买家/收货人",model:"nickname",disabled:!1,input:!0},{label:"订单状态",model:"orderStatus",disabled:!1,select:{options:W.filter(a=>a.value!=="UNDELIVERED"&&a.value!=="DELIVERED"&&a.value!=="STAY_PICKED_UP")}},{label:"下单时间",disabled:!1,datePicker:{type:"range"}}],P=[{title:"订单详情",dataIndex:"goods",slot:!0,slotTemplate:"goods",width:500},{title:"订单来源",dataIndex:"clientType",slot:!0,slotData:{badge:j},width:120},{title:"店铺名称",dataIndex:"storeName",width:200,slot:!0,store:!0},{title:"应付",dataIndex:"flowPrice",currency:!0,width:100},{title:"买家ID",dataIndex:"buyerId",width:150},{title:"买家/收货人",dataIndex:"nickname",width:150,member:!0},{title:"订单促销类型",dataIndex:"orderPromotionType",slot:!0,slotData:{badge:q},width:120},{title:"订单状态",dataIndex:"orderStatus",slot:!0,slotData:{badge:z},width:120}],D={title:"操作",width:200,methods:[{title:"收款",callback:"detail",slot:!0,slotTemplate:"Collection",type:"text"},{title:"查看",callback:"orderDetail",type:"text",status:"success"}]},r=m({orderType:"VIRTUAL"}),g=m(),v=m({total:0}),w=m("");function T(a){R(a.sn).then(e=>{w.value=e.data.result.trade.sn,b.confirm({title:"确认收款",content:"您确定要收款吗？",alignCenter:!1,onOk:async()=>{(await B(w.value)).data.code===200&&(I.success("收款成功"),x.value.init(),location.reload())}})})}async function C(){const a=await M(r.value);if(a.data.success){const e=[];a.data.result.records&&a.data.result.records.length&&a.data.result.records.forEach(c=>{e.push({...c,customType:"full"}),e.push(c)}),g.value=e,v.value=a.data.result}}async function S(){b.confirm({title:"确认导出",content:"确定要导出订单数据吗？导出功能为异步导出，需要去 运营 - 导出记录 下载",onOk:async()=>{(await A(r.value)).data.success&&I.success("导出成功,请前往 “运营 - 导出记录” 进行下载")}})}return H(()=>r.value,()=>{C()},{deep:!0,immediate:!0}),(a,e)=>{const c=i("a-button"),E=i("a-space"),V=i("a-col"),O=i("a-row"),_=i("a-typography-text"),U=i("a-image"),N=i("a-card");return f(),J(N,{class:"general-card",title:"虚拟订单",bordered:!1},{default:s(()=>[o(d(K),{columns:k,onReset:e[0]||(e[0]=t=>{r.value={...d(r),...t}}),onSearch:e[1]||(e[1]=t=>{r.value={...d(r),...t}})}),o(O,{"mb-16px":""},{default:s(()=>[o(V,{span:16},{default:s(()=>[o(E,null,{default:s(()=>[o(c,{type:"primary",onClick:S},{default:s(()=>e[4]||(e[4]=[u(" 导出订单 ")])),_:1})]),_:1})]),_:1})]),_:1}),o(d(Y),{ref_key:"tablePageRef",ref:x,columns:P,methods:D,"data-list":d(g),total:d(v).total,bordered:!0,"custom-col":!0,colspan:8,onPaginationChange:e[2]||(e[2]=t=>{r.value={...d(r),...t}}),onOrderDetail:e[3]||(e[3]=t=>{a.$openWindow({name:"order-detail",query:{id:t.record.sn}})})},{full:s(({data:t})=>[l("div",te,[l("p",ae,[e[5]||(e[5]=u(" 订单编号：")),o(_,{copyable:"",bold:""},{default:s(()=>[l("span",se,p(t.sn),1)]),_:2},1024)]),l("p",null,[e[6]||(e[6]=u("下单时间：")),l("span",oe,p(t.createTime),1)])])]),goods:s(({data:t})=>[(f(!0),y(Q,null,X(t.orderItems,(n,L)=>(f(),y("div",{key:L,class:"flex","mb-5px":""},[o(U,{width:"50",height:"50",src:n.image,"show-loader":""},{loader:s(()=>e[7]||(e[7]=[l("div",{class:"loader-animate"},null,-1)])),_:2},1032,["src"]),l("div",le,[o(_,{copyable:"",bold:""},{default:s(()=>[u(p(n.name),1)]),_:2},1024),l("div",re,[n!=null&&n.goodsUnit?(f(),y("div",ne,[o(_,{style:{"font-size":"12px"},type:"secondary"},{default:s(()=>[u(p(n.goodsUnit),1)]),_:2},1024)])):Z("",!0)])]),l("div",de,[l("span",ie,p(d(F)(n.goodsPrice,"￥")),1),l("span",ce," x"+p(n.num),1)])]))),128))]),Collection:s(({data:t})=>[o(c,{disabled:t.orderStatus!=="UNPAID",onClick:n=>T(t)},{default:s(()=>e[8]||(e[8]=[u(" 收款 ")])),_:2},1032,["disabled","onClick"])]),_:1},8,["data-list","total"])]),_:1})}}}),ge=ee(ue,[["__scopeId","data-v-6f686fbf"]]);export{ge as default};
