import{C as I,D as G,E as U,F}from"./promotion-ChRoyrm_.js";import{u as L}from"./useCurrentInstance-BLlvmEjv.js";import{R as b}from"./validator-B8pIxTAL.js";import{V as T}from"./dist-PezRi_EG.js";import{d as $,r as u,a as j,b as l,o as B,j as N,w as n,e as o,f as c,u as a,t as S,M as y}from"./index-C4AMdMz2.js";const W=$({__name:"list",setup(Q){var _;const d=u(),C=(_=L().globalProperties)==null?void 0:_.$modal,p=u(),i=u(""),v=[{title:"分类名称",dataIndex:"name"}],V={title:"操作",width:260,methods:[{title:"编辑",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},e=j({enableAddModal:!1,formLoading:!1,fid:"",form:{parentId:0,name:"",deleteFlag:0,level:0,sortOrder:1}});function k(){e.enableAddModal=!0,i.value="添加",e.fid="",e.form.name="",e.form.sortOrder=1,e.form.parentId=0,e.form.deleteFlag=0,e.form.level=0}async function w(){var t;await((t=p.value)==null?void 0:t.validate())||(await(e.fid?G(e.form):U(e.form))).data.success&&(y.success(`${e.fid?"修改":"添加"}成功!`),e.enableAddModal=!1,d.value.init())}function M(r){i.value="编辑",r&&(e.form.parentId=0,e.form.id=r.record.id,Object.keys(r.record).forEach(t=>{e.form[t]=r.record[t]}),e.fid=r.record.id,e.enableAddModal=!0)}function x(r){C.confirm({title:"确认删除",content:`您确认要删除${r.record.name}?`,alignCenter:!1,onOk:async()=>{(await F(r.record.id)).data.success&&(y.success("删除成功"),d.value.init())}})}return(r,t)=>{const m=l("a-button"),g=l("a-space"),A=l("a-col"),O=l("a-row"),P=l("a-input"),f=l("a-form-item"),R=l("a-input-number"),h=l("a-form"),D=l("a-modal"),E=l("a-card");return B(),N(E,{class:"general-card",title:"积分分类",bordered:!1},{default:n(()=>[o(O,{style:{"margin-bottom":"16px"}},{default:n(()=>[o(A,{span:16},{default:n(()=>[o(g,null,{default:n(()=>[o(m,{type:"primary",onClick:k},{default:n(()=>t[3]||(t[3]=[c(" 添加积分商品分类 ")])),_:1})]),_:1})]),_:1})]),_:1}),o(a(T),{ref_key:"tablePageRef",ref:d,columns:v,methods:V,api:a(I),"api-params":{sort:"startTime"},onDelete:x,onEditor:M},null,8,["api"]),o(D,{visible:a(e).enableAddModal,"onUpdate:visible":t[2]||(t[2]=s=>a(e).enableAddModal=s),"align-center":!1,footer:!1},{title:n(()=>[c(S(a(i)),1)]),default:n(()=>[o(h,{ref_key:"formRef",ref:p,model:a(e).form,onSubmit:w},{default:n(()=>[o(f,{field:"name",label:"分类名称",rules:[a(b)],"validate-trigger":["change"]},{default:n(()=>[o(P,{modelValue:a(e).form.name,"onUpdate:modelValue":t[0]||(t[0]=s=>a(e).form.name=s)},null,8,["modelValue"])]),_:1},8,["rules"]),o(f,{field:"sortOrder",label:"排序值",rules:[a(b)],"validate-trigger":["change"]},{default:n(()=>[o(R,{modelValue:a(e).form.sortOrder,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).form.sortOrder=s),min:0},null,8,["modelValue"])]),_:1},8,["rules"]),o(f,{label:"操作"},{default:n(()=>[o(m,{loading:a(e).formLoading,"html-type":"submit",type:"primary"},{default:n(()=>t[4]||(t[4]=[c(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{W as default};
