import{E as K,F as E,G as W,H as X}from"./member-B0DkAxtf.js";import{a as Y}from"./operation-CQQGRn8-.js";import{u as Z}from"./useCurrentInstance-BLlvmEjv.js";import{t as M}from"./filters-D05Q2eUM.js";import{R as f}from"./validator-B8pIxTAL.js";import{V as ee}from"./dist-PezRi_EG.js";import{d as te,r as m,a as ae,E as oe,h as re,b as n,o as I,j as D,w as s,e as l,u as o,f as p,k as b,t as _,s as le,M as y,_ as se}from"./index-C4AMdMz2.js";const ne=te({__name:"premium",setup(de){var h;const u=m(""),N=(h=Z().globalProperties)==null?void 0:h.$modal,k=m({gradeType:"PREMIUM",order:"asc",sort:"sort"}),x=m([]),V=m(),c=m(""),C=m([]),L=[{title:"付费会员名称",dataIndex:"gradeName"},{title:"有效期(天)",dataIndex:"expireDay",slot:!0,slotTemplate:"expireDay"},{title:"售价",dataIndex:"price",slot:!0,slotTemplate:"price"},{title:"排序",dataIndex:"sort"},{title:"是否启用",dataIndex:"status",slot:!0,slotTemplate:"status"}],P={title:"操作",width:300,fixed:"right",methods:[{title:"修改",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},e=ae({enableAddModal:!1,formLoading:!1,fid:"",form:{gradeName:"",gradeType:"PREMIUM",status:"OPEN",permanent:!1,expireDay:1,price:1,sort:0}}),T=[{label:"开启",value:"OPEN"},{label:"关闭",value:"CLOSE"}];function U(){e.enableAddModal=!0,c.value="添加",e.fid="",Object.keys(e.form).forEach(a=>{e.form[a]=""}),e.form.gradeType="PREMIUM",e.form.status="OPEN",e.form.permanent=!1,e.form.sort=0}async function O(){var t;await((t=V.value)==null?void 0:t.validate())||(e.form.permanent&&(e.form.expireDay=0),(e.fid?await E(e.fid,e.form):await K(e.form)).data.success&&(y.success(`${e.fid?"修改":"添加"}成功!`),e.enableAddModal=!1,u.value.init()))}async function R(a){if(c.value="编辑",Object.keys(e.form).forEach(t=>{e.form[t]=""}),a.record.articleId){const t=await Y({ids:a.record.articleId});e.form.articleInfo=t.data.result.records,e.form.articleTitles=e.form.articleInfo.map(d=>d.title).join(",")}a&&(Object.keys(a.record).forEach(t=>{e.form[t]=a.record[t]??""}),e.fid=a.record.id,e.enableAddModal=!0,e.form.gradeType=a.record.gradeType,e.form.benefitsIds=a.record.benefitsIds,e.form.expireDay===0&&(e.form.permanent=!0))}function A(a){N.confirm({title:"确认删除",content:`您确认要删除 ${a.record.gradeName}?`,alignCenter:!1,onOk:async()=>{(await W(a.record.id)).data.success&&(y.success("删除成功"),u.value.init())}})}function S(a){C.value=a}async function j(a){a.open?a.status="OPEN":a.status="CLOSE",(await E(a.id,a)).data.success&&(y.success("操作成功"),u.value.init())}async function $(a){const t=await X(a);return t.data.result.records.forEach(d=>{d.open=d.status==="OPEN"}),t}return oe(()=>{var a,t;return(t=(a=u.value.initData)==null?void 0:a.data)==null?void 0:t.recordsList},a=>{a&&a.length&&(x.value=a)},{deep:!0,immediate:!0}),re(()=>{}),(a,t)=>{const d=n("a-button"),B=n("a-space"),F=n("a-col"),G=n("a-row"),v=n("a-switch"),H=n("a-input"),i=n("a-form-item"),g=n("a-input-number"),Q=n("a-radio-group"),q=n("a-form"),z=n("a-modal"),J=n("a-card");return I(),D(J,{class:"general-card",bordered:!1},{default:s(()=>[l(G,{style:{"margin-bottom":"16px"}},{default:s(()=>[l(F,{span:16},{default:s(()=>[l(B,null,{default:s(()=>[l(d,{type:"primary",disabled:o(x).length===3,onClick:U},{default:s(()=>t[7]||(t[7]=[p(" 添加 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),l(o(ee),{ref_key:"tablePageRef",ref:u,columns:L,methods:P,api:$,"api-params":o(k),bordered:!0,onEditor:R,onDelete:A,onSelectTableChange:S},{price:s(({data:r})=>[b("div",null," ¥ "+_(r.price),1)]),expireDay:s(({data:r})=>[b("div",null,_(r.expireDay===0?"永久":`${r.expireDay}天`),1)]),status:s(({data:r})=>[l(v,{modelValue:r.open,"onUpdate:modelValue":w=>r.open=w,onChange:w=>j(r)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["api-params"]),l(z,{visible:o(e).enableAddModal,"onUpdate:visible":t[6]||(t[6]=r=>o(e).enableAddModal=r),footer:!1,"mask-closable":!1,width:700},{title:s(()=>[p(_(o(c)),1)]),default:s(()=>[b("div",null,[l(q,{ref_key:"formRef",ref:V,model:o(e).form,onSubmit:O},{default:s(()=>[l(i,{field:"gradeName",label:"付费会员名称",rules:[o(f)],"validate-trigger":["change"]},{default:s(()=>[l(H,{modelValue:o(e).form.gradeName,"onUpdate:modelValue":t[0]||(t[0]=r=>o(e).form.gradeName=r)},null,8,["modelValue"])]),_:1},8,["rules"]),l(i,{field:"permanent",label:"是否永久","validate-trigger":["change"]},{default:s(()=>[l(v,{modelValue:o(e).form.permanent,"onUpdate:modelValue":t[1]||(t[1]=r=>o(e).form.permanent=r)},null,8,["modelValue"])]),_:1}),o(e).form.permanent?le("",!0):(I(),D(i,{key:0,field:"expireDay",label:"有效期",tooltip:"付费会员的有效日期(天)",rules:[o(f)],"validate-trigger":["change"]},{default:s(()=>[l(g,{modelValue:o(e).form.expireDay,"onUpdate:modelValue":t[2]||(t[2]=r=>o(e).form.expireDay=r),style:{width:"320px"},placeholder:"请输入付费会员的有效日期","default-value":1,mode:"button",min:1,class:"input-demo",formatter:o(M)},{suffix:s(()=>t[8]||(t[8]=[p(" 天 ")])),_:1},8,["modelValue","formatter"])]),_:1},8,["rules"])),l(i,{field:"price",label:"价格",tooltip:"当前付费会员的售价",rules:[o(f)],"validate-trigger":["change"]},{default:s(()=>[l(g,{modelValue:o(e).form.price,"onUpdate:modelValue":t[3]||(t[3]=r=>o(e).form.price=r),style:{width:"320px"},placeholder:"请输入当前付费会员的售价","default-value":1,mode:"button",min:1,class:"input-demo"},null,8,["modelValue"])]),_:1},8,["rules"]),l(i,{field:"sort",label:"排序",tooltip:"当前付费会员的排序值",rules:[o(f)],"validate-trigger":["change"]},{default:s(()=>[l(g,{modelValue:o(e).form.sort,"onUpdate:modelValue":t[4]||(t[4]=r=>o(e).form.sort=r),style:{width:"320px"},placeholder:"请输入当前付费会员的排序值","default-value":0,mode:"button",min:0,class:"input-demo",formatter:o(M)},null,8,["modelValue","formatter"])]),_:1},8,["rules"]),l(i,{field:"displayLevel",label:"是否启用","validate-trigger":["change"]},{default:s(()=>[l(Q,{modelValue:o(e).form.status,"onUpdate:modelValue":t[5]||(t[5]=r=>o(e).form.status=r),options:T},null,8,["modelValue"])]),_:1}),l(i,{label:"操作"},{default:s(()=>[l(d,{loading:o(e).formLoading,"html-type":"submit",type:"primary"},{default:s(()=>t[9]||(t[9]=[p(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"])]),_:1})}}}),be=se(ne,[["__scopeId","data-v-7aa0a664"]]);export{be as default};
