import{o as W,p as N,q as X,r as Y}from"./goods-CB7YWqUH.js";import{u as Z}from"./useCurrentInstance-BLlvmEjv.js";import{U as ee,V as te}from"./dist-PezRi_EG.js";import{d as ae,r as c,a as le,b as i,o as k,c as h,e as a,w as l,u as n,f as p,t as S,k as oe,F as T,i as se,j as ne,q as ie,M as m}from"./index-C4AMdMz2.js";const re={style:{"text-align":"right"}},fe=ae({__name:"list",setup(ce){var w;const f=c({}),d=c(),y=(w=Z().globalProperties)==null?void 0:w.$modal,_=c([]),g=c(""),V=c(""),u=c(!1),b=c(0),x=c([]),o=le({specName:"",specValue:"",id:""}),v=c([]),D=[{label:"规格名称",model:"specName",disabled:!1,input:!0}],P=[{title:"规格名称",dataIndex:"specName",width:150},{title:"规格值",dataIndex:"specValue",width:150}],U={title:"操作",width:250,fixed:"right",methods:[{title:"编辑",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]};function $(t){t&&(x.value=t.records)}function B(t){y.confirm({title:"确认删除",content:`您确认要删除${t.record.specName}?`,alignCenter:!1,onOk:async()=>{(await N(t.record.id)).data.success&&(m.success("删除成功"),d.value.init())}})}function L(){b.value=0,g.value="添加",delete o.id,v.value=[],u.value=!0}function R(t){b.value=1,g.value="编辑";for(let r=0;r<t.record;r+=1)t[r]===null&&(t[r]="");const e=t.record.specValue;o.specName=t.record.specName,o.id=t.record.id,o.specValue=t.record.specValue,e&&e.indexOf(",")>0?(o.specValue=e.split(","),v.value=o.specValue):v.value=[],u.value=!0}function j(t){_.value=t}function E(){if(_.value.length<=0){m.error("您还未选择要删除的数据");return}_.value.forEach(e=>{V.value+=`${e.id},`});const t=V.value.substring(0,V.value.length-1);y.confirm({title:"确认删除",content:`您确认要删除所选的${_.value.length}条数据?`,alignCenter:!1,onOk:async()=>{(await N(t)).data.success&&(m.success("删除成功"),d.value.init(),d.value.clearSelect())}})}function I(){const t={...o,specValue:o.specValue.join(",")};if(b.value===0){if(x.value.find(e=>e.specName===o.specName)){m.error("请勿添加重复规格名称!");return}delete t.id,X(t).then(e=>{e.data.success&&(m.success("操作成功"),u.value=!1,d.value.init())})}else Y(o.id,t).then(e=>{e.data.success&&(m.success("操作成功"),u.value=!1,d.value.init())})}return(t,e)=>{const r=i("a-button"),M=i("a-space"),O=i("a-col"),q=i("a-row"),F=i("a-image"),A=i("a-card"),z=i("a-input"),C=i("a-form-item"),G=i("a-option"),H=i("a-select"),J=i("a-form"),K=i("a-modal");return k(),h(T,null,[a(A,{class:"general-card",title:"规格列表",bordered:!1},{default:l(()=>[a(n(ee),{columns:D,onReset:e[0]||(e[0]=s=>{f.value={...n(f),...s}}),onSearch:e[1]||(e[1]=s=>{f.value={...n(f),...s}})}),a(q,{style:{"margin-bottom":"16px"}},{default:l(()=>[a(O,{span:16},{default:l(()=>[a(M,null,{default:l(()=>[a(r,{type:"primary",onClick:L},{default:l(()=>e[6]||(e[6]=[p(" 添加 ")])),_:1}),a(r,{onClick:E},{default:l(()=>e[7]||(e[7]=[p(" 批量删除 ")])),_:1})]),_:1})]),_:1})]),_:1}),a(n(te),{ref_key:"tablePageRef",ref:d,columns:P,methods:U,api:n(W),checkbox:!0,bordered:!0,"api-params":n(f),onDelete:B,onSelectTableChange:j,onParentComponentData:$,onEditor:R},{logo:l(({data:s})=>[a(F,{width:"100",height:"100",src:s.logo},null,8,["src"])]),_:1},8,["api","api-params"])]),_:1}),a(K,{visible:n(u),"onUpdate:visible":e[5]||(e[5]=s=>ie(u)?u.value=s:null),width:500},{title:l(()=>[p(S(n(g)),1)]),footer:l(()=>[oe("div",re,[a(r,{style:{"margin-right":"5px"},onClick:e[4]||(e[4]=s=>u.value=!1)},{default:l(()=>e[8]||(e[8]=[p(" 取消 ")])),_:1}),a(r,{type:"primary",onClick:I},{default:l(()=>e[9]||(e[9]=[p(" 提交 ")])),_:1})])]),default:l(()=>[a(J,{model:n(o)},{default:l(()=>[a(C,{field:"specName",label:"规格名称"},{default:l(()=>[a(z,{modelValue:n(o).specName,"onUpdate:modelValue":e[2]||(e[2]=s=>n(o).specName=s)},null,8,["modelValue"])]),_:1}),a(C,{field:"specValue",label:"规格值"},{default:l(()=>[a(H,{modelValue:n(o).specValue,"onUpdate:modelValue":e[3]||(e[3]=s=>n(o).specValue=s),style:{width:"320px"},placeholder:"输入后回车添加","allow-create":"",multiple:""},{default:l(()=>[(k(!0),h(T,null,se(n(v),(s,Q)=>(k(),ne(G,{key:Q,value:s},{default:l(()=>[p(S(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}});export{fe as default};
