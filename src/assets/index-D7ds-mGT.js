import{d as we,r as a,b as f,o as m,j as S,w as n,e as r,u as t,k as i,f as s,C as K,t as d,s as k,c as E,q as N,M as O,_ as ge}from"./index-C4AMdMz2.js";import{D as Ce,c as X,v as Pe,E as Ie,f as Re,F as Fe,G as Ve}from"./order-HsmDfkng.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-CDd49swx.js";import{u as Ee}from"./useCurrentInstance-BLlvmEjv.js";import{u as v}from"./filters-D05Q2eUM.js";import{R as U,Y as Oe,Z as Te,Q as h}from"./tools-BfzgO_2s.js";import{U as Me,V as A}from"./dist-PezRi_EG.js";import"./index-Dg8m97qn.js";import"./shops-fXVW_gE8.js";import"./validator-B8pIxTAL.js";import"./index-D43NcXdt.js";const $e={"mb-20px":"",flex:""},Ne={"mr-40px":""},Ue={key:1,class:"statistical-data","mb-20px":"",flex:"","justify-between":""},Ae=["onClick"],qe={key:1},Le={key:2},Be={key:3},We=["onClick"],je=["onClick"],ze=we({__name:"index",setup(Ge){var Y;const ee=a(""),u=a({refundStatus:ee.value}),T=a(),R=(Y=Ee().globalProperties)==null?void 0:Y.$modal,te=[{label:"流水编号",model:"orderFlowSn",disabled:!1,input:!0},{label:"订单编号",model:"orderSn",disabled:!1,input:!0},{label:"起始时间",disabled:!1,datePicker:{type:"range"}},{label:"支付方式",model:"paymentMethod",disabled:!1,select:{options:U}},{label:"待审核端",model:"waitAuditScene",disabled:!1,select:{options:Oe}}],le=[{title:"账单号",dataIndex:"sn"},{title:"订单号",dataIndex:"orderSn"},{title:"实际支付",dataIndex:"flowPrice",currency:!0},{title:"实际退款",dataIndex:"refundPrice",currency:!0},{title:"平台结算金额",dataIndex:"platformSettlementPrice",currency:!0},{title:"店铺结算金额",dataIndex:"sellerSettlementPrice",currency:!0},{title:"分销佣金",dataIndex:"distributionSettlementPrice",currency:!0},{title:"支付方式名称",dataIndex:"paymentMethod",slot:!0,slotData:{badge:U}},{title:"审核状态",dataIndex:"orderFlowStatus",slot:!0,slotTemplate:"orderFlowStatus"},{title:"结算状态",dataIndex:"profitSharing",slot:!0,slotData:{badge:Te}},{title:"生成时间",dataIndex:"createTime"}],oe={title:"操作",width:80,methods:[{title:"操作",callback:"action",slot:!0,slotTemplate:"action"}]},b=a(!1),F=a({orderSn:""}),q=[{title:"订单号",dataIndex:"sn",slot:!0,slotTemplate:"sn"},{title:"平台审核",dataIndex:"platformVerify",slot:!0,slotData:{badge:h}},{title:"店铺审核",dataIndex:"storeVerify",slot:!0,slotData:{badge:h}},{title:"流水金额",dataIndex:"flowPrice",currency:!0},{title:"平台结算金额",dataIndex:"platformSettlementPrice",currency:!0},{title:"店铺结算金额",dataIndex:"sellerSettlementPrice",currency:!0},{title:"支付方式名称",dataIndex:"paymentMethod",slot:!0,slotData:{badge:U}}],L=a({}),_=a([]),B=a(""),x=a(!1),W=a([]),j=a(""),V=a({}),p=a({}),w=a(!1),ne=a("");function re(o){let e="";return[{condition:!o.storeVerify,message:"等待店铺审核、"},{condition:!o.supplierVerify,message:"等待供应商核验审核、"},{condition:!o.platformVerify,message:"等待平台审核、"}].forEach(({condition:M,message:c})=>{M&&(e+=c)}),e}async function ae(o){b.value=!0,F.value.orderSn=o.orderSn,L.value=o,await X(F.value).then(e=>{e.data.success&&(_.value=e.data.result)})}function z(o){R.confirm({title:"提示",content:`${o==="verify"?"审核通过":"审核拒绝"}该订单?`,alignCenter:!1,onOk:async()=>{(await Pe(_.value[0].id,o)).data.success&&(O.success("审核成功"),b.value=!1,T.value.init())}})}async function se(){R.confirm({title:"确认导出",content:"确定要导出订单流水数据吗？导出功能为异步导出，需要去 运营 - 导出记录 下载",onOk:async()=>{(await Ie(u.value)).data.success&&O.success("导出成功,请前往 “运营 - 导出记录” 进行下载")}})}function ie(){R.confirm({title:"警告",content:"您确定要强制审核通过当前异常流水订单吗？",alignCenter:!1,onOk:async()=>{(await Re({orderSn:_.value[0].orderSn})).data.success&&(O.success("审核成功"),b.value=!1,T.value.init())}})}async function de(o){x.value=!0,F.value.orderSn=o.orderSn,W.value=o,await X(F.value).then(e=>{e.data.success&&(_.value=e.data.result)})}function ue(){R.confirm({title:"提示",content:"您确定要手动结算该订单吗？",alignCenter:!1,onOk:async()=>{(await Fe({id:W.value.id,remark:V.value.manualSettledRemark})).data.success&&(O.success("手动结算成功"),x.value=!1,j.value.init())}})}function fe(){Ve(u.value).then(o=>{o.data.success&&(p.value=o.data.result)}),w.value=!0}const G=a(""),y=a({}),Q=a({}),g=a(!1),C=a("STORE"),ce=a([]);function me(o,e){o.stopPropagation(),g.value=!0,G.value.init(),C.value=e}function pe(o,e){o.stopPropagation(),u.value.storeId=null,y.value={}}function ve(o){C.value==="STORE"?(u.value.storeId=o.id,y.value={id:o.id,storeName:o.storeName}):C.value==="SUPPLIER"&&(u.value.supplierId=o.id,Q.value={id:o.id,storeName:o.storeName}),g.value=!1}function ye(o){["startDate","endDate"].forEach(e=>{o[e]||(delete u.value[e],delete o[e])}),u.value.storeId="",u.value.supplierId="",y.value={},Q.value={},u.value={...u.value,...o}}return(o,e)=>{const Z=f("a-link"),M=f("icon-close"),c=f("a-button"),P=f("a-card"),D=f("a-badge"),H=f("a-tooltip"),Se=f("icon-question-circle-fill"),ke=f("a-alert"),J=f("a-col"),$=f("a-modal"),be=f("a-input"),_e=f("a-form-item"),xe=f("a-form");return m(),S(P,{class:"general-card",title:"订单流水",bordered:!1},{default:n(()=>[r(t(Me),{ref_key:"PickSearchColumnRef",ref:ne,columns:te,onReset:ye,onSearch:e[0]||(e[0]=l=>{u.value={...t(u),...l}})},null,512),i("div",$e,[i("div",Ne,[e[10]||(e[10]=s(" 店铺： ")),r(Z,{onClick:e[1]||(e[1]=K(l=>me(l,"STORE"),["prevent"]))},{default:n(()=>[s(d(t(y)&&t(y).storeName?t(y).storeName:"选择店铺"),1)]),_:1}),t(y)&&t(y).storeName?(m(),S(M,{key:0,"cursor-pointer":"",onClick:e[2]||(e[2]=K(l=>pe(l,"STORE"),["prevent"]))})):k("",!0)])]),r(c,{type:"primary","mb-20px":"",onClick:fe},{default:n(()=>[s(d(t(w)?"更新统计数据":"统计面板"),1)]),_:1}),t(w)?(m(),S(c,{key:0,type:"primary","mb-20px":"","ml-10px":"",onClick:e[3]||(e[3]=l=>w.value=!1)},{default:n(()=>e[11]||(e[11]=[s(" 关闭统计 ")])),_:1})):k("",!0),r(c,{type:"primary","mb-20px":"","ml-10px":"",onClick:se},{default:n(()=>e[12]||(e[12]=[s(" 导出流水 ")])),_:1}),t(w)?(m(),E("div",Ue,[r(P,{title:"平台合计"},{default:n(()=>[i("div",null,"流水总金额："+d(t(v)(t(p).flowPrice,"￥")),1),i("div",null,"退款总金额："+d(t(v)(t(p).refundPrice,"￥")),1),i("div",null,"已结算总金额："+d(t(v)(t(p).settledPrice,"￥")),1)]),_:1}),r(P,{title:"平台合计"},{default:n(()=>[i("div",null,"平台利润结算金额："+d(t(v)(t(p).platformSettlementPrice,"￥")),1),i("div",null,"平台利润已结算金额："+d(t(v)(t(p).platformSettledPrice,"￥")),1)]),_:1}),r(P,{title:"店铺合计"},{default:n(()=>[i("div",null,"店铺结算金额："+d(t(v)(t(p).sellerSettlementPrice,"￥")),1),i("div",null,"店铺已结算金额："+d(t(v)(t(p).sellerSettledPrice,"￥")),1)]),_:1}),r(P,{title:"分销商合计"},{default:n(()=>[i("div",null,"分销商返现支出："+d(t(v)(t(p).distributorSettlementPrice,"￥")),1),i("div",null,"分销商已结算金额："+d(t(v)(t(p).distributorSettledPrice,"￥")),1)]),_:1})])):k("",!0),r(t(A),{ref_key:"orderFlowRef",ref:T,columns:le,methods:oe,api:t(Ce),"api-params":t(u),bordered:!0},{orderFlowStatus:n(({data:l})=>[l.orderFlowStatus==="AUDIT"?(m(),S(H,{key:0,content:re(l),position:"right",mini:""},{default:n(()=>[i("span",{"cursor-pointer":"",onClick:I=>o.pursueManagerPayment(l)},[r(D,{"mr-5px":"",color:"gold"}),e[13]||(e[13]=s("待审核 ？"))],8,Ae)]),_:2},1032,["content"])):l.orderFlowStatus==="PASS"?(m(),E("div",qe,[r(D,{"mr-5px":"",color:"green"}),e[14]||(e[14]=s(" 审核通过 "))])):l.orderFlowStatus==="FORCE_PASS"?(m(),E("div",Le,[r(D,{"mr-5px":"",color:"purple"}),e[15]||(e[15]=s(" 平台强制通过 "))])):l.orderFlowStatus==="REFUSE"?(m(),E("div",Be,[r(D,{"mr-5px":"",color:"red"}),e[16]||(e[16]=s(" 审核不通过 "))])):k("",!0)]),action:n(({data:l})=>[r(c,{type:"text",status:"success","mr-10px":"",onClick:I=>o.$openWindow({name:"order-flow-detail",query:{id:l.id}})},{default:n(()=>e[17]||(e[17]=[s(" 详情 ")])),_:2},1032,["onClick"]),l.errorMsg?(m(),S(H,{key:0,content:l.errorMsg},{default:n(()=>[r(Se)]),_:2},1032,["content"])):k("",!0),!l.platformVerify||!l.storeVerify||!l.supplierVerify?(m(),S(c,{key:1,type:"text",status:"warning","mr-10px":"",onClick:I=>ae(l)},{default:n(()=>e[18]||(e[18]=[s(" 审核 ")])),_:2},1032,["onClick"])):k("",!0),l.settlementStatus==="UNSETTLED"||l.settlementStatus==="SETTLED_FAIL"?(m(),S(c,{key:2,type:"text",status:"danger",onClick:I=>de(l)},{default:n(()=>e[19]||(e[19]=[s(" 手动结算 ")])),_:2},1032,["onClick"])):k("",!0)]),_:1},8,["api","api-params"]),r($,{visible:t(b),"onUpdate:visible":e[6]||(e[6]=l=>N(b)?b.value=l:null),"align-center":!1,width:1200},{title:n(()=>e[20]||(e[20]=[s(" 待审核订单 ")])),footer:n(()=>[t(L).platformVerify?k("",!0):(m(),S(c,{key:0,type:"primary",status:"danger",onClick:e[4]||(e[4]=l=>z("verify"))},{default:n(()=>e[23]||(e[23]=[s(" 通过 ")])),_:1})),r(c,{onClick:e[5]||(e[5]=l=>z("refuse"))},{default:n(()=>e[24]||(e[24]=[s(" 取消订单 ")])),_:1}),r(c,{onClick:ie},{default:n(()=>e[25]||(e[25]=[s(" 强制审核通过 ")])),_:1})]),default:n(()=>[r(t(A),{ref_key:"verifyDataRef",ref:B,columns:q,"data-list":t(_),"enable-pagination":!1,bordered:!0},{sn:n(({data:l})=>[i("span",{"cursor-pointer":"","text-blue-500":"",onClick:I=>o.$openWindow({name:"order-detail",query:{id:l.orderSn}})},d(l.sn),9,We)]),_:1},8,["data-list"]),r(J,{span:24,"my-10px":""},{default:n(()=>[r(ke,{type:"warning"},{title:n(()=>e[21]||(e[21]=[s(" 操作提示：异常流水是因为某一端出现负流水，业务流程可能存在使用不当问题。 ")])),default:n(()=>[e[22]||(e[22]=i("div",{"text-13px":""},[i("div",null," 通过：当前客户端为管理端，则通过平台审核；为店铺端则通过店铺端审核。通常情况下这种订单无法进行分账，平台需要线下协商处理特殊订单。 "),i("div",null," 取消订单：取消订单，实际为拒绝异常流水订单继续执行，则可以将此订单退回，用户端会看到订单取消状态，且自动退款。 "),i("div",null," 强制审核通过：会强制所有客户端流程通过，且所有费用由平台支出，不建议使用。通常情况下这种订单无法进行分账，平台需要线下协商处理特殊订单。 ")],-1))]),_:1})]),_:1})]),_:1},8,["visible"]),r($,{visible:t(x),"onUpdate:visible":e[8]||(e[8]=l=>N(x)?x.value=l:null),"align-center":!1,width:1200},{title:n(()=>e[26]||(e[26]=[s(" 手动结算订单 ")])),footer:n(()=>[r(c,{onClick:ue},{default:n(()=>e[27]||(e[27]=[s(" 确认结算 ")])),_:1})]),default:n(()=>[r(t(A),{ref_key:"verifyDataRef",ref:B,columns:q,"data-list":t(_),"enable-pagination":!1,bordered:!0},{sn:n(({data:l})=>[i("span",{"cursor-pointer":"","text-blue-500":"",onClick:I=>o.$openWindow({name:"order-detail",query:{id:l.orderSn}})},d(l.sn),9,je)]),_:1},8,["data-list"]),r(J,{span:24,"my-10px":""},{default:n(()=>[r(xe,{ref_key:"manualSettledRef",ref:j,model:t(V),layout:"horizontal","auto-label-width":""},{default:n(()=>[r(_e,{field:"manualSettledRemark",label:"审核备注"},{default:n(()=>[r(be,{modelValue:t(V).manualSettledRemark,"onUpdate:modelValue":e[7]||(e[7]=l=>t(V).manualSettledRemark=l),placeholder:"请输入手动审核备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["visible"]),r($,{visible:t(g),"onUpdate:visible":e[9]||(e[9]=l=>N(g)?g.value=l:null),width:"1300px",footer:!1},{title:n(()=>[s(d(t(C)==="STORE"?"店铺":"供应商")+"选择器 ",1)]),default:n(()=>[r(De,{ref_key:"storeLayout",ref:G,"selected-list":t(ce),"store-type":t(C),onCallback:ve},null,8,["selected-list","store-type"])]),_:1},8,["visible"])]),_:1})}}}),ot=ge(ze,[["__scopeId","data-v-61b22866"]]);export{ot as default};
