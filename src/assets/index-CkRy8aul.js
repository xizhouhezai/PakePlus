import{b as j,c as E,v as Q,f as z}from"./order-HsmDfkng.js";import{u as G}from"./useCurrentInstance-BLlvmEjv.js";import{P as I,Q as p,R as V}from"./tools-BfzgO_2s.js";import{U as H,V as D}from"./dist-PezRi_EG.js";import{d as J,r as s,h as K,b as f,o as v,j as b,w as a,e as n,u as r,f as l,s as F,q as L,k as m,t as X,M as P}from"./index-C4AMdMz2.js";const Y=["onClick"],oe=J({__name:"index",setup(Z){var S;const _=s(""),d=s({refundStatus:_.value}),y=s(),x=(S=G().globalProperties)==null?void 0:S.$modal,$=[{label:"订单编号",model:"orderSn",disabled:!1,input:!0},{label:"流水状态",model:"orderFlowStatus",disabled:!1,select:{options:I}}],M=[{title:"账单号",dataIndex:"sn"},{title:"生成时间",dataIndex:"createTime"},{title:"平台审核",dataIndex:"platformVerify",slot:!0,slotData:{badge:p}},{title:"店铺审核",dataIndex:"storeVerify",slot:!0,slotData:{badge:p}},{title:"流水金额",dataIndex:"flowPrice",currency:!0},{title:"平台结算金额",dataIndex:"sellerSettlementPrice",currency:!0},{title:"支付方式名称",dataIndex:"paymentMethod",slot:!0,slotData:{badge:V}},{title:"流水状态",dataIndex:"orderFlowStatus",slot:!0,slotData:{badge:I}}],O={title:"操作",width:260,methods:[{title:"操作",callback:"action",slot:!0,slotTemplate:"action"}]},i=s(!1),w=s({orderSn:""}),R=[{title:"订单号",dataIndex:"sn",slot:!0,slotTemplate:"sn"},{title:"平台审核",dataIndex:"platformVerify",slot:!0,slotData:{badge:p}},{title:"店铺审核",dataIndex:"storeVerify",slot:!0,slotData:{badge:p}},{title:"流水金额",dataIndex:"flowPrice",currency:!0},{title:"平台结算金额",dataIndex:"platformSettlementPrice",currency:!0},{title:"店铺结算金额",dataIndex:"sellerSettlementPrice",currency:!0},{title:"支付方式名称",dataIndex:"paymentMethod",slot:!0,slotData:{badge:V}}],g=s({}),c=s([]),T=s("");async function N(o){i.value=!0,w.value.orderSn=o.orderSn,g.value=o,await E(w.value).then(e=>{e.data.success&&(c.value=e.data.result)})}function k(o){x.confirm({title:"提示",content:`${o==="verify"?"审核通过":"审核拒绝"}该订单?`,alignCenter:!1,onOk:async()=>{(await Q(c.value[0].id,o)).data.success&&(P.success("审核成功"),i.value=!1,y.value.init())}})}function U(){x.confirm({title:"警告",content:"您确定要强制审核通过当前异常流水订单吗？",alignCenter:!1,onOk:async()=>{(await z({orderSn:c.value[0].orderSn})).data.success&&(P.success("审核成功"),i.value=!1,y.value.init())}})}return K(()=>{}),(o,e)=>{const u=f("a-button"),q=f("a-alert"),A=f("a-col"),B=f("a-modal"),W=f("a-card");return v(),b(W,{class:"general-card",title:"异常流水",bordered:!1},{default:a(()=>[n(r(H),{columns:$,onReset:e[0]||(e[0]=t=>{d.value={...r(d),...t}}),onSearch:e[1]||(e[1]=t=>{d.value={...r(d),...t}})}),n(r(D),{ref_key:"orderFlowRef",ref:y,columns:M,methods:O,api:r(j),"api-params":r(d),bordered:!0},{action:a(({data:t})=>[n(u,{type:"text",status:"success","mr-10px":"",onClick:C=>o.$openWindow({name:"order-flow-detail",query:{id:t.id}})},{default:a(()=>e[5]||(e[5]=[l(" 详情 ")])),_:2},1032,["onClick"]),t.orderFlowStatus==="AUDIT"?(v(),b(u,{key:0,type:"text",status:"warning","mr-10px":"",onClick:C=>N(t)},{default:a(()=>e[6]||(e[6]=[l(" 审核 ")])),_:2},1032,["onClick"])):F("",!0)]),_:1},8,["api","api-params"]),n(B,{visible:r(i),"onUpdate:visible":e[4]||(e[4]=t=>L(i)?i.value=t:null),"align-center":!1,width:1200},{title:a(()=>e[7]||(e[7]=[l(" 待审核订单 ")])),footer:a(()=>[r(g).platformVerify?F("",!0):(v(),b(u,{key:0,type:"primary",status:"danger",onClick:e[2]||(e[2]=t=>k("verify"))},{default:a(()=>e[10]||(e[10]=[l(" 通过 ")])),_:1})),n(u,{onClick:e[3]||(e[3]=t=>k("refuse"))},{default:a(()=>e[11]||(e[11]=[l(" 取消订单 ")])),_:1}),n(u,{onClick:U},{default:a(()=>e[12]||(e[12]=[l(" 强制审核通过 ")])),_:1})]),default:a(()=>[n(r(D),{ref_key:"verifyDataRef",ref:T,columns:R,"data-list":r(c),"enable-pagination":!1,bordered:!0},{sn:a(({data:t})=>[m("span",{"cursor-pointer":"","text-blue-500":"",onClick:C=>o.$openWindow({name:"order-detail",query:{id:t.orderSn}})},X(t.sn),9,Y)]),_:1},8,["data-list"]),n(A,{span:24,"my-10px":""},{default:a(()=>[n(q,{type:"warning"},{title:a(()=>e[8]||(e[8]=[l(" 操作提示：异常流水是因为某一端出现负流水，业务流程可能存在使用不当问题。 ")])),default:a(()=>[e[9]||(e[9]=m("div",{"text-13px":""},[m("div",null,"通过：当前客户端为管理端，则通过平台审核；为店铺端则通过店铺端审核。通常情况下这种订单无法进行分账，平台需要线下协商处理特殊订单。"),m("div",null,"取消订单：取消订单，实际为拒绝异常流水订单继续执行，则可以将此订单退回，用户端会看到订单取消状态，且自动退款。"),m("div",null,"强制审核通过：会强制所有客户端流程通过，且所有费用由平台支出，不建议使用。通常情况下这种订单无法进行分账，平台需要线下协商处理特殊订单。")],-1))]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1})}}});export{oe as default};
