import{g as U,u as W,d as Y}from"./promotion-ChRoyrm_.js";import{u as F}from"./useCurrentInstance-BLlvmEjv.js";import{C as j,D as G,E as Z,F as z,G as H}from"./tools-BfzgO_2s.js";import{U as J,V as K}from"./dist-PezRi_EG.js";import{d as Q,n as X,r as T,b as p,o as l,j as y,w as o,e as n,u as a,f as i,c as f,t as u,s as d,k as ee,M as v}from"./index-C4AMdMz2.js";const te={key:0},oe={key:1},se={key:2},ne={key:0},ie={key:1},ce=Q({__name:"list",emits:["selectTableChange"],setup(le,{emit:I}){var N;const E=I,k=X(),b=(N=F().globalProperties)==null?void 0:N.$modal,h=T([]),C=T(),_=T("START"),m=T({sort:"create_time",storeId:0,promotionStatus:_.value}),D=[{label:"优惠券名称",model:"couponName",disabled:!1,input:!0},{label:"获取方式",model:"getType",disabled:!1,select:{options:j}},{label:"活动时间",model:"selectDate",disabled:!1,datePicker:{type:"range"}}],$=[{title:"优惠券名称",dataIndex:"couponName",width:150},{title:"优惠内容",dataIndex:"price",slot:!0,slotTemplate:"price"},{title:"领取量/总数量",width:150,dataIndex:"publishNum",slot:!0,slotTemplate:"publishNum"},{title:"使用量/领取量",width:150,dataIndex:"useNum",slot:!0,slotTemplate:"useNum"},{title:"获取方法",dataIndex:"getType",slot:!0,slotData:{badge:G}},{title:"优惠券类型",dataIndex:"couponType",slot:!0,slotData:{badge:Z}},{title:"品类描述",dataIndex:"scopeType",slot:!0,slotData:{badge:z}},{title:"活动时间",width:180,ellipsis:!1,dataIndex:"startTime",slot:!0,slotTemplate:"time"},{title:"状态",dataIndex:"promotionStatus",slot:!0,slotData:{badge:H}}],w={title:"操作",width:280,methods:[{title:"编辑",slot:!0,slotTemplate:"edit"}]};function R(s){s&&(h.value=s,E("selectTableChange",{values:s,___type:"pages"}))}function S(s){k.push({name:"edit-platform-coupon",query:{type:s}})}function V(s){b.confirm({title:"确认关闭",content:"确认要关闭此优惠券么?",alignCenter:!1,onOk:async()=>{W({couponIds:s.id,effectiveDays:0}).then(t=>{t.data.success&&(v.success("优惠券已关闭"),C.value.init())})}})}function P(s){b.confirm({title:"确认删除",content:"确认要删除此优惠券么?",alignCenter:!1,onOk:async()=>{Y(s.id).then(t=>{t.data.success&&(v.success("优惠券已关闭"),C.value.init())})}})}function x(s,t){const c={id:s.id,onlyView:t?"true":void 0};k.push({name:"edit-platform-coupon",query:c})}function O(s){k.push({name:"coupon-receive",query:s.id?{id:s.id}:{}})}return(s,t)=>{const c=p("a-tab-pane"),A=p("a-tabs"),r=p("a-button"),L=p("a-space"),M=p("a-col"),B=p("a-row"),q=p("a-card");return l(),y(q,{class:"general-card",title:"优惠券",bordered:!1},{default:o(()=>[n(A,{"default-active-key":a(_),onChange:t[0]||(t[0]=e=>{a(m).promotionStatus=e})},{default:o(()=>[n(c,{key:"NEW",title:"未开始"}),n(c,{key:"START",title:"已开始"}),n(c,{key:"END",title:"已结束"}),n(c,{key:"CLOSE",title:"已关闭"})]),_:1},8,["default-active-key"]),n(a(J),{columns:D,"time-type":"timestamp",onReset:t[1]||(t[1]=e=>{m.value={...a(m),...e}}),onSearch:t[2]||(t[2]=e=>{m.value={...a(m),...e}})}),n(B,{style:{"margin-bottom":"16px"}},{default:o(()=>[n(M,{span:16},{default:o(()=>[n(L,null,{default:o(()=>[n(r,{type:"primary",onClick:t[3]||(t[3]=e=>S("FREE"))},{default:o(()=>t[5]||(t[5]=[i(" 添加通用优惠券 ")])),_:1}),n(r,{type:"primary",onClick:t[4]||(t[4]=e=>S("ACTIVITY"))},{default:o(()=>t[6]||(t[6]=[i(" 添加活动优惠券 ")])),_:1})]),_:1})]),_:1})]),_:1}),n(a(K),{ref_key:"tablePageRef",ref:C,columns:$,methods:w,api:a(U),"api-params":a(m),checkbox:!0,bordered:!0,onSelectTableChange:R},{price:o(({data:e})=>[e.couponType==="ZERO"?(l(),f("span",te,"减"+u(e.price)+"元",1)):d("",!0),e.couponType==="PRICE"?(l(),f("span",oe,"满"+u(e.consumeThreshold)+"减"+u(e.price)+"元",1)):d("",!0),e.couponType==="DISCOUNT"?(l(),f("span",se,"打"+u(e.couponDiscount)+"折",1)):d("",!0)]),publishNum:o(({data:e})=>[i(u(`${e.usedNum}/${e.receivedNum}/${e.publishNum===0?"不限制":e.publishNum}`),1)]),useNum:o(({data:e})=>[i(u(`${e.usedNum}/${e.receivedNum}`),1)]),time:o(({data:e})=>[(e==null?void 0:e.getType)==="ACTIVITY"&&(e==null?void 0:e.rangeDayType)==="DYNAMICTIME"?(l(),f("div",ne," 长期有效 ")):e.startTime&&e.endTime?(l(),f("div",ie,[i(u(e.startTime)+" ",1),t[7]||(t[7]=ee("div",{style:{margin:"0"}},null,-1)),i(u(e.endTime),1)])):d("",!0)]),edit:o(({data:e})=>[e.promotionStatus==="CLOSE"||e.promotionStatus==="NEW"?(l(),y(r,{key:0,style:{"margin-right":"10px"},type:"text",status:"warning",onClick:g=>x(e)},{default:o(()=>t[8]||(t[8]=[i(" 编辑 ")])),_:2},1032,["onClick"])):(l(),y(r,{key:1,style:{"margin-right":"10px"},type:"text",status:"success",onClick:g=>x(e,"onlyView")},{default:o(()=>t[9]||(t[9]=[i(" 查看 ")])),_:2},1032,["onClick"])),e.promotionStatus==="START"||e.promotionStatus==="NEW"?(l(),y(r,{key:2,style:{"margin-right":"10px"},type:"text",status:"danger",onClick:g=>V(e)},{default:o(()=>t[10]||(t[10]=[i(" 关闭 ")])),_:2},1032,["onClick"])):d("",!0),e.promotionStatus==="CLOSE"||e.promotionStatus==="END"?(l(),y(r,{key:3,style:{"margin-right":"10px"},type:"text",status:"danger",onClick:g=>P(e)},{default:o(()=>t[11]||(t[11]=[i(" 删除 ")])),_:2},1032,["onClick"])):d("",!0),n(r,{style:{margin:"5px"},type:"text",onClick:g=>O(e)},{default:o(()=>t[12]||(t[12]=[i(" 领取记录 ")])),_:2},1032,["onClick"])]),_:1},8,["api","api-params"])]),_:1})}}});export{ce as _};
