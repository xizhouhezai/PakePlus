import{d as se,r as u,h as de,b as d,o as k,j as H,w as l,e as t,u as a,q as y,f as i,k as K,t as V,c as R,s as M,A as ue,F as ie,i as re,be as ce,M as v,bf as me,bg as fe,bh as pe,bi as _e,_ as ve}from"./index-C4AMdMz2.js";import{u as be}from"./useCurrentInstance-BLlvmEjv.js";import{R as h}from"./validator-B8pIxTAL.js";const ke={key:0},ge=se({__name:"index",setup(ye){var B;const j=(B=be().globalProperties)==null?void 0:B.$modal,I=u(),U=u([]),g=u(!0),C=u(""),w=u(!1),c=u(!1),r=u({}),D=u([]),p=u([]),E=u(""),_=u([]),s=u({id:"",title:"",sortOrder:0,isRead:!1}),S=u(),F=u();function x(){ce().then(o=>{o.data.success&&(S.value=o.data.result)})}function q(){C.value="添加一级部门",w.value=!1,r.value={parentId:0,sortOrder:0,status:0},c.value=!0}function Q(){if(s.value.id===""||s.value.id===null){v.warning("请先点击选择一个部门");return}C.value="添加子部门",w.value=!0,r.value={parentId:s.value.id,sortOrder:0,status:0},c.value=!0}function O(){x()}function N(o,e){G(o,e),E.value=e.node.title,me({pageNumber:1,pageSize:1e4}).then(b=>{b.data.success&&(U.value=b.data.result.records,s.value=e.node,_.value=e.node.roleIds?e.node.roleIds.split(","):[])})}function G(o,e){D.value.push(e.node)}function J(){fe(r.value).then(o=>{o.data.success&&(v.success("添加成功"),c.value=!1,O())})}function W(){c.value=!1}function X(){if(p.value.length<=0){v.warning("您还未勾选要删除的数据");return}j.confirm({title:"确认删除",content:`您确认要删除所选的${p.value.length}条数据及其下级所有数据?`,alignCenter:!1,onOk:async()=>{let o="";p.value.forEach(m=>{o+=`${m},`});const e=o.substring(0,o.length-1);(await pe(e)).data.success&&(D.value=[],v.success("删除成功"),O(),window.setTimeout(()=>{location.reload()},800))}})}function Y(){}function Z(){if(!s.value.id){v.warning("请先点击选择要修改的部门");return}_.value.forEach(o=>{s.value.id}),s.value.roleIds=_.value.toString(),Promise.all([_e(s.value.id,s.value)]).then(o=>{o[0].data.success&&(v.success("编辑成功"),O())})}return de(()=>{const o=document.documentElement.clientHeight;I.value=`${Number(o-287)}px`,x()}),(o,e)=>{const b=d("a-switch"),m=d("a-button"),L=d("a-row"),ee=d("a-alert"),te=d("a-tree"),P=d("a-col"),T=d("a-input"),f=d("a-form-item"),le=d("a-option"),ae=d("a-select"),$=d("a-input-number"),z=d("a-tooltip"),A=d("a-form"),ne=d("a-modal"),oe=d("a-card");return k(),H(oe,{class:"general-card",title:"部门管理",bordered:!1},{default:l(()=>[t(L,{class:"action"},{default:l(()=>[t(b,{modelValue:a(g),"onUpdate:modelValue":e[0]||(e[0]=n=>y(g)?g.value=n:null)},{checked:l(()=>e[8]||(e[8]=[i(" 级联 ")])),unchecked:l(()=>e[9]||(e[9]=[i(" 单选 ")])),_:1},8,["modelValue"]),t(m,{onClick:q},{default:l(()=>e[10]||(e[10]=[i(" 添加部门 ")])),_:1}),t(m,{onClick:Q},{default:l(()=>e[11]||(e[11]=[i(" 添加子部门 ")])),_:1}),t(m,{onClick:X},{default:l(()=>e[12]||(e[12]=[i(" 批量删除 ")])),_:1}),t(m,{onClick:x},{default:l(()=>e[13]||(e[13]=[i(" 刷新 ")])),_:1})]),_:1}),t(L,{style:{margin:"16px 0"}},{default:l(()=>[t(P,{span:8},{default:l(()=>[t(ee,{type:"warning"},{default:l(()=>[e[14]||(e[14]=i(" 当前选择编辑： ")),K("span",null,V(a(E)),1),a(s).id?(k(),R("a",{key:0,href:"",onClick:Y},"取消选择")):M("",!0)]),_:1}),K("div",{class:"tree-bar",style:ue({maxHeight:a(I)})},[t(te,{"checked-keys":a(p),"onUpdate:checkedKeys":e[1]||(e[1]=n=>y(p)?p.value=n:null),"check-strictly":!a(g),"block-node":"",data:a(S),checkable:!0,"field-names":{children:"children",title:"title",key:"id"},onSelect:N,onCheck:N},null,8,["checked-keys","check-strictly","data"])],4)]),_:1}),t(P,{span:16},{default:l(()=>[t(A,{model:a(s),style:{width:"600px"}},{default:l(()=>[t(f,{field:"title",label:"部门名称",rules:[a(h)]},{default:l(()=>[t(T,{modelValue:a(s).title,"onUpdate:modelValue":e[2]||(e[2]=n=>a(s).title=n),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1},8,["rules"]),t(f,{field:"isRead",label:"选择角色"},{default:l(()=>[t(ae,{modelValue:a(_),"onUpdate:modelValue":e[3]||(e[3]=n=>y(_)?_.value=n:null),placeholder:"选择角色",multiple:""},{default:l(()=>[(k(!0),R(ie,null,re(a(U),n=>(k(),H(le,{key:n.id,value:n.id},{default:l(()=>[i(V(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{field:"sortOrder",label:"排序值",rules:[a(h)]},{default:l(()=>[t(z,{content:"值越小越靠前，支持小数",position:"rt"},{default:l(()=>[t($,{modelValue:a(s).sortOrder,"onUpdate:modelValue":e[4]||(e[4]=n=>a(s).sortOrder=n),style:{width:"320px"},class:"input-demo",min:0,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),t(f,null,{default:l(()=>[t(m,{"html-type":"submit",style:{"margin-right":"5px"},type:"primary",onClick:Z},{default:l(()=>e[15]||(e[15]=[i(" 修改并保存 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(ne,{visible:a(c),"onUpdate:visible":e[7]||(e[7]=n=>y(c)?c.value=n:null),"align-center":!1,onOk:J,onCancel:W},{title:l(()=>[i(V(a(C)),1)]),default:l(()=>[t(A,{ref_key:"formRef",ref:F,model:a(r),layout:"horizontal","auto-label-width":""},{default:l(()=>[a(w)?(k(),R("div",ke,[t(f,{label:"上级部门："},{default:l(()=>[i(V(a(s).title),1)]),_:1})])):M("",!0),t(f,{field:"title",label:"部门名称",rules:[a(h)]},{default:l(()=>[t(T,{modelValue:a(r).title,"onUpdate:modelValue":e[5]||(e[5]=n=>a(r).title=n)},null,8,["modelValue"])]),_:1},8,["rules"]),t(f,{field:"sortOrder",label:"排序值",rules:[a(h)]},{default:l(()=>[t(z,{content:"值越小越靠前，支持小数",position:"rt"},{default:l(()=>[t($,{modelValue:a(r).sortOrder,"onUpdate:modelValue":e[6]||(e[6]=n=>a(r).sortOrder=n),style:{width:"320px"},class:"input-demo",min:0,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}}),we=ve(ge,[["__scopeId","data-v-5f94775a"]]);export{we as default};
