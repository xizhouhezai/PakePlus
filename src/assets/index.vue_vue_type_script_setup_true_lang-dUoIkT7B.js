import{a as ee,b as te,u as ae,c as le,d as oe,e as ne,f as re}from"./operation-CQQGRn8-.js";import{E as ie}from"./index-0p7N2Gug.js";import{u as se}from"./useCurrentInstance-BLlvmEjv.js";import{R as h}from"./validator-B8pIxTAL.js";import{U as de,V as ue}from"./dist-PezRi_EG.js";import{d as ce,r as m,a as me,h as fe,b as s,o as D,j as U,w as o,e as n,u as a,f as u,t as pe,M as _}from"./index-C4AMdMz2.js";const Ve=ce({__name:"index",props:{templateModel:{type:String,default:"normal"},checkbox:{type:Boolean,default:!0},isFloorDecoration:{type:Boolean,default:!1}},emits:["selectTableChange"],setup(g,{emit:A}){var S;const E=g,R=A,F=E.templateModel==="normal",N=(S=se().globalProperties)==null?void 0:S.$modal,V=m(),k=m(),b=m(),M=[{label:"文章标题",model:"title",disabled:!1,input:!0}],f=m(),c=m({categoryId:""}),B=[{title:"分类名称",dataIndex:"articleCategoryName",width:150},{title:"文章标题",dataIndex:"title",width:250},{title:"是否显示",dataIndex:"openStatus",width:150,slot:!0,slotTemplate:"openStatus"},{title:"排序",dataIndex:"sort",width:150},{title:"归属",dataIndex:"extendName",width:100}],P={title:"操作",width:250,fixed:"right",methods:[{title:"操作",slot:!0,slotTemplate:"operation"}]},t=me({modalVisible:!1,modalType:0,formLoading:!1,articleForm:{openStatus:!1,title:"",categoryId:"",extendId:"",sort:1,content:null,id:""},treeValue:""}),x=m(1);function v(l=[]){const e=[];return l&&l.length!==0&&l.forEach(i=>{const d={title:i.articleCategoryName,key:i.id,children:v(i.children)};e.push(d)}),e}function $(l){te(l).then(e=>{e.data.success&&(k.value=v(e.data.result),V.value=v(e.data.result),V.value.unshift({title:"全部",key:"",children:[]}))})}function j(l){var e;c.value.categoryId=l.join(","),(e=f.value)==null||e.init()}function L(l){t.articleForm.categoryId=l}function z(l){const e={status:l.openStatus};ae(l.id,e).then(i=>{i.data.success&&_.success("操作成功！")})}function G(){t.modalType=0,t.articleForm.treeValue="",b.value.resetFields(),delete t.articleForm.id,t.modalVisible=!0,t.articleForm.content="",x.value+=1}function K(l,e){t.articleForm.content=e}async function w(){var e;await((e=b.value)==null?void 0:e.validate())||(t.modalType===0?(delete t.articleForm.id,delete t.articleForm.treeValue,le(t.articleForm).then(i=>{var d;i.data.success&&(_.success("操作成功！"),(d=f.value)==null||d.init())})):t.modalType===1&&oe(t.articleForm).then(i=>{var d;i.data.success&&(_.success("操作成功！"),(d=f.value)==null||d.init())}),t.modalVisible=!1)}function O(l){t.modalType=1,t.treeValue="",b.value.resetFields(),ne(l.id).then(e=>{e.data.success&&(t.modalVisible=!0,x.value+=1,t.articleForm.categoryId=e.data.result.categoryId,t.articleForm.extendId=e.data.result.extendId,t.articleForm.treeValue=l.articleCategoryName,t.articleForm.id=l.id,t.articleForm.content=e.data.result.content,t.articleForm.title=e.data.result.title,t.articleForm.sort=e.data.result.sort,t.articleForm.openStatus=e.data.result.openStatus)})}function Q(l){N.confirm({title:"确认删除",content:"您确认要删除么?",alignCenter:!1,onOk:async()=>{var i;(await re(l.id)).data.success&&(_.success("操作成功！"),(i=f.value)==null||i.init())}})}function q(l){var e,i;R("selectTableChange",{values:l[0],title:(e=l[0])==null?void 0:e.title,id:(i=l[0])==null?void 0:i.id,___type:"pages"})}return fe(()=>{$(0)}),(l,e)=>{const i=s("a-tree"),d=s("a-col"),C=s("a-button"),I=s("a-switch"),T=s("a-card"),H=s("a-row"),J=s("a-input"),p=s("a-form-item"),W=s("a-tree-select"),X=s("a-input-number"),Y=s("a-form"),Z=s("a-modal");return D(),U(T,{class:"general-card",title:"文章管理",bordered:!1},{default:o(()=>[n(H,{style:{"margin-bottom":"16px"}},{default:o(()=>[n(d,{span:4},{default:o(()=>[n(i,{"block-node":"",data:a(V),onSelect:j},null,8,["data"])]),_:1}),n(d,{span:20},{default:o(()=>[n(T,{title:"",bordered:!1},{default:o(()=>[n(a(de),{"row-span":F?0:12,columns:M,onReset:e[0]||(e[0]=r=>{c.value={...a(c),...r}}),onSearch:e[1]||(e[1]=r=>{c.value={...a(c),...r}})},null,8,["row-span"]),n(C,{type:"primary",style:{"margin-bottom":"16px"},onClick:G},{default:o(()=>e[7]||(e[7]=[u(" 添加 ")])),_:1}),n(a(ue),{ref_key:"tablePageRef",ref:f,radio:g.isFloorDecoration?!0:!(F||g.checkbox),bordered:!0,checkbox:g.isFloorDecoration?!0:!F,columns:B,methods:P,api:a(ee),border:!0,"api-params":a(c),onSelectTableChange:q},{openStatus:o(({data:r})=>[n(I,{modelValue:r.openStatus,"onUpdate:modelValue":y=>r.openStatus=y,onChange:y=>z(r)},{checked:o(()=>e[8]||(e[8]=[u(" 展示 ")])),unchecked:o(()=>e[9]||(e[9]=[u(" 隐藏 ")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),operation:o(({data:r})=>[n(C,{style:{"margin-right":"10px"},type:"text",status:"warning",onClick:y=>O(r)},{default:o(()=>e[10]||(e[10]=[u(" 编辑 ")])),_:2},1032,["onClick"]),n(C,{type:"text",status:"danger",onClick:y=>Q(r)},{default:o(()=>e[11]||(e[11]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["radio","checkbox","api","api-params"])]),_:1})]),_:1})]),_:1}),n(Z,{visible:a(t).modalVisible,"onUpdate:visible":e[6]||(e[6]=r=>a(t).modalVisible=r),"align-center":!1,"title-align":"start",width:1100,"on-before-ok":w,"ok-text":"保存",draggable:"","hide-cancel":""},{title:o(()=>[u(pe(a(t).modalType?"编辑文章":"添加文章"),1)]),default:o(()=>[n(Y,{ref_key:"formRef",ref:b,model:a(t).articleForm,layout:"horizontal","auto-label-width":"",onSubmit:w},{default:o(()=>[n(p,{field:"title",label:"文章标题",rules:[a(h)]},{default:o(()=>[n(J,{modelValue:a(t).articleForm.title,"onUpdate:modelValue":e[2]||(e[2]=r=>a(t).articleForm.title=r),style:{width:"380px"},"show-word-limit":"","max-length":50},null,8,["modelValue"])]),_:1},8,["rules"]),n(p,{field:"categoryId",label:"文章分类",rules:[a(h)]},{default:o(()=>[n(W,{modelValue:a(t).articleForm.categoryId,"onUpdate:modelValue":e[3]||(e[3]=r=>a(t).articleForm.categoryId=r),data:a(k),placeholder:"请选择",style:{width:"380px"},onChange:L},null,8,["modelValue","data"])]),_:1},8,["rules"]),n(p,{field:"sort",label:"文章排序",rules:[a(h)]},{default:o(()=>[n(X,{modelValue:a(t).articleForm.sort,"onUpdate:modelValue":e[4]||(e[4]=r=>a(t).articleForm.sort=r),style:{width:"200px"},max:999},null,8,["modelValue"])]),_:1},8,["rules"]),n(p,{filed:"content",label:"文章内容"},{default:o(()=>[(D(),U(ie,{key:a(x),"init-value":a(t).articleForm.content,onGetEditorContent:K},null,8,["init-value"]))]),_:1}),n(p,{field:"openStatus",label:"是否展示",rules:[a(h)]},{default:o(()=>[n(I,{modelValue:a(t).articleForm.openStatus,"onUpdate:modelValue":e[5]||(e[5]=r=>a(t).articleForm.openStatus=r)},{checked:o(()=>e[12]||(e[12]=[u(" 展示 ")])),unchecked:o(()=>e[13]||(e[13]=[u(" 隐藏 ")])),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{Ve as _};
