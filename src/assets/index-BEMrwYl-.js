import{e as rt,s as dt,f as lt,h as nt,i as it,j as ut,k as mt}from"./index--a7kHzzJ.js";import{_ as ft}from"./index.vue_vue_type_script_setup_true_lang-DQl3Ouxv.js";import{d as g,h as ct}from"./statistics-5bVQUc8P.js";import{u as pt}from"./useCurrentInstance-BLlvmEjv.js";import{a as ht}from"./filters-D05Q2eUM.js";import{R as b,V as Wt}from"./validator-B8pIxTAL.js";import{C as L}from"./index-DVwIKmiX.js";import{V as yt}from"./dist-PezRi_EG.js";import{d as _t,r as k,a as gt,h as bt,E as kt,b as l,o as c,j as v,w as a,e as s,u as r,f as i,c as V,F as N,i as A,t as E,k as u,M as C,_ as Ct}from"./index-C4AMdMz2.js";import"./index.vue_vue_type_script_setup_true_lang-CDd49swx.js";import"./index-Dg8m97qn.js";import"./shops-fXVW_gE8.js";import"./tools-BfzgO_2s.js";import"./index-D43NcXdt.js";const wt={color:"red","font-size":"3"},Ht={class:"item-keyword"},vt={class:"item-score"},Vt=_t({__name:"index",setup(Dt){var R;const O=(R=pt().globalProperties)==null?void 0:R.$modal,D=k(),x=k(),$=k(""),F=k(),t=gt({enableAddModal:!1,formLoading:!1,form:{keywords:"",points:""},hotWordsList:[],update:!1,date:ht(new Date().getTime()/1e3-24*60*60,"yyyy-MM-dd"),hotWordsData:[],hotWordsChart:"",hotWordsTab:"todayHotWords",statisticsDate:{searchType:g.date.recent,year:g.date.month||new Date().getFullYear(),month:"",top:50},statisticsHotWordsData:[],statisticsHotWordsChart:"",hotWordForm:{saveNum:1,hotWordsSettingItems:[{keywords:"",score:1}]}}),z=[{title:"热词名称",dataIndex:"keywords"},{title:"搜索次数",dataIndex:"score"}];function h(){rt().then(o=>{t.hotWordsList=o.data.result,t.update=!t.update})}function B(){t.enableAddModal=!0,Object.keys(t.form).forEach(o=>{t.form[o]=""})}async function P(){var e;await((e=D.value)==null?void 0:e.validate())||(await dt(t.form)).data.success&&(C.success("添加成功！"),t.enableAddModal=!1,h())}function j(o){O.confirm({title:"确认删除",content:"您确认要删除此当前热词?",alignCenter:!1,onOk:async()=>{lt({words:o}).then(e=>{e.data.success&&(C.success("删除成功！"),h())})}})}function Q(){const o=t.hotWordsData;t.hotWordsChart.data(o),t.hotWordsChart.tooltip({showCrosshairs:!0,shared:!0}),t.hotWordsChart.interval().position("keywords*score").color("#f59b99"),t.hotWordsChart.render()}async function I(o){const e=await ut({date:o});e.data.success&&(t.hotWordsData=e.data.result),t.hotWordsChart||(t.hotWordsChart=new L({container:"hotWordsChart",autoFit:!0,height:500,padding:[50,50,50,50]})),Q()}function Y(o){o!=null&&o.trim()&&I(o)}function q(o){return new Date(o).getTime()/1e3>new Date().getTime()/1e3}function G(){const o=t.statisticsHotWordsData;t.statisticsHotWordsChart.data(o),t.statisticsHotWordsChart.tooltip({showCrosshairs:!0,shared:!0}),t.statisticsHotWordsChart.interval().position("keywords*score").color("#f59b99"),t.statisticsHotWordsChart.render()}async function w(o){const e=await nt(o);e.data.success&&(t.statisticsHotWordsData=e.data.result,F.value.init()),t.statisticsHotWordsChart||(t.statisticsHotWordsChart=new L({container:"statisticsHotWordsChart",autoFit:!0,height:500,padding:[50,50,50,50]})),G()}function J(o){t.statisticsDate.top=o,w(t.statisticsDate)}async function T(){const o=await mt();o.data.success&&o.data.result&&(t.hotWordForm.saveNum=o.data.result.saveNum,t.hotWordForm.hotWordsSettingItems=o.data.result.hotWordsSettingItems)}function K(){t.hotWordForm.hotWordsSettingItems.length>=5?C.error("最多5个热词项！"):t.hotWordForm.hotWordsSettingItems.push({keywords:"",score:1})}async function X(){var e;await((e=x.value)==null?void 0:e.validate())||(await it(t.hotWordForm)).data.success&&(C.success("设置成功！"),await T())}function Z(o){t.hotWordsTab=o,o==="todayHotWords"?h():o==="historyHotWords"?I(t.date):o==="statisticsHotWords"?w(t.statisticsDate):o==="setupHotWords"&&T()}return bt(()=>{h()}),kt(()=>g.date,o=>{t.statisticsDate.searchType=o.recent,o.month&&(t.statisticsDate.month=o.month.split("-")[1]&&o.month.split("-")[1].includes("0")?o.month.split("-")[1].substr(1):"",t.statisticsDate.year=o.month.split("-")[0]),w(t.statisticsDate)},{deep:!0,immediate:!0}),(o,e)=>{const m=l("a-button"),p=l("a-space"),n=l("a-col"),S=l("a-alert"),tt=l("a-tag"),W=l("a-tab-pane"),et=l("a-date-picker"),y=l("a-input-number"),U=l("a-input"),f=l("a-form-item"),M=l("a-form"),ot=l("a-tabs"),st=l("a-modal"),at=l("a-card");return c(),v(at,{class:"general-card",title:"搜索热词",bordered:!1},{default:a(()=>[s(ot,{"default-active-key":r(t).hotWordsTab,onChange:Z},{default:a(()=>[s(W,{key:"todayHotWords",title:"今日热词"},{default:a(()=>[s(n,{span:16,style:{"margin-bottom":"10px"}},{default:a(()=>[s(p,null,{default:a(()=>[s(m,{type:"primary",onClick:B},{default:a(()=>e[7]||(e[7]=[i(" 设置今日热词 ")])),_:1})]),_:1})]),_:1}),s(n,null,{default:a(()=>[s(p,null,{default:a(()=>[s(S,{type:"success","show-icon":!1},{default:a(()=>e[8]||(e[8]=[i(" 这里展示今日系统中搜索前一百的搜索热词，分数为热词在排序系统中的分数，分数越高，可以在用户获取热词时进行优先展示（首页商品搜索栏下方推荐位）（分数可以填写负数，会降低推荐度） ")])),_:1})]),_:1})]),_:1}),s(n,{style:{margin:"20px 0"}},{default:a(()=>[(c(),v(p,{key:r($),size:"medium"},{default:a(()=>[(c(!0),V(N,null,A(r(t).hotWordsList,d=>(c(),v(tt,{key:d,size:"large",closable:"",visible:"true",onClose:H=>j(d.keywords)},{default:a(()=>[i(E(d.keywords)+" ",1),u("div",wt," (分数："+E(d.score)+") ",1)]),_:2},1032,["onClose"]))),128))]),_:1}))]),_:1})]),_:1}),s(W,{key:"historyHotWords",title:"历史热词"},{default:a(()=>[s(n,{span:16,style:{"margin-bottom":"10px"}},{default:a(()=>[s(p,null,{default:a(()=>[s(et,{modelValue:r(t).date,"onUpdate:modelValue":e[0]||(e[0]=d=>r(t).date=d),"disabled-date":q,style:{width:"200px"},placeholder:"选择查看日期",onChange:Y},null,8,["modelValue"])]),_:1})]),_:1}),s(n,null,{default:a(()=>[s(p,null,{default:a(()=>[s(S,{type:"success","show-icon":!1},{default:a(()=>e[9]||(e[9]=[i(" 这里展示历史某一天的热词数据统计，可根据需求配置每日持久化多少条数据。 ")])),_:1})]),_:1})]),_:1}),s(n,{span:16},{default:a(()=>e[10]||(e[10]=[u("div",{id:"hotWordsChart"},null,-1)])),_:1})]),_:1}),s(W,{key:"statisticsHotWords",title:"热词统计"},{default:a(()=>[s(n,null,{default:a(()=>[s(ft,{"date-type":r(g).date,onOnChange:r(ct)},null,8,["date-type","onOnChange"]),s(y,{modelValue:r(t).statisticsDate.top,"onUpdate:modelValue":e[1]||(e[1]=d=>r(t).statisticsDate.top=d),style:{width:"70px",marginLeft:"10px"},min:10,max:50,class:"input-demo",onChange:J},null,8,["modelValue"])]),_:1}),s(n,null,{default:a(()=>e[11]||(e[11]=[u("div",{id:"statisticsHotWordsChart"},null,-1)])),_:1}),s(n,null,{default:a(()=>[s(r(yt),{ref_key:"tablePageRef",ref:F,columns:z,"enable-pagination":!1,"data-list":r(t).statisticsHotWordsData,"api-params":r(t).statisticsDate},null,8,["data-list","api-params"])]),_:1})]),_:1}),s(W,{key:"setupHotWords",title:"设置热词"},{default:a(()=>[s(M,{ref_key:"hotWordFormRef",ref:x,model:r(t).hotWordForm,style:{width:"100%"},layout:"horizontal","auto-label-width":""},{default:a(()=>[s(f,{field:"hotWordsSettingItems",label:"热词默认配置",rules:[r(b)]},{default:a(()=>[(c(!0),V(N,null,A(r(t).hotWordForm.hotWordsSettingItems,(d,H)=>(c(),V("div",{key:H,class:"item-label"},[u("div",null,[u("div",Ht,[e[12]||(e[12]=u("div",null,"热词：",-1)),s(U,{modelValue:d.keywords,"onUpdate:modelValue":_=>d.keywords=_,type:"text",placeholder:"请填写热词"},null,8,["modelValue","onUpdate:modelValue"])]),u("div",vt,[e[13]||(e[13]=u("div",null,"分数：",-1)),s(y,{modelValue:d.score,"onUpdate:modelValue":_=>d.score=_,min:0,max:5},null,8,["modelValue","onUpdate:modelValue"])])]),u("div",null,[s(m,{type:"primary",onClick:_=>r(t).hotWordForm.hotWordsSettingItems.splice(H,1)},{default:a(()=>e[14]||(e[14]=[i(" 删除 ")])),_:2},1032,["onClick"])])]))),128)),s(m,{onClick:K},{default:a(()=>e[15]||(e[15]=[i(" 添加配置 ")])),_:1})]),_:1},8,["rules"]),s(f,{field:"saveNum",label:"每日持久化热词数量",rules:[r(b)]},{default:a(()=>[s(y,{modelValue:r(t).hotWordForm.saveNum,"onUpdate:modelValue":e[2]||(e[2]=d=>r(t).hotWordForm.saveNum=d),min:0,style:{width:"88px"}},null,8,["modelValue"])]),_:1},8,["rules"]),s(f,null,{default:a(()=>[s(m,{type:"primary",onClick:e[3]||(e[3]=d=>X())},{default:a(()=>e[16]||(e[16]=[i(" 保存 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["default-active-key"]),s(st,{visible:r(t).enableAddModal,"onUpdate:visible":e[6]||(e[6]=d=>r(t).enableAddModal=d),"align-center":!1,footer:!1},{title:a(()=>e[17]||(e[17]=[i(" 设置热词 ")])),default:a(()=>[s(M,{ref_key:"formRef",ref:D,model:r(t).form,onSubmit:P},{default:a(()=>[s(f,{field:"keywords",label:"热词",rules:[r(b),r(Wt)],"validate-trigger":["change"]},{default:a(()=>[s(U,{modelValue:r(t).form.keywords,"onUpdate:modelValue":e[4]||(e[4]=d=>r(t).form.keywords=d)},null,8,["modelValue"])]),_:1},8,["rules"]),s(f,{field:"points",label:"分数",rules:[r(b)],"validate-trigger":["change"]},{default:a(()=>[s(y,{modelValue:r(t).form.points,"onUpdate:modelValue":e[5]||(e[5]=d=>r(t).form.points=d),min:-99999,max:99999},null,8,["modelValue"])]),_:1},8,["rules"]),s(f,{label:"操作"},{default:a(()=>[s(m,{loading:r(t).formLoading,"html-type":"submit",type:"primary"},{default:a(()=>e[18]||(e[18]=[i(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}}),zt=Ct(Vt,[["__scopeId","data-v-9e254c93"]]);export{zt as default};
