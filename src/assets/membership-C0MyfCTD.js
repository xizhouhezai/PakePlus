import{E as ke,F as P,G as Ie,H as ye}from"./member-B0DkAxtf.js";import{a as xe}from"./operation-CQQGRn8-.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import{u as he}from"./useCurrentInstance-BLlvmEjv.js";import{y as F}from"./tools-BfzgO_2s.js";import{R as w}from"./validator-B8pIxTAL.js";import{_ as Ce}from"./index.vue_vue_type_script_setup_true_lang-dUoIkT7B.js";import{V as we}from"./dist-PezRi_EG.js";import{d as Ee,r as m,a as Oe,b as i,o as f,j as D,w as r,e as a,f as c,u as l,c as g,t as _,k as s,F as Ue,i as Le,A as B,s as z,q as E,M as O,_ as Me}from"./index-C4AMdMz2.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./extra-5DUayDl9.js";import"./index-0p7N2Gug.js";import"./style-CFU4ZMck.js";const Ne={key:0},$e={key:1},Te={key:1},Ae={flex:"","justify-between":""},Re={style:{width:"55%"}},Se=["src"],je=["src"],Pe={"mr-10px":""},Fe={flex:"","justify-between":""},De={"p-15px":"",style:{width:"50%"}},Be={"pb-2px":"","text-28px":""},ze={"ml-2px":""},Ge={"text-13px":""},qe={key:0,"p-5px":""},He=["src"],Qe={key:0,class:"rewards","ml-5px":"","mr-5px":"","mt-24px":"","p-10px":"","text-13px":""},Je=["src"],Ke={style:{"text-align":"right"}},We=Ee({__name:"membership",setup(Xe){var T;const y=m(),G=(T=he().globalProperties)==null?void 0:T.$modal,q=m({gradeType:"FREE"}),U=m(),H=m([]),p=m(!1),v=m(!1),L=m(""),M=m(""),Q=m(),b=m(!1),V=m(),h=m(""),J=[{title:"等级名称",dataIndex:"gradeName"},{title:"等级图标",dataIndex:"gradeImage",slot:!0,slotTemplate:"gradeImage"},{title:"等级背景图",dataIndex:"bkImage",slot:!0,slotTemplate:"bkImage"},{title:"是否开启",dataIndex:"status",slot:!0,slotTemplate:"status"},{title:"等级折扣",dataIndex:"discount",slot:!0,slotTemplate:"discount"},{title:"所需经验值",dataIndex:"experienceValue"}],K={title:"操作",width:300,fixed:"right",methods:[{title:"修改",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},t=Oe({enableAddModal:!1,formLoading:!1,fid:"",form:{gradeName:"",experienceValue:"",gradeImage:"",gradeColor:"#000000",bkImage:"",bkColor:"#000000",articleId:"",gradeType:"FREE",status:"show",discount:1}}),W=[{label:"开启",value:"OPEN"},{label:"关闭",value:"CLOSE"}];function X(){t.enableAddModal=!0,h.value="添加",t.fid="",Object.keys(t.form).forEach(n=>{t.form[n]=""}),t.form.gradeType="FREE",t.form.status="OPEN",t.form.discount=1}async function Y(){var e;await((e=U.value)==null?void 0:e.validate())||(t.fid?await P(t.fid,t.form):await ke(t.form)).data.success&&(O.success(`${t.fid?"修改":"添加"}成功!`),t.enableAddModal=!1,y.value.init())}async function Z(n){if(h.value="编辑",Object.keys(t.form).forEach(e=>{t.form[e]=""}),n.record.articleId){const e=await xe({ids:n.record.articleId});t.form.articleInfo=e.data.result.records,t.form.articleTitles=t.form.articleInfo.map(d=>d.title).join(",")}n&&(Object.keys(n.record).forEach(e=>{t.form.hasOwnProperty(e)&&(t.form[e]=n.record[e])}),t.fid=n.record.id,t.enableAddModal=!0,t.form.gradeType=n.record.gradeType,t.form.benefitsIds=n.record.benefitsIds)}function ee(n){G.confirm({title:"确认删除",content:`您确认要删除 ${n.record.gradeName}?`,alignCenter:!1,onOk:async()=>{(await Ie(n.record.id)).data.success&&(O.success("删除成功"),y.value.init())}})}function te(n){H.value=n}function oe(){b.value=!0}function N(n){L.value=n,v.value=!0}function le(){p.value=!1}function ae(){p.value=!1}function $(n){M.value=n,p.value=!0}function re(){p.value=!1,M.value==="gradeImage"?t.form.gradeImage=V.value:t.form.bkImage=V.value}function ne(n){V.value=n.url}function se(n){n.values.length>0?(t.form.articleInfo=n.values,t.form.articleId=t.form.articleInfo.map(e=>e.id).join(",")):(t.form.articleInfo=[],t.form.articleId="")}function ie(n){t.form.articleInfo=t.form.articleInfo.filter(e=>e.id!==n.id),t.form.articleId=t.form.articleInfo.map(e=>e.id).join(",")}async function de(n){n.open?n.status="OPEN":n.status="CLOSE",(await P(n.id,n)).data.success&&(O.success("操作成功"),y.value.init())}async function me(n){const e=await ye(n);return e.data.result.records.forEach(d=>{d.open=d.status==="OPEN"}),e}return(n,e)=>{const d=i("a-button"),ue=i("a-space"),fe=i("a-col"),pe=i("a-row"),A=i("a-image"),C=i("a-color-picker"),ce=i("a-switch"),k=i("a-input"),u=i("a-form-item"),R=i("a-input-number"),S=i("icon-eye"),j=i("a-tooltip"),ge=i("a-tag"),be=i("a-radio-group"),_e=i("a-form"),x=i("a-modal"),ve=i("a-card");return f(),D(ve,{class:"general-card",bordered:!1},{default:r(()=>[a(pe,{style:{"margin-bottom":"16px"}},{default:r(()=>[a(fe,{span:16},{default:r(()=>[a(ue,null,{default:r(()=>[a(d,{type:"primary",onClick:X},{default:r(()=>e[22]||(e[22]=[c(" 添加 ")])),_:1})]),_:1})]),_:1})]),_:1}),a(l(we),{ref_key:"tablePageRef",ref:y,columns:J,methods:K,api:me,"api-params":l(q),bordered:!0,onEditor:Z,onDelete:ee,onSelectTableChange:te},{gradeImage:r(({data:o})=>[a(A,{width:"50",height:"50",src:o.gradeImage},null,8,["src"])]),discount:r(({data:o})=>[o.discount<1?(f(),g("div",Ne,_(o.discount*100)+"折 ",1)):(f(),g("div",$e," 原价 "))]),bkColor:r(({data:o})=>[o.bkColor?(f(),D(C,{key:0,modelValue:o.bkColor,"onUpdate:modelValue":I=>o.bkColor=I,disabled:""},null,8,["modelValue","onUpdate:modelValue"])):(f(),g("div",Te," 无 "))]),bkImage:r(({data:o})=>[a(A,{width:"50",height:"50",src:o.bkImage},null,8,["src"])]),status:r(({data:o})=>[a(ce,{modelValue:o.open,"onUpdate:modelValue":I=>o.open=I,disabled:o.experienceValue===0,onChange:I=>de(o)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["api-params"]),a(x,{visible:l(t).enableAddModal,"onUpdate:visible":e[14]||(e[14]=o=>l(t).enableAddModal=o),"align-center":!1,footer:!1,"mask-closable":!1,width:1100},{title:r(()=>[c(_(l(h)),1)]),default:r(()=>[s("div",Ae,[s("div",Re,[a(_e,{ref_key:"formRef",ref:U,model:l(t).form,onSubmit:Y},{default:r(()=>[a(u,{field:"gradeName",label:"等级名称",rules:[l(w)],"validate-trigger":["change"]},{default:r(()=>[a(k,{modelValue:l(t).form.gradeName,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).form.gradeName=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(u,{field:"experienceValue",label:"所需经验值",tooltip:"到达该等级所需经验值",rules:[l(w)],"validate-trigger":["change"]},{default:r(()=>[a(R,{modelValue:l(t).form.experienceValue,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).form.experienceValue=o),style:{width:"320px"},placeholder:"请输入所需经验值",mode:"button",precision:0,min:0,max:999999,"hide-button":""},null,8,["modelValue"])]),_:1},8,["rules"]),a(u,{field:"discount",label:"等级折扣",tooltip:"当前等级会员所享受的购买平台内商品的折扣, 1:代表原价",rules:[l(w)],"validate-trigger":["change"]},{default:r(()=>[a(R,{modelValue:l(t).form.discount,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).form.discount=o),style:{width:"320px"},placeholder:"请输入当前等级的折扣","default-value":1,mode:"button",precision:2,step:.01,max:"1",min:"0.01",class:"input-demo"},null,8,["modelValue"])]),_:1},8,["rules"]),a(u,{field:"gradeImage",label:"等级图片",tooltip:"等级卡片右上角图片","validate-trigger":["change"]},{default:r(()=>[a(k,{modelValue:l(t).form.gradeImage,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).form.gradeImage=o)},null,8,["modelValue"]),a(j,null,{content:r(()=>[s("div",null,[s("img",{src:l(t).form.gradeImage,alt:"该资源不存在",style:{width:"100%",margin:"0 auto"}},null,8,Se),s("a",{style:{"margin-top":"5px","text-align":"right",cursor:"pointer"},onClick:e[4]||(e[4]=o=>N(l(t).form.gradeImage))},"查看大图")])]),default:r(()=>[a(d,null,{default:r(()=>[a(S)]),_:1})]),_:1}),a(d,{type:"primary",onClick:e[5]||(e[5]=o=>$("gradeImage"))},{default:r(()=>e[23]||(e[23]=[c(" 上传图片 ")])),_:1})]),_:1}),a(u,{field:"bkImage",label:"等级背景图",tooltip:"当前等级卡片的背景图","validate-trigger":["change"]},{default:r(()=>[a(k,{modelValue:l(t).form.bkImage,"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).form.bkImage=o)},null,8,["modelValue"]),a(j,null,{content:r(()=>[s("div",null,[s("img",{src:l(t).form.bkImage,alt:"该资源不存在",style:{width:"100%",margin:"0 auto"}},null,8,je),s("a",{style:{"margin-top":"5px","text-align":"right",cursor:"pointer"},onClick:e[7]||(e[7]=o=>N(l(t).form.bkImage))},"查看大图")])]),default:r(()=>[a(d,null,{default:r(()=>[a(S)]),_:1})]),_:1}),a(d,{type:"primary",onClick:e[8]||(e[8]=o=>$("bkImage"))},{default:r(()=>e[24]||(e[24]=[c(" 上传图片 ")])),_:1})]),_:1}),a(u,{field:"bkColor",label:"等级背景颜色",tooltip:"等级卡片外的背景颜色","validate-trigger":["change"]},{default:r(()=>[a(k,{modelValue:l(t).form.bkColor,"onUpdate:modelValue":e[9]||(e[9]=o=>l(t).form.bkColor=o)},null,8,["modelValue"]),a(C,{modelValue:l(t).form.bkColor,"onUpdate:modelValue":e[10]||(e[10]=o=>l(t).form.bkColor=o)},null,8,["modelValue"])]),_:1}),a(u,{field:"gradeColor",label:"等级字体颜色",tooltip:"等级整体的字体颜色","validate-trigger":["change"]},{default:r(()=>[a(k,{modelValue:l(t).form.gradeColor,"onUpdate:modelValue":e[11]||(e[11]=o=>l(t).form.gradeColor=o)},null,8,["modelValue"]),a(C,{modelValue:l(t).form.gradeColor,"onUpdate:modelValue":e[12]||(e[12]=o=>l(t).form.gradeColor=o)},null,8,["modelValue"])]),_:1}),a(u,{field:"articleId",label:"等级说明",tooltip:"等级详情页的等级说明","validate-trigger":["change"]},{default:r(()=>[s("div",Pe,[(f(!0),g(Ue,null,Le(l(t).form.articleInfo,o=>(f(),g("div",{key:o.id,"mb-5px":""},[a(ge,{closable:"",onClose:I=>ie(o)},{default:r(()=>[c(_(o.title),1)]),_:2},1032,["onClose"])]))),128))]),a(d,{type:"primary",onClick:oe},{default:r(()=>e[25]||(e[25]=[c(" 选择文章 ")])),_:1})]),_:1}),a(u,{field:"displayLevel",label:"是否开启","validate-trigger":["change"]},{default:r(()=>[a(be,{modelValue:l(t).form.status,"onUpdate:modelValue":e[13]||(e[13]=o=>l(t).form.status=o),options:W},null,8,["modelValue"])]),_:1}),a(u,{label:"操作"},{default:r(()=>[a(d,{loading:l(t).formLoading,"html-type":"submit",type:"primary"},{default:r(()=>e[26]||(e[26]=[c(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),s("div",{style:B([{width:"40%",height:"200px"},{background:l(F)(l(t).form.bkColor||"#ffe45c"),color:l(t).form.gradeColor}]),class:"user-profile"},[s("div",{class:"membership-card",style:B({background:l(t).form.bkImage?`url(${l(t).form.bkImage})`:l(F)(l(t).form.gradeColor||"#ffeaa2"),backgroundSize:"100% 100%",backgroundBlendMode:l(t).form.bkImage?"overlay":"normal"}),"ml-2px":"","mr-2px":"","pb-5px":""},[s("div",Fe,[s("div",De,[s("div",Be,_(l(t).form.gradeName||"等级名称"),1),s("div",ze,[s("span",Ge,"经验值需达到"+_(l(t).form.experienceValue||"0"),1)])]),l(t).form.gradeImage?(f(),g("div",qe,[s("img",{src:l(t).form.gradeImage,alt:"等级图片",class:"rabbit-icon"},null,8,He)])):z("",!0)]),l(t).form.discount!==1?(f(),g("div",Qe,[s("span",null,"当前等级购物可享受 "+_(Number(l(t).form.discount)*100)+" 折 ",1)])):z("",!0)],4)],4)])]),_:1},8,["visible"]),a(x,{visible:l(b),"onUpdate:visible":e[15]||(e[15]=o=>E(b)?b.value=o:null),width:1300,title:"文章管理",onOk:e[16]||(e[16]=o=>b.value=!0),onCancel:e[17]||(e[17]=o=>b.value=!1)},{default:r(()=>[a(Ce,{ref_key:"articleListRef",ref:Q,checkbox:!0,"template-model":"selectModel",onSelectTableChange:se},null,512)]),_:1},8,["visible"]),a(x,{visible:l(p),"onUpdate:visible":e[18]||(e[18]=o=>E(p)?p.value=o:null),width:1100,title:"oss资源管理",onOk:re,onCancel:e[19]||(e[19]=o=>p.value=!1)},{default:r(()=>[a(Ve,{"is-single":!0,onSelected:ne})]),_:1},8,["visible"]),a(x,{visible:l(v),"onUpdate:visible":e[21]||(e[21]=o=>E(v)?v.value=o:null),width:1100,onOk:le,onCancel:ae},{footer:r(()=>[s("div",Ke,[a(d,{type:"text",status:"danger",onClick:e[20]||(e[20]=o=>v.value=!1)},{default:r(()=>e[27]||(e[27]=[c(" 关闭 ")])),_:1})])]),default:r(()=>[s("img",{src:l(L),alt:"该资源不存在",style:{width:"100%",margin:"0 auto",display:"block"}},null,8,Je)]),_:1},8,["visible"])]),_:1})}}}),ft=Me(We,[["__scopeId","data-v-bc770112"]]);export{ft as default};
