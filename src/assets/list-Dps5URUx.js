import{g as ge,x as ce,y as be,z as ye,a as E,A as ke}from"./goods-CB7YWqUH.js";import{u as ve}from"./useCurrentInstance-BLlvmEjv.js";import{m as xe,g as $,s as B,e as L,f as Ee}from"./tools-BfzgO_2s.js";import{R as Pe,V as Ce}from"./validator-B8pIxTAL.js";import{U as we,V as Ae}from"./dist-PezRi_EG.js";import{d as Ie,r as g,a as Se,h as he,b as p,o as c,j as P,w as s,e as a,u as l,f as n,s as C,c as w,k as b,q as De,t as Te,M as f}from"./index-C4AMdMz2.js";const Ue={key:0},Re={key:1,flex:"","flex-a-c":""},Me={key:0},Ne={key:1},Oe={key:2},Ge=Ie({__name:"list",props:{templateModel:{type:String,default:"normal"}},emits:["selectTableChange"],setup(F,{emit:G}){var N;const z=F,W=G,j=g("UPPER"),i=g({authFlag:"PASS",scene:"SUPPLIER"}),x=g(!1),h=g(0),D=g(0),A=(N=ve().globalProperties)==null?void 0:N.$modal,y=g(),T=g(),u=g([]),I=g(""),v=z.templateModel==="normal",U=g([]),q=[{label:"商品名称",model:"goodsName",disabled:!1,input:!0},{label:"商品编号",model:"id",disabled:!1,input:!0},{label:"店铺名称",model:"storeName",disabled:!1,input:!0},{label:"状态",model:"marketEnable",disabled:!1,select:{options:xe}},{label:"商品类型",model:"goodsType",disabled:!1,select:{options:$}},{label:"支持代理",model:"supportProxy",disabled:!1,select:{options:B}},{label:"支持采购",model:"supportPurchase",disabled:!1,select:{options:L}},{label:"类目名称",model:"categoryPath",disabled:!1,category:!0}],H=[{title:"商品名称",dataIndex:"goodsName",slot:!0,ellipsis:!1,width:v?300:250,slotData:{goods:{goodsName:"goodsName",goodsImage:"original",goodsId:"goodsId",skuId:"skuId",linkTo:!0}}},{title:"商品编号",dataIndex:"id",width:200},{title:"商品价格",dataIndex:"price",currency:!0},{title:"支持采购",dataIndex:"supportPurchase",slot:!0,slotData:{badge:L}},{title:"支持代发",dataIndex:"supportProxy",slot:!0,slotData:{badge:B}},{title:"商品类型",dataIndex:"goodsType",slot:!0,slotData:{badge:$}},{title:"上架状态",dataIndex:"marketEnable",slot:!0,slotTemplate:"marketEnable"},{title:"审核状态",dataIndex:"authFlag",slot:!0,slotTemplate:"authFlag"},{title:"销售模式",dataIndex:"salesModel",slot:!0,slotData:{badge:Ee}},{title:"店铺名称",dataIndex:"storeName",slot:!0,supplier:!0}],Q=v?{title:"操作",width:200,fixed:"right",methods:[{slot:!0,slotTemplate:"btnList"}]}:{},r=Se({enableAddModal:!1,formLoading:!1,fid:"",form:{reason:"店铺关闭"}});function J(t){W("selectTableChange",{...t[0],___type:"goods"}),u.value=t}async function K(){const t=await be();t.data.success&&(U.value=t.data.result)}function X(){A.confirm({title:"确认导出",content:"确定要导出商品数据吗？导出功能为异步导出，需要去 运营 - 导出记录 下载",onOk:async()=>{(await ye(i.value)).data.success&&f.success("导出成功,请前往 “运营 - 导出记录” 进行下载")}})}function Y(t){t&&(Object.keys(t.record).forEach(e=>{r.form.hasOwnProperty(e)&&(r.form[e]=t.record[e])}),r.form.reason=t.record.reason,r.fid=t.record.id,r.enableAddModal=!0)}function Z(t){r.fid=t.id,r.enableAddModal=!0}async function ee(){var e;if(!await((e=T.value)==null?void 0:e.validate())){const d={goodsIds:[r.fid],goodsStatus:"DOWN",underReason:r.form.reason};E(d).then(k=>{k.data.success&&(f.success("操作成功"),r.enableAddModal=!1,y.value.init())})}}function te(t){t.statusCount&&(h.value=t.statusCount.statusUnaudited,D.value=t.statusCount.statusRefuse)}function oe(t){A.confirm({title:"确认上架",content:`您确认要上架${t.goodsName}?`,alignCenter:!1,onOk:async()=>{const e={goodsIds:[t.id],goodsStatus:"UPPER"};(await E(e)).data.success&&(f.success("上架成功"),y.value.init())}})}function R(t){if(u.value.length<=0&&!t){f.error("您还未选择要审核的商品");return}t&&(u.value=[{id:t}]),x.value=!0}function M(t){const e=[];u.value.forEach(k=>{e.push(k.id)}),E({goodsIds:e,goodsAuth:t}).then(k=>{k.data.success&&(f.success("审核成功"),y.value.init())}),x.value=!1}function se(){if(u.value.length<=0){f.error("您还未选择要上架的商品");return}const t=[];u.value.forEach(d=>{t.push(d.id)}),E({goodsIds:t,goodsStatus:"UPPER"}).then(d=>{d.data.success&&(f.success("上架成功"),y.value.init())})}function ae(){if(u.value.length<=0){f.error("您还未选择要下架的商品");return}const t=[];u.value.forEach(d=>{t.push(d.id)}),E({goodsIds:t,goodsStatus:"DOWN"}).then(d=>{d.data.success&&(f.success("下架成功"),y.value.init())})}function le(){if(u.value.length<=0){f.error("您还未选择要删除的商品");return}u.value.forEach(e=>{I.value+=`${e.id},`});const t=I.value.substring(0,I.value.length-1);A.confirm({title:"确认删除",content:`您确定要删除所选的${u.value.length}个商品`,alignCenter:!1,onOk:async()=>{(await ke({goodsId:t})).data.success&&(f.success("删除成功"),y.value.init())}})}function ne(t){i.value.goodsStatus=t,t==="UPPER"?i.value.authFlag="PASS":i.value.authFlag=""}function re(t){r.form.categoryPath=t}function de(t){i.value={...i.value,...t,categoryPath:r.form.categoryPath}}return he(()=>{K()}),(t,e)=>{const d=p("a-tab-pane"),k=p("a-tabs"),m=p("a-button"),ie=p("a-row"),O=p("a-tooltip"),ue=p("a-space"),me=p("a-input"),_=p("a-form-item"),pe=p("a-form"),V=p("a-modal"),fe=p("a-card");return c(),P(fe,{class:"general-card",title:"商品列表",bordered:!1},{default:s(()=>[a(k,{"default-active-key":l(j),onChange:ne},{default:s(()=>[a(d,{key:"ALL",title:"全部"}),a(d,{key:"UPPER",title:"出售中的商品"}),a(d,{key:"DOWN",title:"仓库中的商品"}),a(d,{key:"TOBEAUDITED",title:`待审核商品（${l(h)}）`},null,8,["title"]),a(d,{key:"REFUSE",title:`审核未通过的商品（${l(D)}）`},null,8,["title"])]),_:1},8,["default-active-key"]),a(l(we),{"category-data":l(U),"row-span":v?0:12,columns:q,onCategoryList:re,onReset:e[0]||(e[0]=o=>{i.value={...l(i),...o}}),onSearch:e[1]||(e[1]=o=>{de(o)})},null,8,["category-data","row-span"]),a(ie,{style:{"margin-bottom":"16px"}},{default:s(()=>[a(m,{type:"primary",onClick:le},{default:s(()=>e[8]||(e[8]=[n(" 批量删除 ")])),_:1}),a(m,{type:"primary","ml-5px":"",onClick:X},{default:s(()=>e[9]||(e[9]=[n(" 导出商品 ")])),_:1}),a(m,{type:"primary","ml-5px":"",onClick:se},{default:s(()=>e[10]||(e[10]=[n(" 批量上架 ")])),_:1}),a(m,{type:"primary","ml-5px":"",onClick:ae},{default:s(()=>e[11]||(e[11]=[n(" 批量下架 ")])),_:1}),l(i).goodsStatus==="TOBEAUDITED"?(c(),P(m,{key:0,type:"primary","ml-5px":"",onClick:e[2]||(e[2]=o=>R())},{default:s(()=>e[12]||(e[12]=[n(" 批量审核 ")])),_:1})):C("",!0)]),_:1}),a(l(Ae),{ref_key:"tablePageRef",ref:y,checkbox:!0,radio:!v,"page-size":v?10:6,columns:H,methods:l(Q),bordered:!0,api:v?l(ge):l(ce),"api-params":l(i),onSelectTableChange:J,onUpdate:Y,onParentComponentData:te},{marketEnable:s(({data:o})=>[o.marketEnable==="UPPER"?(c(),w("div",Ue,e[13]||(e[13]=[b("span",{class:"arco-badge-status-dot arco-badge-color-green","mr-8px":""},null,-1),n("上架 ")]))):C("",!0),o.marketEnable==="DOWN"?(c(),w("div",Re,[e[15]||(e[15]=b("span",{class:"arco-badge-status-dot arco-badge-color-red","mr-8px":""},null,-1)),e[16]||(e[16]=n("下架 ")),a(O,{content:o.underMessage,position:"right",mini:"","z-99":""},{default:s(()=>e[14]||(e[14]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24","ml-4px":""},[b("path",{fill:"none",stroke:"#bbbbbb","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.146 9.074a2.998 2.998 0 0 1 5.28-.838A3 3 0 0 1 12 13v1m0 7a9 9 0 1 1 0-18a9 9 0 0 1 0 18m.05-4v.1h-.1V17z"})],-1)])),_:2},1032,["content"])])):C("",!0)]),authFlag:s(({data:o})=>[o.authFlag==="PASS"?(c(),w("div",Me,e[17]||(e[17]=[b("span",{class:"arco-badge-status-dot arco-badge-color-green","mr-8px":""},null,-1),n("审核通过 ")]))):o.authFlag==="TOBEAUDITED"?(c(),w("div",Ne,e[18]||(e[18]=[b("span",{class:"arco-badge-status-dot arco-badge-color-blue","mr-8px":"",style:{"background-color":"blue"}},null,-1),n("待审核 ")]))):(c(),w("div",Oe,[e[20]||(e[20]=b("span",{class:"arco-badge-status-dot arco-badge-color-red","mr-8px":""},null,-1)),e[21]||(e[21]=n("审核失败 ")),a(O,{content:o.authMessage,position:"top",mini:""},{default:s(()=>e[19]||(e[19]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24","ml-4px":""},[b("path",{fill:"none",stroke:"#bbbbbb","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.146 9.074a2.998 2.998 0 0 1 5.28-.838A3 3 0 0 1 12 13v1m0 7a9 9 0 1 1 0-18a9 9 0 0 1 0 18m.05-4v.1h-.1V17z"})],-1)])),_:2},1032,["content"])]))]),btnList:s(({data:o})=>[a(ue,null,{default:s(()=>[l(i).goodsStatus==="TOBEAUDITED"?(c(),P(m,{key:0,type:"text",status:"danger",onClick:S=>R(o.id)},{default:s(()=>e[22]||(e[22]=[n(" 审核 ")])),_:2},1032,["onClick"])):C("",!0),(o==null?void 0:o.marketEnable)==="DOWN"&&l(i).goodsStatus!=="TOBEAUDITED"?(c(),P(m,{key:1,type:"text",status:"success",onClick:S=>oe(o)},{default:s(()=>e[23]||(e[23]=[n(" 上架 ")])),_:2},1032,["onClick"])):(o==null?void 0:o.marketEnable)==="UPPER"&&l(i).goodsStatus!=="TOBEAUDITED"?(c(),P(m,{key:2,type:"text",status:"danger",onClick:S=>Z(o)},{default:s(()=>e[24]||(e[24]=[n(" 下架 ")])),_:2},1032,["onClick"])):C("",!0),a(m,{type:"text",status:"success",onClick:S=>t.$openWindow({name:"goodsdetail",query:{id:o.id}})},{default:s(()=>e[25]||(e[25]=[n(" 查看 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["radio","page-size","methods","api","api-params"]),a(V,{visible:l(r).enableAddModal,"onUpdate:visible":e[4]||(e[4]=o=>l(r).enableAddModal=o),"align-center":!1,footer:!1},{title:s(()=>e[26]||(e[26]=[n(" 下架操作 ")])),default:s(()=>[a(pe,{ref_key:"formRef",ref:T,model:l(r).form,onSubmit:ee},{default:s(()=>[a(_,{field:"reason",label:"下架原因",rules:[l(Pe),l(Ce)],"validate-trigger":["change"]},{default:s(()=>[a(me,{modelValue:l(r).form.reason,"onUpdate:modelValue":e[3]||(e[3]=o=>l(r).form.reason=o)},null,8,["modelValue"])]),_:1},8,["rules"]),a(_,{label:"操作"},{default:s(()=>[a(m,{loading:l(r).formLoading,"html-type":"submit",type:"primary"},{default:s(()=>e[27]||(e[27]=[n(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),a(V,{visible:l(x),"onUpdate:visible":e[7]||(e[7]=o=>De(x)?x.value=o:null),draggable:""},{title:s(()=>e[28]||(e[28]=[n(" 商品审核 ")])),footer:s(()=>[a(m,{key:"back",onClick:e[5]||(e[5]=o=>M("REFUSE"))},{default:s(()=>e[29]||(e[29]=[n(" 拒绝 ")])),_:1}),a(m,{key:"submit",type:"primary",onClick:e[6]||(e[6]=o=>M("PASS"))},{default:s(()=>e[30]||(e[30]=[n(" 通过 ")])),_:1})]),default:s(()=>[n(" 您确认要审核所选 "+Te(l(u).length)+" 个商品 ",1)]),_:1},8,["visible"])]),_:1})}}});export{Ge as default};
