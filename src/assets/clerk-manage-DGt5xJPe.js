import{Q as ye,R as ke,S as Ie,T as _e,U as Ce,V as J,W as Ve,X as Se}from"./member-B0DkAxtf.js";import{u as we}from"./useCurrentInstance-BLlvmEjv.js";import{am as Q,at as Re}from"./tools-BfzgO_2s.js";import{R as S,M as xe,V as T}from"./validator-B8pIxTAL.js";import{U as Te,V as Ue}from"./dist-PezRi_EG.js";import{C as Ee}from"./index-DUU-x9KJ.js";import{d as $e,p as De,r as f,h as qe,E as Oe,b as i,o as c,j as k,w as a,e as o,u as t,f as d,k as Le,c as H,i as W,F as X,s as G,q as K,M as g,t as Y,_ as Me}from"./index-C4AMdMz2.js";const Ne={class:"paginationBox"},ze=$e({__name:"clerk-manage",setup(Pe){var M;const w=(M=we().globalProperties)==null?void 0:M.$modal,m=De(),v=f({extendId:m.query.id,scene:"STORE",departmentId:"",pageNumber:1,pageSize:10,sort:"createTime",order:"desc"}),D=f([]),R=f({}),Z=f(""),h=[{title:"手机号码",dataIndex:"mobile",sortable:{sortDirections:["ascend","descend"]}},{title:"超级管理员",dataIndex:"isSuper",slot:!0,slotData:{badge:Q}},{title:"店长",dataIndex:"shopkeeper",slot:!0,slotData:{badge:Q}},{title:"状态",dataIndex:"enable",slot:!0,slotData:{badge:Re}},{title:"上次登录时间",dataIndex:"lastLoginDate"}],ee={title:"操作",width:300,fixed:"right",methods:[{title:"编辑",callback:"editor",slot:!0,slotTemplate:"editor"},{title:"禁用",callback:"forbidden",slot:!0,slotTemplate:"forbidden"},{title:"删除",callback:"remove",slot:!0,slotTemplate:"remove"}]},te=[{label:"联系方式",model:"mobile",disabled:!1,input:!0}],y=f([]),I=f(""),_=f(!1),C=f(!1),r=f({mobile:"",password:"",roleIds:[],departmentTitle:"",departmentId:"",isSuper:!1,id:"",scene:"STORE"}),u=f({isSuper:!1,roleIds:[],departmentId:"",departmentTitle:""}),le=f(0),q=f(""),O=f(""),U=f([]),E=f([]);function b(){ye(v.value,m.query.type).then(s=>{s.data.success&&(D.value=s.data.result.records,R.value=s.data.result)})}function ae(){const s={pageSize:9999,extendId:m.query.id};ke(s).then(e=>{e.data.success&&(U.value=e.data.result.records)})}function oe(){const s={extendId:m.query.id};Ie(s).then(e=>{e.data.success&&(E.value=e.data.result)})}function L(s,e){const n={userIds:s.id,enable:e};w.confirm({title:`确认${e?"启用":"禁用"}`,content:`您确认要${e?"启用":"禁用"}用户${s.mobile}?`,alignCenter:!1,onOk:async()=>{(await _e(n,m.query.type)).data.success&&(g.success("操作成功！"),b())}})}function se(s){u.value=s;const e=[];s.roleIds&&String(s.roleIds).split(",").forEach(V=>{e.push(V)}),u.value.roleIds=e,C.value=!0}async function ne(){var e;await((e=O.value)==null?void 0:e.validate())||(u.value.roleIds===""&&(u.value.roleIds=[]),Ce(u.value,m.query.type).then(n=>{n.data.success&&(g.success("操作成功"),b(),C.value=!1)}))}function re(s){w.confirm({title:"确认删除",content:`您确认要删除用户${s.mobile}?`,alignCenter:!1,onOk:async()=>{(await J(s.id,m.query.type)).data.success&&(g.success("删除成功！"),b())}})}function de(){le.value=0,Object.keys(r.value).forEach(s=>{r.value[s]=""}),r.value.isSuper=!1,r.value.scene="STORE",r.value.extendId=m.query.id,r.value.roleIds=[],_.value=!0}async function ue(){var e;if(!await((e=q.value)==null?void 0:e.validate())){const n=JSON.parse(JSON.stringify(r.value));delete n.id,delete n.status,n.password=Ee.MD5(r.value.password).toString(),Ve(n,m.query.type).then(V=>{V.data.success&&(g.success("操作成功"),b(),_.value=!1)})}}function ie(s){y.value=s}function fe(){if(y.value.length<=0){g.error("请选择数据后重试");return}y.value.forEach(e=>{I.value+=`${e},`});const s=I.value.substring(0,I.value.length-1);w.confirm({title:"确认重置",content:`您确认要重置所选的${y.value.length}个店员数据密码为【123456a】`,alignCenter:!1,onOk:async()=>{(await Se(s,m.query.type)).data.success&&(g.success("重置成功"),b())}})}function me(){if(y.value.length<=0){g.error("您还未选择要删除的数据");return}y.value.forEach(e=>{I.value+=`${e},`});const s=I.value.substring(0,I.value.length-1);w.confirm({title:"确认删除",content:`您确定要删除所选的${y.value.length}个店员`,alignCenter:!1,onOk:async()=>{(await J(s,m.query.type)).data.success&&(g.success("删除成功"),b())}})}return qe(()=>{b(),ae(),oe()}),Oe(()=>[v.value],()=>{b()},{deep:!0}),(s,e)=>{const n=i("a-button"),V=i("a-space"),pe=i("a-col"),ce=i("a-row"),ve=i("a-pagination"),N=i("a-input"),p=i("a-form-item"),be=i("a-input-password"),x=i("a-radio"),z=i("a-radio-group"),P=i("a-option"),A=i("a-select"),B=i("a-tree-select"),F=i("a-form"),j=i("a-modal"),ge=i("a-card");return c(),k(ge,{title:"店员管理",class:"general-card",bordered:!1},{default:a(()=>[o(t(Te),{columns:te,onReset:e[0]||(e[0]=l=>{v.value={...t(v),...l}}),onSearch:e[1]||(e[1]=l=>{v.value={...t(v),...l}})}),o(ce,{style:{"margin-bottom":"16px"}},{default:a(()=>[o(pe,{span:16},{default:a(()=>[o(V,null,{default:a(()=>[o(n,{type:"primary",onClick:de},{default:a(()=>e[17]||(e[17]=[d(" 添加 ")])),_:1}),o(n,{onClick:fe},{default:a(()=>e[18]||(e[18]=[d(" 重置密码 ")])),_:1}),o(n,{type:"primary",onClick:me},{default:a(()=>e[19]||(e[19]=[d(" 批量删除 ")])),_:1})]),_:1})]),_:1})]),_:1}),o(t(Ue),{ref_key:"tablePageRef",ref:Z,columns:h,methods:ee,"data-list":t(D),checkbox:!0,bordered:!0,"enable-pagination":!1,onSelectTableChange:ie},{forbidden:a(({data:l})=>[l.enable?(c(),k(n,{key:0,type:"text",status:"danger",onClick:$=>L(l,!1)},{default:a(()=>e[20]||(e[20]=[d(" 禁用 ")])),_:2},1032,["onClick"])):(c(),k(n,{key:1,type:"text",status:"success",onClick:$=>L(l,!0)},{default:a(()=>e[21]||(e[21]=[d(" 启用 ")])),_:2},1032,["onClick"]))]),editor:a(({data:l})=>[o(n,{type:"text",status:"warning",onClick:$=>se(l)},{default:a(()=>e[22]||(e[22]=[d(" 编辑 ")])),_:2},1032,["onClick"])]),remove:a(({data:l})=>[o(n,{type:"text",status:"danger",onClick:$=>re(l)},{default:a(()=>e[23]||(e[23]=[d(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data-list"]),Le("div",Ne,[o(ve,{total:t(R).total,current:t(R).number,"page-size":t(R).size,"show-page-size":"",onChange:e[2]||(e[2]=l=>{t(v).pageNumber=l}),onPageSizeChange:e[3]||(e[3]=l=>{t(v).pageSize=l})},null,8,["total","current","page-size"])]),o(j,{visible:t(_),"onUpdate:visible":e[10]||(e[10]=l=>K(_)?_.value=l:null),"align-center":!1},{title:a(()=>e[24]||(e[24]=[d(" 添加店员 ")])),footer:a(()=>[o(n,{onClick:e[9]||(e[9]=l=>_.value=!1)},{default:a(()=>e[27]||(e[27]=[d(" 取消 ")])),_:1}),o(n,{type:"primary",onClick:ue},{default:a(()=>e[28]||(e[28]=[d(" 提交 ")])),_:1})]),default:a(()=>[o(F,{ref_key:"formRef",ref:q,model:t(r)},{default:a(()=>[o(p,{field:"mobile",label:"手机号",rules:[t(S),t(xe)],"validate-trigger":["change"]},{default:a(()=>[o(N,{modelValue:t(r).mobile,"onUpdate:modelValue":e[4]||(e[4]=l=>t(r).mobile=l),placeholder:"请输入要添加的店员手机号码"},null,8,["modelValue"])]),_:1},8,["rules"]),o(p,{field:"password",label:"密码",rules:[t(S),t(T)],"validate-trigger":["change"]},{default:a(()=>[o(be,{modelValue:t(r).password,"onUpdate:modelValue":e[5]||(e[5]=l=>t(r).password=l)},null,8,["modelValue"])]),_:1},8,["rules"]),o(p,{field:"isSuper",label:"超级管理员",rules:[t(S),t(T)],"validate-trigger":["change"]},{default:a(()=>[o(z,{modelValue:t(r).isSuper,"onUpdate:modelValue":e[6]||(e[6]=l=>t(r).isSuper=l),type:"button"},{default:a(()=>[o(x,{value:!0},{default:a(()=>e[25]||(e[25]=[d(" 是 ")])),_:1}),o(x,{value:!1},{default:a(()=>e[26]||(e[26]=[d(" 否 ")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["rules"]),t(r).isSuper?G("",!0):(c(),k(p,{key:0,field:"roleIds",label:"选择角色"},{default:a(()=>[o(A,{modelValue:t(r).roleIds,"onUpdate:modelValue":e[7]||(e[7]=l=>t(r).roleIds=l),placeholder:"选择角色",multiple:""},{default:a(()=>[(c(!0),H(X,null,W(t(U),l=>(c(),k(P,{key:l.id,value:l.id},{default:a(()=>[d(Y(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),o(p,{field:"departmentTitle",label:"所属部门"},{default:a(()=>[o(B,{"model-value":t(r).departmentId,"onUpdate:modelValue":e[8]||(e[8]=l=>t(r).departmentId=l),"field-names":{children:"children",title:"title",key:"id"},"allow-search":!0,"allow-clear":!0,data:t(E),placeholder:"选择所属部门","filter-tree-node":s.filterTreeNode},null,8,["model-value","data","filter-tree-node"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),o(j,{visible:t(C),"onUpdate:visible":e[16]||(e[16]=l=>K(C)?C.value=l:null),"align-center":!1},{title:a(()=>e[29]||(e[29]=[d(" 编辑店员 ")])),footer:a(()=>[o(n,{onClick:e[15]||(e[15]=l=>C.value=!1)},{default:a(()=>e[32]||(e[32]=[d(" 取消 ")])),_:1}),o(n,{type:"primary",onClick:ne},{default:a(()=>e[33]||(e[33]=[d(" 提交 ")])),_:1})]),default:a(()=>[o(F,{ref_key:"eidtFormRef",ref:O,model:t(u)},{default:a(()=>[o(p,{field:"mobile",label:"手机号",rules:[t(S),t(T)],"validate-trigger":["change"]},{default:a(()=>[o(N,{modelValue:t(u).mobile,"onUpdate:modelValue":e[11]||(e[11]=l=>t(u).mobile=l),placeholder:"请输入要添加的会员手机号码",disabled:""},null,8,["modelValue"])]),_:1},8,["rules"]),o(p,{field:"isSuper",label:"超级管理员",rules:[t(S),t(T)],"validate-trigger":["change"]},{default:a(()=>[o(z,{modelValue:t(u).isSuper,"onUpdate:modelValue":e[12]||(e[12]=l=>t(u).isSuper=l),type:"button",disabled:t(u).shopkeeper},{default:a(()=>[o(x,{value:!0},{default:a(()=>e[30]||(e[30]=[d(" 是 ")])),_:1}),o(x,{value:!1},{default:a(()=>e[31]||(e[31]=[d(" 否 ")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["rules"]),t(u).isSuper?G("",!0):(c(),k(p,{key:0,field:"roleIds",label:"选择角色"},{default:a(()=>[o(A,{modelValue:t(u).roleIds,"onUpdate:modelValue":e[13]||(e[13]=l=>t(u).roleIds=l),placeholder:"选择角色",multiple:""},{default:a(()=>[(c(!0),H(X,null,W(t(U),l=>(c(),k(P,{key:l.id,value:l.id},{default:a(()=>[d(Y(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),o(p,{field:"departmentTitle",label:"所属部门"},{default:a(()=>[o(B,{"model-value":t(u).departmentId,"onUpdate:modelValue":e[14]||(e[14]=l=>t(u).departmentId=l),"field-names":{children:"children",title:"title",key:"id"},"allow-search":!0,"allow-clear":!0,data:t(E),placeholder:"选择所属部门","filter-tree-node":s.filterTreeNode},null,8,["model-value","data","filter-tree-node"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}}),We=Me(ze,[["__scopeId","data-v-2f34d06e"]]);export{We as default};
