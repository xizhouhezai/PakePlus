import{b as V,u as I,s as de}from"./shops-fXVW_gE8.js";import{u as ue}from"./useCurrentInstance-BLlvmEjv.js";import{z as M,A as U,B as ce}from"./tools-BfzgO_2s.js";import{R as q}from"./validator-B8pIxTAL.js";import{U as me,V as pe}from"./dist-PezRi_EG.js";import{d as fe,r,n as _e,h as be,E as ye,b as i,o as p,c as B,e as o,w as s,j as y,u as n,s as v,f as u,t as ke,q as ge,M as S,_ as ve}from"./index-C4AMdMz2.js";const Se={key:0},Ce=fe({__name:"index",props:{templateModel:{type:String,default:"normal"},scene:{type:String,default:"STORE"},isFloorDecoration:{type:Boolean,default:!1}},emits:["selectTableChange","callback"],setup(C,{expose:F,emit:A}){var P;const x=C,E=A,N=(P=ue().globalProperties)==null?void 0:P.$modal,k=x.templateModel==="normal",D=r(!0),W=r({total:0}),b=r([]),f=r([]),T=_e(),w=r(),G=r("OPEN"),c=r({scene:x.scene||"STORE",sort:"createTime",storeStatus:"OPEN"}),g=r(!1),m=r({}),J=[{label:"店铺名称",model:"storeName",disabled:!1,input:!0},{label:"店铺状态",model:"storeStatus",disabled:!1,select:{options:M}},{label:"认证状态",model:"verify",disabled:!1,select:{options:U}},{label:"创建时间",disabled:!1,datePicker:{type:"range"}}],Y=[{title:"店铺名称",dataIndex:"storeName",width:200},{title:"店铺LOGO",dataIndex:"storeLogo",width:100,slot:!0,slotTemplate:"storeLogo"},{title:"店铺简介",dataIndex:"storeDesc",width:260},{title:"是否自营",dataIndex:"selfOperated",slot:!0,width:100,slotData:{badge:ce}},{title:"是否认证",dataIndex:"verify",slot:!0,width:100,slotData:{badge:U}},{title:"店铺状态",dataIndex:"storeStatus",width:100,slot:!0,slotData:{badge:M}},{title:"创建时间",width:180,dataIndex:"createTime"}],R={title:"操作",width:200,fixed:"right",methods:[{title:"操作",callback:"action",slot:!0,slotTemplate:"action"}]};function j(t){E("selectTableChange",{...t[0],___type:"shops"})}function z(){T.push({name:"add-shop",query:{type:"STORE"}})}function Q(t){N.confirm({title:"确认关闭",content:`您确认要关闭店铺${t.storeName}?`,alignCenter:!1,onOk:async()=>{(await I(t.id,"STORE",{status:"CLOSED"})).data.success&&(S.success("关闭成功"),w.value.init())}})}function H(t){N.confirm({title:"确认开启",content:`您确认要开启店铺${t.storeName}?`,alignCenter:!1,onOk:async()=>{(await I(t.id,"STORE",{status:"OPEN"})).data.success&&(S.success("开启成功"),w.value.init())}})}function K(t){T.push({name:"sub-merchant-information",query:{id:t.id,name:t.storeName,type:"shop"}})}function X(t){t.___selected=!t.___selected;const e=f.value.find(l=>l.id===t.id);e&&e.id?f.value.forEach((l,h)=>{l.id===e.id&&f.value.splice(h,1)}):f.value.push(t),E("callback",t)}function Z(t){b.value=t.map(e=>(e.___selected=!1,f.value.length!==0?f.value.map(l=>(l.id===e.id&&(e.___selected=!0),l)):e.___selected=!1,e))}function O(){V(c.value).then(t=>{t.data.success&&(W.value=t.data.result,Z(t.data.result.records))})}function ee(){const t=JSON.parse(JSON.stringify(m.value));de(t).then(e=>{e.data.success?(S.success("设置成功"),O()):S.error(e.data.message),g.value=!1,m.value={storeId:"",pcDomain:"",moveDomain:""}})}function te(){b.value&&b.value.length&&(b.value=b.value.map(t=>(t.___selected=!1,t)))}return F({selectedStore:D,init:te}),be(()=>{O()}),ye(()=>D.value,t=>{R.width=t?400:100},{deep:!0,immediate:!0}),(t,e)=>{const l=i("a-tab-pane"),h=i("a-tabs"),d=i("a-button"),ae=i("a-space"),oe=i("a-col"),se=i("a-row"),ne=i("a-image"),le=i("a-card"),L=i("a-input"),$=i("a-form-item"),ie=i("a-form"),re=i("a-modal");return p(),B("div",null,[o(le,{class:"general-card",title:k?"TOC店铺列表":"",bordered:!1},{default:s(()=>[k?(p(),y(h,{key:0,"default-active-key":n(G),onChange:e[0]||(e[0]=a=>{n(c).storeStatus=a,O()})},{default:s(()=>[o(l,{key:"OPEN",title:"开启中"}),o(l,{key:"CLOSED",title:"店铺关闭"}),o(l,{key:"APPLY",title:"申请开店"}),o(l,{key:"REFUSED",title:"审核拒绝"}),o(l,{key:"APPLYING",title:"待审核"})]),_:1},8,["default-active-key"])):v("",!0),o(n(me),{"row-span":k?0:12,columns:J,onReset:e[1]||(e[1]=a=>{c.value={...n(c),...a}}),onSearch:e[2]||(e[2]=a=>{c.value={...n(c),...a}})},null,8,["row-span"]),k?(p(),y(se,{key:1,style:{"margin-bottom":"16px"}},{default:s(()=>[o(oe,{span:16},{default:s(()=>[o(ae,null,{default:s(()=>[o(d,{type:"primary",onClick:e[3]||(e[3]=a=>z())},{default:s(()=>e[7]||(e[7]=[u(" 添加 ")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),o(n(pe),{ref_key:"tablePageRef",ref:w,checkbox:!!C.isFloorDecoration,radio:!!C.isFloorDecoration,columns:Y,methods:R,api:n(V),"api-params":n(c),bordered:!0,onSelectTableChange:j},{storeLogo:s(({data:a})=>[o(ne,{width:"60",src:a.storeLogo},null,8,["src"])]),action:s(({data:a})=>[n(D)?(p(),B("div",Se,[o(d,{type:"text",status:"success",onClick:_=>t.$openWindow({name:"shop-detail",query:{id:a.id,type:"STORE"}})},{default:s(()=>e[8]||(e[8]=[u(" 查看 ")])),_:2},1032,["onClick"]),o(d,{type:"text",status:"danger",onClick:_=>t.$openWindow({name:"clerk-manage",query:{id:a.id,type:"seller"}})},{default:s(()=>e[9]||(e[9]=[u(" 店员 ")])),_:2},1032,["onClick"]),o(d,{type:"text",status:"warning",onClick:_=>t.$openWindow({name:"add-shop",query:{id:a.id,type:"STORE"}})},{default:s(()=>e[10]||(e[10]=[u(" 修改 ")])),_:2},1032,["onClick"]),o(d,{type:"text",status:"",onClick:_=>K(a)},{default:s(()=>e[11]||(e[11]=[u(" 结算设置 ")])),_:2},1032,["onClick"]),a.storeStatus==="OPEN"?(p(),y(d,{key:0,type:"text",status:"danger",onClick:_=>Q(a)},{default:s(()=>e[12]||(e[12]=[u(" 关闭 ")])),_:2},1032,["onClick"])):v("",!0),a.storeStatus==="CLOSED"?(p(),y(d,{key:1,type:"text",status:"success",onClick:_=>H(a)},{default:s(()=>e[13]||(e[13]=[u(" 开启 ")])),_:2},1032,["onClick"])):v("",!0)])):(p(),y(d,{key:1,type:"text",status:a.___selected?"danger":"",onClick:_=>X(a)},{default:s(()=>[u(ke(a.___selected?"已选择":"选择"),1)]),_:2},1032,["status","onClick"]))]),_:1},8,["checkbox","radio","api","api-params"])]),_:1},8,["title"]),o(re,{visible:n(g),"onUpdate:visible":e[6]||(e[6]=a=>ge(g)?g.value=a:null),title:"域名设置",width:600,draggable:"",onOk:ee},{default:s(()=>[o(ie,{model:n(m)},{default:s(()=>[o($,{field:"pcDomain",label:"PC端域名",rules:[n(q)]},{default:s(()=>[o(L,{modelValue:n(m).pcDomain,"onUpdate:modelValue":e[4]||(e[4]=a=>n(m).pcDomain=a),placeholder:"请输入域名地址"},null,8,["modelValue"])]),_:1},8,["rules"]),o($,{field:"moveDomain",label:"移动端域名",rules:[n(q)]},{default:s(()=>[o(L,{modelValue:n(m).moveDomain,"onUpdate:modelValue":e[5]||(e[5]=a=>n(m).moveDomain=a),placeholder:"请输入域名地址"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),Ne=ve(Ce,[["__scopeId","data-v-b335b39d"]]);export{Ne as default};
