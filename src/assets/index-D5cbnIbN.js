import{b as S,h as O,i as Q,j as q}from"./operation-CQQGRn8-.js";import{u as z}from"./useCurrentInstance-BLlvmEjv.js";import{R as V}from"./validator-B8pIxTAL.js";import{V as G}from"./dist-PezRi_EG.js";import{d as H,r as c,a as J,h as K,b as n,o as p,j as C,w as a,e as o,f as i,u as r,t as y,s as x,M as _}from"./index-C4AMdMz2.js";const te=H({__name:"index",setup(L){var A;const T=(A=z().globalProperties)==null?void 0:A.$modal,m=c(),w=c(""),g=c([]),h=[{title:"分类名称",dataIndex:"articleCategoryName",width:150},{title:"排序",dataIndex:"sort",width:150}],N={title:"操作",width:250,fixed:"right",methods:[{title:"操作",slot:!0,slotTemplate:"operation"}]},e=J({articleClassVisible:!1,parentTitle:"",modalType:0,modalTitle:"添加一级分类",showParent:!1,formAdd:{parentId:"",sort:1,level:0,articleCategoryName:""}});function f(){S({}).then(l=>{l.data.success&&(g.value=l.data.result.map(t=>(t.children&&t.children.length?t.children.map(d=>(d.children=null,d)):t.children=null,t)))})}function k(){e.modalType=0,e.parentTitle="顶级分类",e.showParent=!0,e.modalTitle="添加一级分类",e.articleClassVisible=!0,m.value.resetFields(),delete e.formAdd.id,e.formAdd.parentId="0",e.formAdd.level=0,e.formAdd.sort=0}function I(l){e.modalType=0,e.parentTitle=l.articleCategoryName,e.showParent=!0,e.modalTitle="添加子分类",e.articleClassVisible=!0,e.formAdd.parentId=l.id,e.formAdd.level=l.level+1,e.formAdd.articleCategoryName="",e.formAdd.sort=0,delete e.formAdd.id}function D(l){e.modalType=1,e.parentTitle=l.articleCategoryName,e.showParent=!1,e.modalTitle="编辑",e.articleClassVisible=!0,e.formAdd.parentId=l.parentId,e.formAdd.level=l.level,e.formAdd.articleCategoryName=l.articleCategoryName,e.formAdd.id=l.id,e.formAdd.sort=l.sort,e.formAdd.extendId=l.extendId}async function P(){var t;await((t=m.value)==null?void 0:t.validate())||(e.modalType===0?(delete e.formAdd.id,O(e.formAdd).then(d=>{d.data.success&&(_.success("添加成功"),e.articleClassVisible=!1,f(),e.formAdd={parentId:"",sort:1,level:0,articleCategoryName:""})})):e.modalType===1&&Q(e.formAdd.id,e.formAdd).then(d=>{d.data.success&&(_.success("修改成功"),e.articleClassVisible=!1,f(),m.value.resetFields())}))}function R(l){T.confirm({title:"确认删除",content:`您确认要删除${l.articleCategoryName}?`,alignCenter:!1,onOk:async()=>{(await q(l.id)).data.success&&(_.success("删除成功！"),f())}})}return K(()=>{f()}),(l,t)=>{const d=n("a-button"),U=n("a-space"),$=n("a-col"),F=n("a-row"),b=n("a-input"),u=n("a-form-item"),M=n("a-input-number"),E=n("a-form"),j=n("a-modal"),B=n("a-card");return p(),C(B,{class:"general-card",title:"文章分类",bordered:!1},{default:a(()=>[o(F,{style:{"margin-bottom":"16px"}},{default:a(()=>[o($,{span:16},{default:a(()=>[o(U,null,{default:a(()=>[o(d,{type:"primary",onClick:k},{default:a(()=>t[4]||(t[4]=[i(" 添加一级分类 ")])),_:1})]),_:1})]),_:1})]),_:1}),o(r(G),{ref_key:"articleClassRef",ref:w,"data-list":r(g),columns:h,methods:N,"enable-pagination":!1,bordered:!0},{children:a(({data:s})=>[i(y(s.articleCategoryName),1)]),operation:a(({data:s})=>[s.level!==1?(p(),C(d,{key:0,style:{"margin-right":"10px"},type:"text",onClick:v=>I(s)},{default:a(()=>t[5]||(t[5]=[i(" 添加子分类 ")])),_:2},1032,["onClick"])):x("",!0),o(d,{style:{"margin-right":"10px"},type:"text",status:"warning",onClick:v=>D(s)},{default:a(()=>t[6]||(t[6]=[i(" 编辑 ")])),_:2},1032,["onClick"]),o(d,{type:"text",status:"danger",onClick:v=>R(s)},{default:a(()=>t[7]||(t[7]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["data-list"]),o(j,{visible:r(e).articleClassVisible,"onUpdate:visible":t[3]||(t[3]=s=>r(e).articleClassVisible=s),"align-center":!1,footer:!1},{title:a(()=>[i(y(r(e).modalTitle),1)]),default:a(()=>[o(E,{ref_key:"formAddRef",ref:m,model:r(e).formAdd,style:{width:"450px"}},{default:a(()=>[r(e).showParent?(p(),C(u,{key:0,field:"parentId",label:"上级分类"},{default:a(()=>[i(y(r(e).parentTitle)+" ",1),o(b,{modelValue:r(e).formAdd.parentId,"onUpdate:modelValue":t[0]||(t[0]=s=>r(e).formAdd.parentId=s),style:{display:"none"}},null,8,["modelValue"])]),_:1})):x("",!0),o(u,{field:"articleCategoryName",label:"分类名称",rules:[r(V)]},{default:a(()=>[o(b,{modelValue:r(e).formAdd.articleCategoryName,"onUpdate:modelValue":t[1]||(t[1]=s=>r(e).formAdd.articleCategoryName=s),style:{width:"320px"}},null,8,["modelValue"])]),_:1},8,["rules"]),o(u,{field:"sort",label:"排序值",rules:[r(V)]},{default:a(()=>[o(M,{modelValue:r(e).formAdd.sort,"onUpdate:modelValue":t[2]||(t[2]=s=>r(e).formAdd.sort=s),style:{width:"320px"}},null,8,["modelValue"])]),_:1},8,["rules"]),o(u,{label:"操作"},{default:a(()=>[o(d,{type:"primary",onClick:P},{default:a(()=>t[8]||(t[8]=[i(" 保存 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{te as default};
