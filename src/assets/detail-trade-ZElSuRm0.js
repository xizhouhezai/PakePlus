import{d as Ve,r as p,p as Pe,a as Se,h as Ae,b as f,v as Q,x as H,o as a,c as v,k as i,j as c,w as t,e as o,f as r,s as y,u as l,t as g,F as W,i as X,q as E,ag as Ne,M as $,_ as Me}from"./index-C4AMdMz2.js";import{J as Re,K as Ie,u as Oe,L as De}from"./order-HsmDfkng.js";import{u as Te}from"./useCurrentInstance-BLlvmEjv.js";import{R as N,V as Y}from"./validator-B8pIxTAL.js";import{_ as Ue}from"./detail-log.vue_vue_type_script_setup_true_lang-B7fvR_ds.js";import{n as Le}from"./dist-PezRi_EG.js";const Ee={key:0},$e={flex:"","flex-j-sb":"","flex-a-c":""},je={key:0},Fe={key:1},qe={key:2},Be={key:0},Ge={key:1},He={"mt-10px":""},ze={id:"printData"},Ke={flex:"","flex-j-sb":"","flex-a-c":""},Je={class:"grid-row"},Qe={class:"grid-row"},We={"mt-40px":""},Xe={flex:"","flex-j-sb":"","flex-a-c":""},Ye={key:0,"mt-10px":"","color-warmGray":""},Ze={key:0,class:"print-good-guid-item"},he={style:{"text-align":"right"}},et={style:{"text-align":"right"}},tt={style:{"text-align":"right"}},ot=Ve({__name:"detail-trade",props:{res:{type:Object,default:()=>{}}},emits:["reload"],setup(Z,{emit:h}){var K;const n=Z,j=h,ee=(K=Te().globalProperties)==null?void 0:K.$modal,b=p(!1),k=p({price:0}),M=Pe(),F=p(1),P=p(!1),R=p({}),I=p(),te={id:"printData",popTitle:"&nbsp;",extraHead:""},x=p(!1),oe=p([]),C=p(!1),S=p(!0),z=p(1),O=p(!1),A=p(!1),D=p(),T=p({reason:""}),le={待发货:"等待商家发货",未付款:"等待买家付款",已付款:"等待商家发货",待核验:"等待商家核验",已发货:"商家已发货",待自提:"等待买家自提",已取消:"交易取消"},u=Se({consigneeName:"",consigneeMobile:"",consigneeDetail:"",consigneeAddressPath:""});function se(_){D.value=_.ids.join(","),u.consigneeAddressPath=_.cities.join(",")}function ne(){C.value=!1,S.value=!0,O.value=!1}async function re(){var e;if(!await((e=I.value)==null?void 0:e.validate())){const m={...u,consigneeAddressIdPath:D.value};Re(M.query.id,m).then(w=>{w.data.success&&($.success("修改成功！"),C.value=!1,S.value=!0,O.value=!1,j("reload"))})}}async function ae(){var e;await((e=I.value)==null?void 0:e.validate())||(await Ie(M.query.id,T.value)).data.success&&($.success("取消成功！"),x.value=!1,j("reload"))}function ie(){ee.confirm({title:"提示",content:"您确定要收款吗？线下收款涉及库存变更，需异步进行，等待约一分钟刷新列表查看",alignCenter:!1,onOk:async()=>{const _={orderSn:M.query.id,clientType:"PC",paymentClient:"NATIVE",paymentScene:"ORDER",paymentMethod:"BANK_TRANSFER"};(await Oe(_)).data.success&&$.success("收款成功")}})}function de(){oe.value=n.res.orderItems.map(e=>({...e,___num:e.num,_disabled:e.deliverNumber>=e.num,canNum:e.num-e.deliverNumber})),R.value=n.res.allowOperationVO;const _={未付款:1,已付款:2,部分发货:3,待发货:3,待自提:3,待核验:3,已发货:4};n.res.orderStatusValue&&(n.res.orderStatusValue==="已完成"?F.value=n.res.order.orderType==="NORMAL"&&n.res.order.deliveryMethod==="LOGISTICS"?5:4:F.value=_[n.res.orderStatusValue]||1)}async function ue(){(await De(M.query.id,{orderPrice:k.value.price})).data.code===200&&($.success("修改订单金额成功"),b.value=!1,j("reload"))}function pe(){z.value+=1,S.value=!1,O.value=!0}function fe(){if(C.value=!0,n.res.order){const{consigneeMobile:_,consigneeDetail:e,consigneeName:m,consigneeAddressPath:w,consigneeAddressIdPath:d}=n.res.order;u.consigneeMobile=_,u.consigneeDetail=e,u.consigneeName=m,u.consigneeAddressPath=w,D.value=d}}function me(){b.value=!0,n.res.order.flowPrice&&(k.value.price=n.res.order.flowPrice)}return Ae(()=>{de()}),(_,e)=>{const m=f("a-step"),w=f("a-steps"),d=f("a-button"),q=f("a-typography-title"),ve=f("a-typography-text"),ye=f("a-space"),_e=f("a-divider"),U=f("a-modal"),L=f("a-input"),V=f("a-form-item"),ce=f("icon-edit"),B=f("a-form"),ge=f("a-textarea"),be=f("a-input-number"),ke=f("a-drawer"),xe=Q("print"),J=Q("auto-animate");return H((a(),v("div",null,[n.res?(a(),v("div",Ee,[i("div",$e,[i("div",null,[n.res.order.orderStatus==="CANCELLED"?(a(),c(w,{key:0,current:4,"line-less":""},{default:t(()=>[o(m,null,{default:t(()=>e[18]||(e[18]=[r("提交申请")])),_:1}),o(m,null,{default:t(()=>e[19]||(e[19]=[r("取消处理")])),_:1}),o(m,null,{default:t(()=>e[20]||(e[20]=[r("审核通过")])),_:1}),o(m,null,{default:t(()=>e[21]||(e[21]=[r("完成")])),_:1})]),_:1})):(a(),c(w,{key:1,"line-less":"",current:l(F)},{default:t(()=>[o(m,null,{default:t(()=>e[22]||(e[22]=[r("买家下单")])),_:1}),o(m,null,{default:t(()=>e[23]||(e[23]=[r("付款成功")])),_:1}),o(m,null,{default:t(()=>[n.res.order.orderType==="VIRTUAL"?(a(),v("span",je,"待核验")):y("",!0),n.res.order.deliveryMethod==="SELF_PICK_UP"?(a(),v("span",Fe,"待自提")):y("",!0),(n.res.order.orderType==="NORMAL"||n.res.order.orderType==="PURCHASE")&&n.res.order.deliveryMethod==="LOGISTICS"?(a(),v("span",qe,"商家发货")):y("",!0)]),_:1}),o(m,null,{default:t(()=>[(n.res.order.orderType==="NORMAL"||n.res.order.orderType==="PURCHASE")&&n.res.order.deliveryMethod==="LOGISTICS"?(a(),v("span",Be,"用户收货")):(a(),v("span",Ge,"已核销"))]),_:1}),o(m,null,{default:t(()=>e[24]||(e[24]=[r("交易完成")])),_:1})]),_:1},8,["current"]))]),o(d,{type:"text",onClick:e[0]||(e[0]=s=>P.value=!0)},{default:t(()=>e[25]||(e[25]=[r(" 操作记录 ")])),_:1})]),i("div",null,[o(q,{heading:4},{default:t(()=>[r(g(n.res.orderStatusValue),1)]),_:1}),o(ve,{type:"secondary"},{default:t(()=>[r(g(le[n.res.orderStatusValue]),1)]),_:1}),i("div",He,[o(ye,null,{default:t(()=>[l(R).editPrice?(a(),c(d,{key:0,type:"primary",onClick:me},{default:t(()=>e[26]||(e[26]=[r(" 调整价格 ")])),_:1})):y("",!0),l(R).editConsignee?(a(),c(d,{key:1,type:"primary",onClick:fe},{default:t(()=>e[27]||(e[27]=[r(" 修改收货地址 ")])),_:1})):y("",!0),l(R).cancel?(a(),c(d,{key:2,type:"outline",onClick:e[1]||(e[1]=s=>x.value=!0)},{default:t(()=>e[28]||(e[28]=[r(" 订单取消 ")])),_:1})):y("",!0),n.res.order.orderStatus==="UNPAID"&&n.res.allowOperationVO.pay?(a(),c(d,{key:3,type:"primary",onClick:ie},{default:t(()=>e[29]||(e[29]=[r(" 收款 ")])),_:1})):y("",!0),o(d,{type:"primary",onClick:e[2]||(e[2]=s=>A.value=!0)},{default:t(()=>e[30]||(e[30]=[r(" 打印发货单 ")])),_:1})]),_:1})]),o(U,{visible:l(A),"onUpdate:visible":e[4]||(e[4]=s=>E(A)?A.value=s:null),title:"打印发货单",width:"500px"},{footer:t(()=>[o(d,{onClick:e[3]||(e[3]=s=>A.value=!1)},{default:t(()=>e[33]||(e[33]=[r(" 取消 ")])),_:1}),H((a(),c(d,{type:"primary"},{default:t(()=>e[34]||(e[34]=[r(" 打印 ")])),_:1})),[[xe,te]])]),default:t(()=>[i("div",ze,[o(q,{heading:5,"mb-20px":""},{default:t(()=>e[31]||(e[31]=[r(" 收货信息 ")])),_:1}),i("div",Ke,[i("div",Je," 收件人："+g(n.res.order.consigneeName),1),i("div",Qe," 手机号："+g(n.res.order.consigneeMobile),1)]),i("div",null," 收货地址："+g(n.res.order.consigneeAddressPath)+g(n.res.order.consigneeDetail),1),i("div",We,[o(q,{heading:5,"mb-20px":""},{default:t(()=>e[32]||(e[32]=[r(" 商品信息 ")])),_:1}),(a(!0),v(W,null,X(n.res.orderItems,(s,Ce)=>(a(),v("div",{key:Ce},[i("div",Xe,[i("div",null,g(s.goodsName),1),i("div",null,"数量："+g(s.num),1)]),i("div",null,[s.specs?(a(),v("div",Ye,[(a(!0),v(W,null,X(JSON.parse(s.specs),(we,G)=>(a(),v("div",{key:G},[String(G)!=="images"?(a(),v("div",Ze,g(G)+" : "+g(we),1)):y("",!0)]))),128))])):y("",!0)]),o(_e)]))),128))])])]),_:1},8,["visible"]),o(U,{visible:l(C),"onUpdate:visible":e[9]||(e[9]=s=>E(C)?C.value=s:null),width:"630px",title:"修改收件信息"},{footer:t(()=>[i("div",he,[o(d,{onClick:ne},{default:t(()=>e[36]||(e[36]=[r(" 取消 ")])),_:1}),o(d,{style:{"margin-left":"10px"},type:"primary",onClick:re},{default:t(()=>e[37]||(e[37]=[r(" 修改 ")])),_:1})])]),default:t(()=>[i("div",null,[o(B,{ref_key:"formRef",ref:I,model:l(u),style:{width:"460px"},layout:"horizontal","auto-label-width":""},{default:t(()=>[o(V,{field:"consigneeName",label:"收件人",rules:[l(N),l(Y)]},{default:t(()=>[o(L,{modelValue:l(u).consigneeName,"onUpdate:modelValue":e[5]||(e[5]=s=>l(u).consigneeName=s)},null,8,["modelValue"])]),_:1},8,["rules"]),o(V,{field:"consigneeMobile",label:"联系方式",rules:[l(N),l(Y)]},{default:t(()=>[o(L,{modelValue:l(u).consigneeMobile,"onUpdate:modelValue":e[6]||(e[6]=s=>l(u).consigneeMobile=s)},null,8,["modelValue"])]),_:1},8,["rules"]),o(V,{field:"consigneeAddressPath",label:"地址信息",rules:[l(N)]},{default:t(()=>[l(S)?(a(),c(L,{key:0,modelValue:l(u).consigneeAddressPath,"onUpdate:modelValue":e[7]||(e[7]=s=>l(u).consigneeAddressPath=s),disabled:""},null,8,["modelValue"])):y("",!0),l(S)?(a(),c(d,{key:1,type:"primary",onClick:pe},{default:t(()=>[o(ce),e[35]||(e[35]=r("修改 "))]),_:1})):y("",!0),l(O)?(a(),c(l(Le),{key:l(z),ids:l(D),api:l(Ne),address:l(u).consigneeAddressPath,onCallback:se},null,8,["ids","api","address"])):y("",!0)]),_:1},8,["rules"]),o(V,{field:"consigneeDetail",label:"详细地址",rules:[l(N)]},{default:t(()=>[o(L,{modelValue:l(u).consigneeDetail,"onUpdate:modelValue":e[8]||(e[8]=s=>l(u).consigneeDetail=s)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])])]),_:1},8,["visible"]),o(U,{visible:l(x),"onUpdate:visible":e[12]||(e[12]=s=>E(x)?x.value=s:null),width:"500px",title:"取消原因"},{footer:t(()=>[i("div",et,[o(d,{"mr-10px":"",onClick:e[11]||(e[11]=s=>x.value=!1)},{default:t(()=>e[38]||(e[38]=[r(" 取消 ")])),_:1}),o(d,{class:"marginL10",type:"primary",onClick:ae},{default:t(()=>e[39]||(e[39]=[r(" 确认 ")])),_:1})])]),default:t(()=>[o(B,{ref_key:"formRef",ref:I,model:l(T),style:{width:"460px"},layout:"horizontal","auto-label-width":""},{default:t(()=>[o(V,{field:"reason",label:"取消原因",rules:[l(N)]},{default:t(()=>[o(ge,{modelValue:l(T).reason,"onUpdate:modelValue":e[10]||(e[10]=s=>l(T).reason=s),placeholder:"请输入取消原因","allow-clear":""},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"]),o(U,{visible:l(b),"onUpdate:visible":e[15]||(e[15]=s=>E(b)?b.value=s:null),width:"500px",title:"修改金额"},{footer:t(()=>[i("div",tt,[o(d,{onClick:e[14]||(e[14]=s=>b.value=!1)},{default:t(()=>e[41]||(e[41]=[r(" 关闭 ")])),_:1}),o(d,{style:{"margin-left":"10px"},type:"primary",status:"danger",onClick:ue},{default:t(()=>e[42]||(e[42]=[r(" 调整 ")])),_:1})])]),default:t(()=>[i("div",null,[o(B,{ref_key:"modifyPriceForm",ref:k,model:l(k),style:{width:"460px"},layout:"horizontal","auto-label-width":""},{default:t(()=>[o(V,{field:"reason",label:"订单金额"},{default:t(()=>[o(be,{modelValue:l(k).price,"onUpdate:modelValue":e[13]||(e[13]=s=>l(k).price=s),style:{width:"320px"},class:"input-demo",min:0,max:999999},null,8,["modelValue"]),e[40]||(e[40]=i("span",{class:"ml-10px"},"元",-1))]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"]),o(ke,{"mask-closable":"","hide-cancel":"","ok-text":"知道了",visible:l(P),width:"800px",title:"订单日志",onCancel:e[16]||(e[16]=s=>P.value=!1),onOk:e[17]||(e[17]=s=>P.value=!1)},{default:t(()=>[H((a(),v("div",null,[l(P)?(a(),c(Ue,{key:0,res:n.res},null,8,["res"])):y("",!0)])),[[J]])]),_:1},8,["visible"])])])):y("",!0)])),[[J]])}}}),dt=Me(ot,[["__scopeId","data-v-9af84231"]]);export{dt as default};
