import{M as fe,N as M,O as pe,P as ce}from"./member-B0DkAxtf.js";import{_ as be}from"./index.vue_vue_type_script_setup_true_lang-DsrWKjKu.js";import{u as ge}from"./useCurrentInstance-BLlvmEjv.js";import{m as ye,t as x}from"./filters-D05Q2eUM.js";import{R as _}from"./validator-B8pIxTAL.js";import{_ as ve}from"./list.vue_vue_type_script_setup_true_lang-CIIU8Ocj.js";import{V as _e}from"./dist-PezRi_EG.js";import{d as Ce,r,a as he,b as s,o as u,j as c,w as i,e as a,u as n,k as d,s as g,t as O,f as p,c as S,F as Ne,i as we,q as k,M as V,_ as Oe}from"./index-C4AMdMz2.js";import"./index-CzBKN9cw.js";import"./index--a7kHzzJ.js";import"./extra-5DUayDl9.js";import"./promotion-ChRoyrm_.js";import"./tools-BfzgO_2s.js";const Ie={"bg-gray-100":"","text-center":""},Te={flex:"","justify-between":""},xe={"mr-10px":""},ke=["src"],Ve=["src"],Le={style:{"text-align":"right"}},Ue=Ce({__name:"benefits",setup(Ee){var P;const C=r(),R=(P=ge().globalProperties)==null?void 0:P.$modal,$=r({}),L=r(),B=r([]),m=r(!1),h=r(!1),D=r(""),b=r(!1),A=r(),I=r([]),U=r(""),E=r(""),j=[{title:"权益名称",dataIndex:"name"},{title:"展示名称",dataIndex:"showName"},{title:"权益图标",dataIndex:"icon",slot:!0,slotTemplate:"icon"},{title:"权益简介",width:300,dataIndex:"description"},{title:"权益状态",dataIndex:"status",slot:!0,slotTemplate:"status"},{title:"权益类型",dataIndex:"bindType",slot:!0,slotTemplate:"bindType"}],q={title:"操作",width:300,fixed:"right",methods:[{title:"编辑",callback:"editor",type:"text",status:"warning"}]},t=he({enableAddModal:!1,formLoading:!1,fid:"",form:{name:"",showName:"",description:"",icon:"",type:"",bindType:"",bindContent:"",status:"",display:""}});function F(o){I.value=o.url}function J(){m.value=!1,E.value==="icon"?t.form.icon=I.value:t.form.bkImage=I.value}async function X(){var e;await((e=L.value)==null?void 0:e.validate())||(t.form.bind&&(delete t.form.bind.couponList,t.form.bindContent=JSON.stringify(t.form.bind)),(t.fid?await M(t.fid,t.form):await fe(t.form)).data.success&&(V.success(`${t.fid?"修改":"添加"}成功!`),t.enableAddModal=!1,C.value.init()))}async function Q(o){if(U.value=o.record.name,Object.keys(t.form).forEach(e=>{t.form[e]=""}),o&&(Object.keys(o.record).forEach(e=>{t.form.hasOwnProperty(e)&&(t.form[e]=o.record[e])}),t.fid=o.record.id,t.enableAddModal=!0,o.record.bindContent&&JSON.parse(o.record.bindContent))){const e=JSON.parse(o.record.bindContent);t.form.bind={},o.record.bindType==="COUPON"?(t.form.bind.couponIds=e.couponIds,t.form.bind.couponList=JSON.parse(o.record.bindContentList),t.form.bind.couponNum=Number(e.couponNum),t.form.bind.frequency=e.frequency):o.record.bindType==="MULTIPLE_POINTS"||o.record.bindType==="MULTIPLE_EXPERIENCE"?t.form.bind.multiple=Number(e.multiple):o.record.bindType==="DISCOUNT"&&(t.form.bind.discount=Number(e.discount))}}function W(o){R.confirm({title:"确认删除",content:`您确认要删除${o.record.sensitiveWord}?`,alignCenter:!1,onOk:async()=>{(await pe(o.record.id)).data.success&&(V.success("删除成功"),C.value.init())}})}function z(o){B.value=o}function G(){b.value=!0}function H(){m.value=!1}function K(){m.value=!1}function Y(o){return Number(o)>1?1:Number(o)<.01?.01:o}function Z(o){o.values.length>0?t.form.bind.couponIds=o.values.map(e=>e.id).join(","):t.form.bind.couponIds=[]}function ee(o){t.form.bind.couponList=t.form.bind.couponList.filter(e=>e.id!==o.id),t.form.bind.couponIds=t.form.bind.couponList.map(e=>e.id).join(",")}async function te(o){o.open?o.status="OPEN":o.status="CLOSE",(await M(o.id,o)).data.success&&(V.success("操作成功"),C.value.init())}function oe(o){E.value=o,m.value=!0}async function ne(o){const e=await ce(o);return e.data.result.records.forEach(y=>{y.open=y.status==="OPEN"}),e}return(o,e)=>{const y=s("a-image"),le=s("a-switch"),ie=s("a-tag"),v=s("a-button"),f=s("a-form-item"),N=s("a-input-number"),ae=s("a-input"),se=s("icon-eye"),re=s("a-tooltip"),de=s("a-textarea"),ue=s("a-form"),w=s("a-modal"),me=s("a-card");return u(),c(me,{class:"general-card",title:"会员权益",bordered:!1},{default:i(()=>[a(n(_e),{ref_key:"tablePageRef",ref:C,columns:j,methods:q,api:ne,"api-params":n($),bordered:!0,onEditor:Q,onDelete:W,onSelectTableChange:z},{icon:i(({data:l})=>[d("div",Ie,[l.icon?(u(),c(y,{key:0,width:"50",height:"50",src:l.icon},null,8,["src"])):g("",!0)])]),type:i(({data:l})=>[d("div",null,O(l.type==="INTERNAL"?"内部":"外部"),1)]),status:i(({data:l})=>[a(le,{modelValue:l.open,"onUpdate:modelValue":T=>l.open=T,onChange:T=>te(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),bindType:i(({data:l})=>[d("div",null,O(n(ye)(l.bindType)),1)]),_:1},8,["api-params"]),a(w,{visible:n(t).enableAddModal,"onUpdate:visible":e[8]||(e[8]=l=>n(t).enableAddModal=l),footer:!1,"mask-closable":!1},{title:i(()=>[p(O(n(U)),1)]),default:i(()=>[d("div",Te,[a(ue,{ref_key:"formRef",ref:L,model:n(t).form,onSubmit:X},{default:i(()=>[n(t).form.bindType==="COUPON"?(u(),c(f,{key:0,field:"bind.couponIds",label:"选择优惠券","validate-trigger":["change"]},{default:i(()=>[d("div",xe,[(u(!0),S(Ne,null,we(n(t).form.bind.couponList,l=>(u(),S("div",{key:l.id,"mb-5px":""},[a(ie,{closable:"",onClose:T=>ee(l)},{default:i(()=>[p(O(l.couponName),1)]),_:2},1032,["onClose"])]))),128))]),a(v,{type:"primary",onClick:G},{default:i(()=>e[16]||(e[16]=[p(" 选择优惠券 ")])),_:1})]),_:1})):g("",!0),n(t).form.bindType==="COUPON"?(u(),c(f,{key:1,field:"bind.couponNum",label:"数量",rules:[n(_)],"validate-trigger":["change"]},{default:i(()=>[a(N,{modelValue:n(t).form.bind.couponNum,"onUpdate:modelValue":e[0]||(e[0]=l=>n(t).form.bind.couponNum=l),style:{width:"320px"},placeholder:"请输入赠送优惠券的数量","default-value":0,mode:"button",min:0,class:"input-demo",formatter:n(x)},null,8,["modelValue","formatter"])]),_:1},8,["rules"])):g("",!0),n(t).form.bindType==="COUPON"?(u(),c(f,{key:2,field:"bind.frequency",label:"赠送频率",rules:[n(_)],"validate-trigger":["change"]},{default:i(()=>[a(N,{modelValue:n(t).form.bind.frequency,"onUpdate:modelValue":e[1]||(e[1]=l=>n(t).form.bind.frequency=l),style:{width:"320px"},placeholder:"请输入赠送优惠券的赠送频率,单位:天","default-value":0,mode:"button",min:0,class:"input-demo",formatter:n(x)},{suffix:i(()=>e[17]||(e[17]=[p(" 天 ")])),_:1},8,["modelValue","formatter"])]),_:1},8,["rules"])):g("",!0),n(t).form.bindType==="MULTIPLE_POINTS"||n(t).form.bindType==="MULTIPLE_EXPERIENCE"?(u(),c(f,{key:3,field:"bind.multiple",label:"倍数",rules:[n(_)],"validate-trigger":["change"]},{default:i(()=>[a(N,{modelValue:n(t).form.bind.multiple,"onUpdate:modelValue":e[2]||(e[2]=l=>n(t).form.bind.multiple=l),style:{width:"320px"},placeholder:"请输入当前权益的倍数","default-value":0,mode:"button",min:0,class:"input-demo",formatter:n(x)},null,8,["modelValue","formatter"])]),_:1},8,["rules"])):g("",!0),a(f,{field:"icon",label:"权益图标",tooltip:"展示权益的图标内容","validate-trigger":["change"]},{default:i(()=>[a(ae,{modelValue:n(t).form.icon,"onUpdate:modelValue":e[3]||(e[3]=l=>n(t).form.icon=l),readonly:"","w-200px":""},null,8,["modelValue"]),a(re,null,{content:i(()=>[d("div",null,[d("img",{src:n(t).form.icon,alt:"该资源不存在",style:{width:"100%",margin:"0 auto"}},null,8,ke),d("a",{style:{"margin-top":"5px","text-align":"right",cursor:"pointer"},onClick:e[4]||(e[4]=l=>o.handleViewImage(n(t).form.icon))},"查看大图")])]),default:i(()=>[a(v,null,{default:i(()=>[a(se)]),_:1})]),_:1}),a(v,{type:"primary",onClick:e[5]||(e[5]=l=>oe("icon"))},{default:i(()=>e[18]||(e[18]=[p(" 上传图片 ")])),_:1})]),_:1}),n(t).form.bindType==="DISCOUNT"?(u(),c(f,{key:4,field:"bind.discount",label:"折扣",rules:[n(_)],"validate-trigger":["change"]},{default:i(()=>[a(N,{modelValue:n(t).form.bind.discount,"onUpdate:modelValue":e[6]||(e[6]=l=>n(t).form.bind.discount=l),style:{width:"320px"},placeholder:"请输入当前权益的折扣",formatter:Y,"default-value":1,mode:"button",precision:2,step:.01,max:"1",min:"0.01",class:"input-demo"},null,8,["modelValue"])]),_:1},8,["rules"])):g("",!0),a(f,{field:"description",label:"权益介绍",rules:[n(_)],"validate-trigger":["change"]},{default:i(()=>[a(de,{modelValue:n(t).form.description,"onUpdate:modelValue":e[7]||(e[7]=l=>n(t).form.description=l),style:{width:"320px"},placeholder:"请输入权益介绍"},null,8,["modelValue"])]),_:1},8,["rules"]),a(f,{label:"操作"},{default:i(()=>[a(v,{loading:n(t).formLoading,"html-type":"submit",type:"primary"},{default:i(()=>e[19]||(e[19]=[p(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"]),a(w,{visible:n(b),"onUpdate:visible":e[9]||(e[9]=l=>k(b)?b.value=l:null),width:1300,title:"优惠券列表",onOk:e[10]||(e[10]=l=>b.value=!0),onCancel:e[11]||(e[11]=l=>b.value=!1)},{default:i(()=>[a(ve,{ref_key:"couponListRef",ref:A,checkbox:!0,"template-model":"selectModel",onSelectTableChange:Z},null,512)]),_:1},8,["visible"]),a(w,{visible:n(m),"onUpdate:visible":e[12]||(e[12]=l=>k(m)?m.value=l:null),width:1100,title:"oss资源管理",onOk:J,onCancel:e[13]||(e[13]=l=>m.value=!1)},{default:i(()=>[a(be,{"is-single":!0,onSelected:F})]),_:1},8,["visible"]),e[21]||(e[21]=p()),a(w,{visible:n(h),"onUpdate:visible":e[15]||(e[15]=l=>k(h)?h.value=l:null),width:1100,onOk:H,onCancel:K},{footer:i(()=>[d("div",Le,[a(v,{type:"text",status:"danger",onClick:e[14]||(e[14]=l=>h.value=!1)},{default:i(()=>e[20]||(e[20]=[p(" 关闭 ")])),_:1})])]),default:i(()=>[d("img",{src:n(D),alt:"该资源不存在",style:{width:"100%",margin:"0 auto",display:"block"}},null,8,Ve)]),_:1},8,["visible"])]),_:1})}}}),Qe=Oe(Ue,[["__scopeId","data-v-e2f67d60"]]);export{Qe as default};
