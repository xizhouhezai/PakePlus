import{s as L,t as S,v as B,w as y}from"./goods-CB7YWqUH.js";import{u as G}from"./useCurrentInstance-BLlvmEjv.js";import{R as P,V as N}from"./validator-B8pIxTAL.js";import{V as H}from"./dist-PezRi_EG.js";import{d as Q,r as c,a as q,b as s,o as z,j as F,w as n,e as l,f as u,t as w,u as o,M as m}from"./index-C4AMdMz2.js";const ee=Q({__name:"list",setup(J){var h;const d=c([]),i=c(),p=c(""),f=c(""),b=c(),g=(h=G().globalProperties)==null?void 0:h.$modal,k=[{title:"计量单位",dataIndex:"name",width:150},{title:"创建时间",dataIndex:"createTime",width:150},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作人",dataIndex:"createBy",width:150}],x={title:"操作",width:250,fixed:"right",methods:[{title:"修改",callback:"editor",type:"text",status:"warning"},{title:"删除",callback:"delete",type:"text",status:"danger"}]},e=q({enableAddModal:!1,formLoading:!1,fid:"",form:{name:""}});function A(a){d.value=a}function C(){e.enableAddModal=!0,p.value="添加",e.fid="",Object.keys(e.form).forEach(a=>{e.form[a]=""})}async function M(){var t;if(!await((t=b.value)==null?void 0:t.validate())){const{data:r}=e.fid?await S(e.fid,e.form):await B(e.form);r.success&&(m.success(`${e.fid?"修改":"添加"}成功!`),e.enableAddModal=!1,i.value.init())}}function R(a){p.value="编辑",a&&(Object.keys(a.record).forEach(t=>{e.form[t]=a.record[t]??""}),e.fid=a.record.id,e.enableAddModal=!0)}function V(a){g.confirm({title:"确认删除",content:`您确认要删除${a.record.name}?`,alignCenter:!1,onOk:async()=>{(await y(a.record.id)).data.success&&(m.success("删除成功"),i.value.init())}})}function E(){if(d.value.length<=0){m.error("您还未选择要删除的数据");return}d.value.forEach(t=>{f.value+=`${t.id},`});const a=f.value.substring(0,f.value.length-1);g.confirm({title:"确认删除",content:`您确认要删除所选的${d.value.length}条数据?`,alignCenter:!1,onOk:async()=>{(await y(a)).data.success&&(m.success("删除成功"),i.value.clearSelect(),f.value="",d.value=[],i.value.init())}})}return(a,t)=>{const r=s("a-button"),I=s("a-space"),U=s("a-col"),T=s("a-row"),D=s("a-input"),v=s("a-form-item"),O=s("a-form"),$=s("a-modal"),j=s("a-card");return z(),F(j,{class:"general-card",title:"计量单位",bordered:!1},{default:n(()=>[l(T,{style:{"margin-bottom":"16px"}},{default:n(()=>[l(U,{span:16},{default:n(()=>[l(I,null,{default:n(()=>[l(r,{type:"primary",onClick:C},{default:n(()=>t[2]||(t[2]=[u(" 添加 ")])),_:1}),l(r,{onClick:E},{default:n(()=>[u(w(o(d).length)+"条 批量删除 ",1)]),_:1})]),_:1})]),_:1})]),_:1}),l(o(H),{ref_key:"tablePageRef",ref:i,columns:k,methods:x,api:o(L),checkbox:!0,bordered:!0,"default-selected-keys":o(d),onDelete:V,onEditor:R,onSelectTableChange:A},null,8,["api","default-selected-keys"]),l($,{visible:o(e).enableAddModal,"onUpdate:visible":t[1]||(t[1]=_=>o(e).enableAddModal=_),"align-center":!1,footer:!1},{title:n(()=>[u(w(o(p)),1)]),default:n(()=>[l(O,{ref_key:"formRef",ref:b,model:o(e).form,onSubmit:M},{default:n(()=>[l(v,{field:"name",label:"计量单位",rules:[o(P),o(N)],"validate-trigger":["change"]},{default:n(()=>[l(D,{modelValue:o(e).form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>o(e).form.name=_)},null,8,["modelValue"])]),_:1},8,["rules"]),l(v,{label:"操作"},{default:n(()=>[l(r,{loading:o(e).formLoading,"html-type":"submit",type:"primary"},{default:n(()=>t[3]||(t[3]=[u(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});export{ee as default};
