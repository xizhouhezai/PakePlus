import{g as q,s as F,S as Q,T as A}from"./operation-CQQGRn8-.js";import{R as x}from"./validator-B8pIxTAL.js";import{d as J,r as m,h as K,b as d,o as V,c as U,e as l,w as t,f as r,u as o,k as u,q as L,j as N,s as C,t as X,M as H}from"./index-C4AMdMz2.js";const Y={style:{"background-color":"#fff"}},Z={flex:""},$={"mr-40px":""},h={key:0,"m-10":""},ae=J({__name:"goods",setup(R){const W=m(),i=m({goodsCheck:!0,abbreviationPictureWidth:"",abbreviationPictureHeight:"",smallPictureWidth:"",smallPictureHeight:"",originalPictureWidth:"",originalPictureHeight:""}),p=m(!1),f=m(),b=m(0),_=m(0),P=m(!1);async function I(){const a=await q("GOODS_SETTING");i.value=a.data.result}async function T(){var e;await((e=W.value)==null?void 0:e.validate())||(await F("GOODS_SETTING",i.value)).data.success&&(H.success("设置成功!"),I())}function E(){f.value&&(clearInterval(f.value),f.value=null,p.value=!1),Q(P.value).then(a=>{!a.data.success&&a.data.code!==1e5||(a.data.success?(H.success("开始生成!"),p.value=!0,setTimeout(()=>c(),1e3)):a.data.code===1e5&&(p.value=!0,c()))}).catch(a=>{console.error("创建索引请求失败:",a)})}function c(){f.value=setInterval(()=>{A().then(a=>{const e=a.data.result;O(e),B(e)&&(clearInterval(f.value),f.value=null,p.value=!1,H.success("生成成功!"))}).catch(a=>{console.error("获取进度请求失败:",a)})},1e3)}function O(a){var e,g;_.value=(a==null?void 0:a.store.currentInfo)||"",b.value=Number((((e=a==null?void 0:a.store)==null?void 0:e.processed)/((g=a==null?void 0:a.store)==null?void 0:g.total)).toFixed(2))||0}function B(a){var e;return((e=a==null?void 0:a.store)==null?void 0:e.flag)===0}function D(){f.value&&(clearInterval(f.value),f.value=null),p.value=!0,c()}return K(()=>{I()}),(a,e)=>{const g=d("a-divider"),S=d("a-radio"),G=d("a-radio-group"),s=d("a-form-item"),y=d("a-col"),k=d("a-row"),v=d("a-input-number"),w=d("a-button"),M=d("a-checkbox"),z=d("a-progress"),j=d("a-form");return V(),U("div",Y,[l(j,{ref_key:"formRef",ref:W,style:{padding:"30px"},model:o(i),layout:"horizontal","auto-label-width":""},{default:t(()=>[l(g,{orientation:"left"},{default:t(()=>e[8]||(e[8]=[r(" 商品设置 ")])),_:1}),l(k,{gutter:24},{default:t(()=>[l(y,{span:20},{default:t(()=>[l(s,{field:"isOpen",label:"是否开启商品审核"},{default:t(()=>[l(G,{modelValue:o(i).goodsCheck,"onUpdate:modelValue":e[0]||(e[0]=n=>o(i).goodsCheck=n),type:"button"},{default:t(()=>[l(S,{value:!0},{default:t(()=>e[9]||(e[9]=[r(" 开启 ")])),_:1}),l(S,{value:!1},{default:t(()=>e[10]||(e[10]=[r(" 关闭 ")])),_:1})]),_:1},8,["modelValue"]),e[11]||(e[11]=u("div",{style:{"margin-left":"10px",color:"#999","font-size":"12px"}}," 商品审核关闭后，商家添加商品则无需审核直接上架 ",-1))]),_:1})]),_:1})]),_:1}),u("div",Z,[u("div",$,[l(s,{field:"abbreviationPictureWidth",label:"缩略图宽",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).abbreviationPictureWidth,"onUpdate:modelValue":e[1]||(e[1]=n=>o(i).abbreviationPictureWidth=n),min:0,"w-260px":""},{prefix:t(()=>e[12]||(e[12]=[r(" 宽 ")])),_:1},8,["modelValue"]),e[13]||(e[13]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"]),l(s,{field:"smallPictureWidth",label:"小图宽",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).smallPictureWidth,"onUpdate:modelValue":e[2]||(e[2]=n=>o(i).smallPictureWidth=n),min:0,"w-260px":""},{prefix:t(()=>e[14]||(e[14]=[r(" 宽 ")])),_:1},8,["modelValue"]),e[15]||(e[15]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"]),l(s,{field:"originalPictureWidth",label:"原图宽",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).originalPictureWidth,"onUpdate:modelValue":e[3]||(e[3]=n=>o(i).originalPictureWidth=n),min:0,"w-260px":""},{prefix:t(()=>e[16]||(e[16]=[r(" 宽 ")])),_:1},8,["modelValue"]),e[17]||(e[17]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"])]),u("div",null,[l(s,{field:"abbreviationPictureHeight",label:"缩略图高",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).abbreviationPictureHeight,"onUpdate:modelValue":e[4]||(e[4]=n=>o(i).abbreviationPictureHeight=n),min:0,"w-260px":""},{prefix:t(()=>e[18]||(e[18]=[r(" 高 ")])),_:1},8,["modelValue"]),e[19]||(e[19]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"]),l(s,{field:"smallPictureHeight",label:"小图高",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).smallPictureHeight,"onUpdate:modelValue":e[5]||(e[5]=n=>o(i).smallPictureHeight=n),min:0,"w-260px":""},{prefix:t(()=>e[20]||(e[20]=[r(" 高 ")])),_:1},8,["modelValue"]),e[21]||(e[21]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"]),l(s,{field:"originalPictureHeight",label:"原图高",rules:[o(x)],"validate-trigger":["change"]},{default:t(()=>[l(v,{modelValue:o(i).originalPictureHeight,"onUpdate:modelValue":e[6]||(e[6]=n=>o(i).originalPictureHeight=n),min:0,"w-260px":""},{prefix:t(()=>e[22]||(e[22]=[r(" 高 ")])),_:1},8,["modelValue"]),e[23]||(e[23]=u("span",{style:{"margin-left":"10px"}},"px",-1))]),_:1},8,["rules"])])]),l(k,{gutter:16},{default:t(()=>[l(y,{span:14},{default:t(()=>[l(s,null,{default:t(()=>[l(w,{type:"primary",onClick:T},{default:t(()=>e[24]||(e[24]=[r(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1}),l(g,{orientation:"left"},{default:t(()=>e[25]||(e[25]=[r(" 商品索引 ")])),_:1}),l(k,{gutter:16},{default:t(()=>[l(y,{span:14},{default:t(()=>[u("div",null,[l(w,{type:"outline",onClick:D},{default:t(()=>e[26]||(e[26]=[r(" 获取正在生成的进度 ")])),_:1}),l(w,{type:"primary",status:"danger",style:{"margin-left":"40px"},onClick:E},{default:t(()=>e[27]||(e[27]=[r(" 重新生成所有商品索引 ")])),_:1}),l(M,{modelValue:o(P),"onUpdate:modelValue":e[7]||(e[7]=n=>L(P)?P.value=n:null),"ml-10px":""},{default:t(()=>e[28]||(e[28]=[r(" 强制生成 ")])),_:1},8,["modelValue"])]),o(p)?(V(),U("div",h,[o(b)>=0?(V(),N(s,{key:0,label:"店铺商品生成进度"},{default:t(()=>[l(z,{percent:o(b),style:{width:"500px"}},null,8,["percent"])]),_:1})):C("",!0),o(_)&&o(b)>=0?(V(),N(s,{key:1,label:"当前生成店铺商品名称"},{default:t(()=>[u("div",null,X(o(_)),1)]),_:1})):C("",!0)])):C("",!0)]),_:1})]),_:1})]),_:1},8,["model"])])}}});export{ae as _};
