import{d as S,r as f,p as A,n as F,h as H,b as n,o as T,c as x,e as o,w as u,u as t,k as v,F as I,i as L,x as M,y as q,q as $,f as _,M as k,j,t as z,_ as Q}from"./index-C4AMdMz2.js";import{a9 as G,aa as J}from"./promotion-ChRoyrm_.js";import{R as c}from"./validator-B8pIxTAL.js";const K={class:"base-info-item"},O={class:"form-item-view"},W={class:"foot-btn"},X=S({__name:"seckill-add",setup(Y){const b=f(),g=A(),P=F(),l=f({promotionName:"",applyEndTime:"",startTime:"",seckillPeriod:[],seckillRule:"",hours:"",createTime:"",updateTime:"",endTime:"",seckillApplyList:""}),s=f(),y=f(!1);async function h(){const i=await G(g.query.id);if(i.data.success){const e=i.data.result;e.seckillPeriod=i.data.result.hours.split(","),l.value=e}}H(()=>{h()});function R(i){l.value.seckillPeriod=l.value.seckillPeriod.filter(e=>e!==i)}function V(){y.value=!1;const i=new Date(l.value.startTime).getHours();if(s.value!=null&&!l.value.seckillPeriod.includes(s.value)){if(i>s.value)return k.error("抢购时间段不能小于活动开始时间"),s.value=null,!1;if(l.value.seckillPeriod.findIndex(d=>d===s.value)!==-1)return k.error("时间段已存在"),s.value=null,!1;l.value.seckillPeriod.push(s.value)}}function C(){V(),y.value=!0,s.value=""}function N(){P.push({name:"seckill"})}async function D(){var e;if(!await((e=b.value)==null?void 0:e.validate())){const d=new Date(l.value.startTime).getHours();let r=!0;if(r=l.value.seckillPeriod.every(m=>Number(d)<=Number(m)),r){l.value.hours=l.value.seckillPeriod.toString(),delete l.value.createTime,delete l.value.updateTime,delete l.value.endTime,delete l.value.seckillApplyList;const m=l.value;J(m).then(p=>{p.data&&p.data.success&&(k.success("编辑成功"),P.push({name:"seckill"}))})}else k.error("抢购时间段不能小于活动开始时间")}}return(i,e)=>{const d=n("a-input"),r=n("a-form-item"),m=n("a-date-picker"),p=n("a-tag"),E=n("a-input-number"),w=n("a-button"),U=n("a-form"),B=n("a-card");return T(),x("div",null,[o(B,{bordered:!1},{default:u(()=>[o(U,{ref_key:"modifyPriceForm",ref:b,model:t(l),style:{width:"100%"},layout:"horizontal","auto-label-width":""},{default:u(()=>[v("div",K,[e[8]||(e[8]=v("h4",null,"基本信息",-1)),v("div",O,[o(r,{field:"promotionName",label:"活动名称",rules:[t(c)]},{default:u(()=>[o(d,{modelValue:t(l).promotionName,"onUpdate:modelValue":e[0]||(e[0]=a=>t(l).promotionName=a),"allow-clear":"",style:{width:"260px"}},null,8,["modelValue"])]),_:1},8,["rules"]),o(r,{field:"applyEndTime",label:"报名截止时间",rules:[t(c)]},{default:u(()=>[o(m,{modelValue:t(l).applyEndTime,"onUpdate:modelValue":e[1]||(e[1]=a=>t(l).applyEndTime=a),style:{width:"200px"},"allow-clear":"","show-time":""},null,8,["modelValue"])]),_:1},8,["rules"]),o(r,{field:"startTime",label:"活动开始时间",rules:[t(c)]},{default:u(()=>[o(m,{modelValue:t(l).startTime,"onUpdate:modelValue":e[2]||(e[2]=a=>t(l).startTime=a),style:{width:"200px"},"allow-clear":"","show-time":""},null,8,["modelValue"])]),_:1},8,["rules"]),o(r,{field:"seckillPeriod",label:"抢购时间段",rules:[t(c)]},{default:u(()=>[(T(!0),x(I,null,L(t(l).seckillPeriod,a=>(T(),j(p,{key:a,closable:"",onClose:Z=>R(a)},{default:u(()=>[_(z(a>=10?a:`0${a}`)+":00 ",1)]),_:2},1032,["onClose"]))),128)),M(o(E,{modelValue:t(s),"onUpdate:modelValue":e[3]||(e[3]=a=>$(s)?s.value=a:null),style:{width:"100px","margin-left":"10px"},class:"input-demo",min:0,max:23,onBlur:V},null,8,["modelValue"]),[[q,t(y)]]),o(w,{style:{"margin-left":"10px"},type:"outline",onClick:C},{default:u(()=>e[5]||(e[5]=[_(" 添加时间段 ")])),_:1})]),_:1},8,["rules"]),o(r,{field:"seckillRule",label:"申请规则",rules:[t(c)]},{default:u(()=>[o(d,{modelValue:t(l).seckillRule,"onUpdate:modelValue":e[4]||(e[4]=a=>t(l).seckillRule=a),"allow-clear":"",style:{width:"260px"}},null,8,["modelValue"])]),_:1},8,["rules"])]),v("div",W,[o(w,{style:{"margin-right":"5px"},onClick:N},{default:u(()=>e[6]||(e[6]=[_(" 返回 ")])),_:1}),o(w,{type:"primary",onClick:D},{default:u(()=>e[7]||(e[7]=[_(" 提交 ")])),_:1})])])]),_:1},8,["model"])]),_:1})])}}}),ae=Q(X,[["__scopeId","data-v-08f78575"]]);export{ae as default};
