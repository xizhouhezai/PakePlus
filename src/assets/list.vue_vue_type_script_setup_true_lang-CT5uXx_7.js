import{F as Te,y as Ae,G as Be,H as Re,I as Se,J as $e,K as Ve,L as Oe,M as De,N as Fe}from"./goods-CB7YWqUH.js";import{u as Le}from"./useCurrentInstance-BLlvmEjv.js";import{d as Me,r,J as Ue,n as Ie,h as Ne,b as u,o as f,j as g,w as a,e as n,f as s,u as d,t as A,s as B,q as D,k as F,c as W,F as z,i as Q,M as p,a8 as je}from"./index-C4AMdMz2.js";import{d as Pe}from"./tools-BfzgO_2s.js";import{V as Ee}from"./dist-PezRi_EG.js";import qe from"./classifyModel-DKDTUTay.js";const Ge={style:{"text-align":"right"}},Je={style:{"text-align":"right"}},He={style:{"text-align":"center"}},Ze=Me({__name:"list",props:{templateModel:{type:String,default:"normal"}},emits:["selectTableChange"],setup(X,{emit:Y}){var E;const Z=X,ee=Y,te=r(Ue.getAccessToken()||""),L=r([]),M=Z.templateModel==="normal",U=Ie(),v=r(!1),_=r(!1),x=r({categoryBrands:[]}),h=r({categorySpecs:[]}),ae=r([]),R=r(""),w=r(""),I=r([]),i=r(null),y=r(!1),S=(E=Le().globalProperties)==null?void 0:E.$modal,N=r([]),j=r(""),T=r(!1);async function oe(){const t=await Te();I.value=t.data.result}const le=[{title:"分类名称",dataIndex:"name",width:150,slot:!0,slotTemplate:"children"},{title:"分类状态",dataIndex:"deleteFlag",width:150,slot:!0,slotData:{badge:Pe}},{title:"佣金",dataIndex:"commissionRate",width:150,slot:!0,slotTemplate:"commissionRate"}],ne={title:"操作",width:250,fixed:"right",methods:[{title:"绑定",slot:!0,slotTemplate:"binding"},{title:"添加子分类",slot:!0,slotTemplate:"addSonClass"},{title:"操作",slot:!0,slotTemplate:"operation"}]};function C(){Ae().then(t=>{if(t.data.success&&t.data.result.length){const e=l=>{const c=[];return l.forEach(m=>{if(m.children&&m.children.length){const V=e(m.children);c.push({...m,children:V})}else c.push({...m,children:null});L.value.push(m)}),c};N.value=e(t.data.result)}})}function $(t,e,l,c){i.value.visible=t,i.value.modalTitle=e,i.value.showParent=l,i.value.modalType=c}function se(){$(!0,"添加一级分类",!0,0),i.value.parentTitle="顶级分类",i.value.formAdd.id=null}function ie(){S.confirm({title:"确认导出",content:"确定要导出商品分类数据吗？导出功能为异步导出，需要去 运营 - 导出记录 下载",onOk:async()=>{(await Be()).data.success&&p.success("导出成功,请前往 “运营 - 导出记录” 进行下载")}})}function de(){y.value=!0,j.value=`${je}/goods/category/import`}function re(t){i.value.formAdd.name=t.name,i.value.formAdd.id=t.id,i.value.formAdd.level=t.level,i.value.formAdd.parentId=t.parentId,i.value.formAdd.sortOrder=t.sortOrder,i.value.formAdd.commissionRate=t.commissionRate,i.value.formAdd.deleteFlag=t.deleteFlag===!1?0:1,i.value.formAdd.image=t.image,$(!0,"编辑",!1,1)}function ue(t){i.value.formAdd.id=null,i.value.formAdd.image="",i.value.parentTitle=t.name,i.value.formAdd.name="",i.value.formAdd.level=t.level+1,i.value.formAdd.parentId=t.id,i.value.formAdd.commissionRate=t.commissionRate,$(!0,"添加子分类",!0,0)}function ce(t){S.confirm({title:"确认删除",content:`您确认要删除${t.name}?`,alignCenter:!1,onOk:async()=>{(await Re(t.id)).data.success&&(p.success("删除成功！"),C(),w.value.init())}})}function P(t,e,l,c){S.confirm({title:e,content:`您是否要${l}当前分类 ${t.name} 及其子分类?`,alignCenter:!1,onOk:async()=>{(await Fe(t.id,{enableOperations:c})).data.success&&(p.success("操作成功"),C(),w.value.init())}})}function me(t){P(t,"确认禁用","禁用",!0)}function fe(t){P(t,"确认启用","启用",0)}function pe(t){const e=p.loading("加载中...");Se(t.id).then(l=>{R.value=t.id,e.close(),l.data.code===200&&(x.value.categoryBrands=l.data.result.map(c=>c.id),v.value=!0)}).catch(()=>{e.close()})}function ge(t){U.push({name:"parameter",query:{id:t.id}})}function ve(){$e(R.value,{categoryBrands:x.value.categoryBrands.join(",")}).then(t=>{t.data.code===200&&(p.success("操作成功"),C(),v.value=!1)})}function ye(){Ve(R.value,{categorySpecs:h.value.categorySpecs.join(",")}).then(t=>{t.data.code===200&&(p.success("操作成功"),C(),_.value=!1)})}function Ce(){T.value=!0,Oe().then(t=>{const e=window.URL.createObjectURL(new Blob([t],{type:"application/vnd.ms-excel;charset=utf-8"})),l=document.createElement("a");l.href=e,l.download="商品分类导入模板.xlsx",l.style.display="none",document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),window.URL.revokeObjectURL(e)},0),T.value=!1}).catch(t=>{console.warn(t),T.value=!1})}function be(t){const e=new FormData;e.append("filed",t),De(e).then(l=>{l.data.success&&(p.success("导入成功"),y.value=!1)})}function ke(t,e){e.status==="error"&&p.error(e.response.message),w.value.init()}function _e(){y.value=!1,U.go(0),w.value.init()}function xe(t){const e=L.value.find(l=>l.id===t[0]);ee("selectTableChange",{...e,___type:"category"})}return Ne(()=>{oe(),C()}),(t,e)=>{const l=u("a-button"),c=u("a-space"),m=u("a-col"),V=u("a-row"),q=u("icon-down"),b=u("a-doption"),G=u("a-dropdown"),J=u("a-option"),H=u("a-select"),K=u("a-form"),O=u("a-modal"),we=u("a-upload"),he=u("a-card");return f(),g(he,{class:"general-card",title:"商品分类",bordered:!1},{default:a(()=>[n(V,{style:{"margin-bottom":"16px"}},{default:a(()=>[n(m,{span:16},{default:a(()=>[n(c,null,{default:a(()=>[n(l,{type:"primary",onClick:se},{default:a(()=>e[7]||(e[7]=[s(" 添加一级分类 ")])),_:1}),n(l,{type:"primary",onClick:ie},{default:a(()=>e[8]||(e[8]=[s(" 导出分类 ")])),_:1}),n(l,{onClick:de},{default:a(()=>e[9]||(e[9]=[s(" 导入分类 ")])),_:1})]),_:1})]),_:1})]),_:1}),n(d(Ee),{ref_key:"tablePageRef",ref:w,columns:le,methods:ne,bordered:!0,"data-list":d(N),"enable-pagination":!1,checkbox:!M,radio:!M,onSelectTableChange:xe},{children:a(({data:o})=>[s(A(o.name),1)]),commissionRate:a(({data:o})=>[s(A(o.commissionRate||0)+"% ",1)]),addSonClass:a(({data:o})=>[o.level!==2?(f(),g(l,{key:0,type:"text",onClick:k=>ue(o)},{default:a(()=>e[10]||(e[10]=[s(" 添加子分类 ")])),_:2},1032,["onClick"])):B("",!0)]),binding:a(({data:o})=>[o.level===2?(f(),g(G,{key:0,"popup-max-height":!1},{content:a(()=>[n(b,{onClick:k=>pe(o)},{default:a(()=>e[12]||(e[12]=[s(" 编辑绑定品牌 ")])),_:2},1032,["onClick"]),n(b,{onClick:k=>ge(o)},{default:a(()=>e[13]||(e[13]=[s(" 编辑绑定参数 ")])),_:2},1032,["onClick"])]),default:a(()=>[n(l,{type:"text",status:"warning"},{default:a(()=>[e[11]||(e[11]=s(" 绑定")),n(q)]),_:1})]),_:2},1024)):B("",!0)]),operation:a(({data:o})=>[n(G,{"popup-max-height":!1},{content:a(()=>[n(b,{onClick:k=>re(o)},{default:a(()=>e[15]||(e[15]=[s(" 编辑 ")])),_:2},1032,["onClick"]),o.deleteFlag===1?(f(),g(b,{key:0,onClick:k=>fe(o)},{default:a(()=>e[16]||(e[16]=[s(" 启用 ")])),_:2},1032,["onClick"])):B("",!0),o.deleteFlag===0?(f(),g(b,{key:1,onClick:k=>me(o)},{default:a(()=>e[17]||(e[17]=[s(" 禁用 ")])),_:2},1032,["onClick"])):B("",!0),n(b,{onClick:k=>ce(o)},{default:a(()=>e[18]||(e[18]=[s(" 删除 ")])),_:2},1032,["onClick"])]),default:a(()=>[n(l,{type:"text"},{default:a(()=>[e[14]||(e[14]=s(" 操作")),n(q)]),_:1})]),_:2},1024)]),_:1},8,["data-list","checkbox","radio"]),n(qe,{ref_key:"operationModal",ref:i,onRefresh:C},null,512),n(O,{visible:d(v),"onUpdate:visible":e[2]||(e[2]=o=>D(v)?v.value=o:null),width:500},{title:a(()=>e[19]||(e[19]=[s(" 品牌关联 ")])),footer:a(()=>[F("div",Ge,[n(l,{style:{"margin-right":"5px"},onClick:e[1]||(e[1]=o=>v.value=!1)},{default:a(()=>e[20]||(e[20]=[s(" 取消 ")])),_:1}),n(l,{type:"primary",onClick:ve},{default:a(()=>e[21]||(e[21]=[s(" 提交 ")])),_:1})])]),default:a(()=>[n(K,{model:d(x),style:{width:"380px"},"auto-label-width":""},{default:a(()=>[n(H,{modelValue:d(x).categoryBrands,"onUpdate:modelValue":e[0]||(e[0]=o=>d(x).categoryBrands=o),style:{width:"400px"},"allow-clear":"",multiple:""},{default:a(()=>[(f(!0),W(z,null,Q(d(I),o=>(f(),g(J,{key:o.id,value:o.id},{default:a(()=>[s(A(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1},8,["visible"]),n(O,{visible:d(_),"onUpdate:visible":e[5]||(e[5]=o=>D(_)?_.value=o:null),width:500},{title:a(()=>e[22]||(e[22]=[s(" 规格关联 ")])),footer:a(()=>[F("div",Je,[n(l,{style:{"margin-right":"5px"},onClick:e[4]||(e[4]=o=>_.value=!1)},{default:a(()=>e[23]||(e[23]=[s(" 取消 ")])),_:1}),n(l,{type:"primary",onClick:ye},{default:a(()=>e[24]||(e[24]=[s(" 提交 ")])),_:1})])]),default:a(()=>[n(K,{model:d(h),style:{width:"380px"},"auto-label-width":""},{default:a(()=>[n(H,{modelValue:d(h).categorySpecs,"onUpdate:modelValue":e[3]||(e[3]=o=>d(h).categorySpecs=o),style:{width:"400px"},multiple:"","allow-clear":""},{default:a(()=>[(f(!0),W(z,null,Q(d(ae),o=>(f(),g(J,{key:o.id,value:o.id},{default:a(()=>[s(A(o.specName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1},8,["visible"]),n(O,{visible:d(y),"onUpdate:visible":e[6]||(e[6]=o=>D(y)?y.value=o:null),title:"导入商品信息",onOk:_e,onCancel:o=>!1},{default:a(()=>[F("div",He,[n(we,{"before-upload":be,draggable:"",name:"files",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",headers:{accessToken:d(te)},action:d(j),onChange:ke},null,8,["headers","action"]),n(l,{"mt-10px":"",type:"text",loading:d(T),onClick:Ce},{default:a(()=>e[25]||(e[25]=[s(" 下载导入模板 ")])),_:1},8,["loading"])])]),_:1},8,["visible"])]),_:1})}}});export{Ze as _};
